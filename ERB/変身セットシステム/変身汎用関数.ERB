@変身期間消費処理ALL(判定条件, 経過時間 = 1)
#DIMS 判定条件
#DIM 経過時間
#DIM 行番号

FOR 行番号, 0, DT_ROW_LENGTH("変身データベース")
	SIF STRFINDU(DT_CELL_GETS("変身データベース", 行番号, "解除タイミング文字列"), 判定条件) >= 0
		CONTINUE
	CALL 変身期間消費処理キャラ(DT_CELL_GET("変身データベース", 行番号, "キャラ番号"), 判定条件, 経過時間)
NEXT


@変身期間消費処理キャラ(キャラ番号, 判定条件, 経過時間 = 1)
#DIM キャラ番号
#DIMS 判定条件
#DIM 経過時間
#DIM 変身ID
#DIM 残りターン数

CALL 変身解除ABLE(キャラ番号, 判定条件)
SIF !RESULT
	RETURN

変身ID = FIND_変身ID(キャラ番号)
残りターン数 = GET_変身_変身残りターン数(変身ID)
;負の残りターン数だと自動解除されない
SIF 残りターン数 < 0
	RETURN

残りターン数 -= 経過時間
IF 残りターン数 <= 0
	CALL SET_変身_変身残りターン数(変身ID, 0)
	CALL 変身解除実行処理(キャラ番号)
ELSE
	CALL SET_変身_変身残りターン数(変身ID, 残りターン数)
ENDIF


@変身処理キャラ(キャラ番号, 判定条件)
#DIMS 判定条件
#DIM キャラ番号

CALL 変身ABLE(キャラ番号, 判定条件)
SIF !RESULT
	RETURN
CALL 変身実行処理(キャラ番号)


@変身解除処理キャラ(キャラ番号, 判定条件)
#DIMS 判定条件
#DIM キャラ番号

CALL 変身解除ABLE(キャラ番号, 判定条件)
SIF !RESULT
	RETURN
CALL 変身解除実行処理(キャラ番号)
