

@ダンジョン初期処理_異界と化した洞窟
;ダンジョン構造の読み込み
;0でない時、そのマスは存在する
#DIM 深度
#DIM 分岐

ダンジョンサブタイトル = THE OUTPOST OF SUCCUBUS
ダンジョンマス画像URL_伏せ状態 = 壁_遺跡
ダンジョン現在位置:0 = 1
ダンジョン現在位置:1 = 1
ダンジョン背景画像 = 背景_洞窟

;スタート地点は必ず存在
;初期からオープン済みなので3を入れる
;ビット0：存在するか　ビット1：移動できるか　ビット2：マスをオープンするか（ビット１をONにしないと無意味）　ビット3：入れないがオープンする場合に使用
;ビット4以降：自由枠。主に宝箱の開閉やイベント達成フラグなどに使用
IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}") == 0
	SETVAR @"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}", 3
ENDIF

FOR 深度, 1, 100
	LOCAL = 0
	FOR 分岐, 0, 9
		IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{深度}:{分岐}")
			;既にマス情報が入ってるなら飛ばす
			LOCAL = 1
			CONTINUE
		ELSEIF ENUMFUNCBEGINSWITH(@"ダンジョンマス情報_%ダンジョン名%_{深度}_{分岐}")
			LOCAL = 1
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:深度:分岐", 1
		ENDIF
	NEXT
	IF LOCAL
		ダンジョン最大深度 = 深度
	ENDIF
NEXT

@ダンジョン解説文_異界と化した洞窟

詳細文文字列受け渡し変数 = 
詳細文文字列受け渡し変数 += "性欲が強い顧客の確保。それはリゾートにとって好ましい申し出だ。<br>"
詳細文文字列受け渡し変数 += "あなたは航路の安全確保のために異世界の扉を潜った。<br>"
詳細文文字列受け渡し変数 += "「メーカネース・ナーヴィス」と呼ばれる異世界にて、異界と化した洞窟を探索する。<br>"
詳細文文字列受け渡し変数 += "<br>"
詳細文文字列受け渡し変数 += "ダンジョン出典：メーカネース・ナーヴィス<br>"

;推奨レベルを返す
RETURN 16

@敵討伐後処理_ダンジョン固有_異界と化した洞窟(討伐エネミー数)
#DIM 討伐エネミー数
;ダンジョン内で戦闘した後に呼ばれる関数、主にダンジョンごとのドロップアイテム取得に使用
;今回アイテムドロップはないので記述なし

;---------------------------------------------------------------------
;固有戦闘開始時処理
;---------------------------------------------------------------------
;ありかの加勢バフ
;---------------------------------------------------------------------
@固有戦闘開始時処理_特殊_ありかのサポート_異界洞窟()
;ここ２行はエラー回避のためのもの。おまじない程度においておくこと
戦闘行動キャラ = 0
CALL アビ対象選択テンプレート_自己のみ
;バフ付け文章は出さないので1を入れておく
アビテンプレート用_アビ名表示済フラグ = 1
;大元のバフセット（効果なし）
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = ありかのサポート_異界洞窟
アビ汎用文字列:バフ・デバフ対象能力 = ありかのサポート_異界洞窟
アビ汎用変数:持続ターン = -1
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:特殊表示オプション = 1
アビ汎用文字列:適用範囲 = 味方全体
CALL アビテンプレート_有利効果_バフ効果セット
;回避UP部分
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = ありかのサポート_異界洞窟_弱体耐性
アビ汎用文字列:バフ・デバフ対象能力 = 弱体耐性
アビ汎用変数:効果割合 = 30
アビ汎用文字列:適用範囲 = 味方全体
CALL アビテンプレート_有利効果_付随バフ効果セット("ありかのサポート_異界洞窟")
;カウンター部分
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = ありかのサポート_異界洞窟_再生
アビ汎用文字列:バフ・デバフ対象能力 = 再生
アビ汎用文字列:適用範囲 = 味方全体
アビ汎用変数:効果量 = 150
CALL アビテンプレート_有利効果_付随バフ効果セット("ありかのサポート_異界洞窟")

;メッセージは出さないのでここでリセット
CALL アビテンプレ変数リセット
@バフ・デバフ特殊表示_ありかのサポート_異界洞窟(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML ありかのサポート
PRINTFORML 弱体耐性+30％・再生150/ターン［消去不可］
PRINTFORML 持続ターン：永続

;---------------------------------------------------------------------
;マップ構造
;---------------------------------------------------------------------
;イベントミニマップなので一本道
;---------------------------------------------------------------------
;1マス目。入口。オーナー視点での主観を記載する。カワイイスパイスがガイド役
@ダンジョンマス情報_異界と化した洞窟_1_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 1
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 壁_洞窟
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_1")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 洞窟の入口だ。壁の輪郭が揺らめき、現実感がない。
			CALL 再視聴確認(1)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			CALL 口上変数初期化
			WSTR:(K++) = 異世界への門をくぐり、ピンク色のもやに包まれた洞窟内へと足を踏み入れた。
			WSTR:(K++) = メーカネース・ナーヴィス。話では星間文明と聞いていたが、空が見えないのでは実感が湧かない。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「やぁっ！　倒れてっ！」
			WSTR:(K++) = 洞窟の奥。少女の声が響く。どうやら先客がいるらしい。
			WSTR:(K++) = 加勢するのが望ましいだろう。ここは闇の気に満ちている。光属性の攻撃が有効なはずだ。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


;2マス目。戦闘導入。ここからありかのサポートバフ付与
@ダンジョンマス情報_異界と化した洞窟_6_1(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_カワイイスパイス
マス深度 = 6
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 壁_洞窟
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_7")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_異界と化した洞窟:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			CALL 口上変数初期化
			WSTR:(K++) = 洞窟を進むと、蓮の杖を持った魔法少女らしき少女が戦っていた。
			WSTR:(K++) = 敵は露出度の高い女性が二人。淫魔であった。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「新手！？」
			WSTR:(K++) = %CALLNAME:PLAYER%とその仲間たちは、少女を背に淫魔の前に躍り出る。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「分かった、ありがとう。状態異常に気をつけて！」
			WSTR:(K++) = 淫魔たちはニタニタと笑っている。戦闘開始だ！
			CALL メッセージ欄表示用関数(,,,0)
			戦闘時_特殊処理フラグ = ありかのサポート_異界洞窟
			敵BATTLE_STATE_STR:0:エネミー名 = Lv10_下級淫魔
			敵BATTLE_STATE_STR:2:エネミー名 = Lv10_下級淫魔
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				;立ち絵リソース記録に必要な画像のリソースを生成する
				CALLF 顔グラ表示用文字列関数(キャラ検索("[死と瘴気の魔女]カワイイスパイス"),100,,,1,1)
				立ち絵_カワイイスパイス = %立ち絵リソース記録%
				CALL 口上変数初期化
				WSTR:(K++) = 戦いが終わり、少女はほっとした表情でこちらを見た。
				WSTR:(K++) = 彼女の名前は、白瀬川ありかと言うらしい。新米の魔法少女だそうだ。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「増援が来るだなんて話、聞いてなかったんだけどね」
				WSTR:(K++) = %CALLNAME:PLAYER%は、偶然バッティングしたのだろうと答えた。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「でも、おかげで助かった。……行儀悪いけど、進みながら話そう」
				WSTR:(K++) = 少女は、スカートの裾をめくり、板状の小さな機械を取り出した。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = それにしても、異界、か。
				WSTR:(K++) = 依頼書によると「現実と重ね合わせるように、別の現実を配置される」行為らしいが。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = そのあたりの説明は、特にない。「わかれ」ということらしい。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「本部に連絡させて。想定以上に強い淫魔がいる」
				WSTR:(K++) = ありかが機械の表面を数度なぞると、グラマラスな女性の姿が空間に浮かんだ。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「ええと、あなたが例のリゾートのオーナーね？　話はピュリから聞いてます」
				CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
				CALL 口上変数初期化
				WSTR:(K++) = なるほど、依頼人だったようだ。
				WSTR:(K++) = 気さくな彼女は、こちらに向かって微笑みかけた。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「で、ありかちゃん。送られてきた数値を見た感じ、これはあなたの手に負えないと思う」
				CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 話を振られたありかは、不満げだ。
				WSTR:(K++) = 「ここまで来て撤退しろっていうんですか！？」
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「逆よ、逆。実戦経験積ませなきゃだし
				WSTR:(K++) = 　%CALLNAME:PLAYER%さんのパーティについていって欲しいなって」
				CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
				CALL 口上変数初期化
				WSTR:(K++) = ありかは「それはそうですけどぉ……」と目をそらす。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「ということで、%CALLNAME:PLAYER%さん。邪魔にはならないと思うから、後衛に置いといてもらえると」
				CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
				CALL 口上変数初期化
				WSTR:(K++) = そういうことなら、まあ。彼女の弱体耐性は頼りになる。
				WSTR:(K++) = %CALLNAME:PLAYER%は頷き、ありかをパーティに迎え入れた。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_異界と化した洞窟:マス深度:マス分岐, 4
			ENDIF
		ELSE
			戦闘時_特殊処理フラグ = ありかのサポート_異界洞窟
			敵BATTLE_STATE_STR:0:エネミー名 = Lv10_下級淫魔
			敵BATTLE_STATE_STR:2:エネミー名 = Lv10_下級淫魔
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

;3マス目。宝箱。遺留品。
@ダンジョンマス情報_異界と化した洞窟_6_7(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_カワイイスパイス
マス深度 = 6
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 壁_洞窟
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "1_7")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			CALLF 顔グラ表示用文字列関数(キャラ検索("[死と瘴気の魔女]カワイイスパイス"),100,,,1,1)
			立ち絵_カワイイスパイス = %立ち絵リソース記録%
			CALL 口上変数初期化
			WSTR:(K++) = 牢だ。無人だが、いくつかの道具がほったらかしにされている。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「ありかちゃん。遺留品の類はある？」
			CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
			CALL 口上変数初期化
			WSTR:(K++) = しっとりとした声で、カワイイスパイスは尋ねた。
			WSTR:(K++) = 衣服、アクセサリ、財布などが散らばっている。それらを、ありかはまとめる。
			WSTR:(K++) = 何をやっているのか、と%CALLNAME:PLAYER%が訪ねると、カワイイスパイスは答えてくれた。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「淫魔たちはヒトを捕らえて調教し、己の種族に同化するの
			WSTR:(K++) = 　同化が完全に進めば、大抵はヒトとしての暮らしができなくなる」
			CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「例外は何人も居るけどね。とにかく、彼らの遺物は回収して縁者に返さなくちゃいけないから」
			CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
			CALL 口上変数初期化
			WSTR:(K++) = それは……大変だ。
			WSTR:(K++) = 遺物の回収を手伝い、ありかに渡す。
			WSTR:(K++) = ありかはプロペラの付いた小さな機械にそれらを積載し、入口に向けて飛ばした。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「これで、大丈夫」
			WSTR:(K++) = 立ち上がり、先に進む。敵はまだまだ多い。気を引き締めなければ。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = めぼしいものはもうないようだ。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


;4マス目。戦闘。植物触手の導入。
@ダンジョンマス情報_異界と化した洞窟_1_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 1
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 壁_洞窟
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "1_3")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_異界と化した洞窟:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			CALL 口上変数初期化
			WSTR:(K++) = 「んっ……_H_んっ、んっふふふふ_H_」
			WSTR:(K++) = 洞窟の曲がり角。薄暗い中、何かが蠢いている。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「うげぇ」
			WSTR:(K++) = ありかはげんなりとした声を上げる。目線の先では淫魔が植物の触手に囲まれ、行為に至っていた。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「片付けよっか。触手を放っておくと異界化が進んじゃうし……」
			WSTR:(K++) = 仲間も無言で武器を向ける。お楽しみ中であろうが、知ったことか！
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			戦闘時_特殊処理フラグ = ありかのサポート_異界洞窟
			敵BATTLE_STATE_STR:3:エネミー名 = Lv10_下級淫魔
			敵BATTLE_STATE_STR:2:エネミー名 = Lv10_植物触手
			敵BATTLE_STATE_STR:4:エネミー名 = Lv10_植物触手
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = 「お゛っ」
				WSTR:(K++) = 倒された淫魔は、霞となって消滅した。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_異界と化した洞窟:マス深度:マス分岐, 4
			ENDIF
		ELSE
			戦闘時_特殊処理フラグ = ありかのサポート_異界洞窟
			敵BATTLE_STATE_STR:3:エネミー名 = Lv10_下級淫魔
			敵BATTLE_STATE_STR:2:エネミー名 = Lv10_植物触手
			敵BATTLE_STATE_STR:4:エネミー名 = Lv10_植物触手
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT


;5マス目。会話イベント。異界とは何か。魔法少女と魔女の関係。
@ダンジョンマス情報_異界と化した洞窟_1_3(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_カワイイスパイス
#DIMS 立ち絵_ピュリファイア
マス深度 = 1
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 壁_洞窟
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "5_3")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 洞窟の中腹。下水道と「重ね合わせ」られているようで、湿気が強い。
			CALL 再視聴確認(1)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			CALLF 顔グラ表示用文字列関数(キャラ検索("[死と瘴気の魔女]カワイイスパイス"),100,,,1,1)
			立ち絵_カワイイスパイス = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[苛烈なる浄化の魔女]ピュリファイア"),101,,,1,1)
			立ち絵_ピュリファイア = %立ち絵リソース記録%
			WSTR:(K++) = 洞窟の探索中。ありかの機械から、唐突に声が響く。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「ピュリぃっ！　だめっダメダメダメ、わたし仕事ちゅ――お゛っ――_H_！　_H__H_」
			CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ……音声も映像も、漏れてるんだけど……。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「あのヒトたち、いっつもこんな感じだから……」
			WSTR:(K++) = ありかは諦めたように、肩をすくめる。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「魔法少女を引退して魔女になったら、私もあんなふうになっちゃうのかな……」
			WSTR:(K++) = 小さく呟く。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = %CALLNAME:PLAYER%は、魔法少女と魔女の関係について尋ねた。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「強いて言うなら、ピュアな方が魔法少女。穢れを何度も受けた者が魔女、ですわね」
			CALL メッセージ欄表示用関数(立ち絵_ピュリファイア,"ピュリファイア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 新たな声。長身スレンダーな女が映像に現れた。名は、ピュリファイア。
			WSTR:(K++) = %CALLNAME:PLAYER%は、挨拶する。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「直接お会いするのは初めてですね。こちらこそよろしくお願いいたしますわ」
			CALL メッセージ欄表示用関数(立ち絵_ピュリファイア,"ピュリファイア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「先程の醜態につきましては……こちらではよくあることということで」
			CALL メッセージ欄表示用関数(立ち絵_ピュリファイア,"ピュリファイア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = よくあることなのか。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「ふふ、%CALLNAME:PLAYER%様のリゾートも、中々のものだと。ええ。楽しみでしてよ」
			CALL メッセージ欄表示用関数(立ち絵_ピュリファイア,"ピュリファイア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = そう言われては、返す言葉がない。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「まあ、それはそれとしましょう。
			WSTR:(K++) = 　ありかちゃんが送ってくれた解析によると、敵の塊はあと二つほど」
			CALL メッセージ欄表示用関数(立ち絵_ピュリファイア,"ピュリファイア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ゆめゆめ、油断なきように。最後にそう告げて、映像は途切れた。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


;6マス目。戦闘。ボス前哨戦。ややハードめに。
@ダンジョンマス情報_異界と化した洞窟_5_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 5
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 壁_洞窟
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "5_5")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_異界と化した洞窟:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = 敵だ。今度は数が多い。
			WSTR:(K++) = だが、これを凌ぎきれば終わりが見えてくる！
			CALL メッセージ欄表示用関数(,,,0)
			戦闘時_特殊処理フラグ = ありかのサポート_異界洞窟
			敵BATTLE_STATE_STR:0:エネミー名 = Lv10_植物触手
			敵BATTLE_STATE_STR:1:エネミー名 = Lv10_下級淫魔
			敵BATTLE_STATE_STR:2:エネミー名 = Lv10_植物触手
			敵BATTLE_STATE_STR:3:エネミー名 = Lv10_下級淫魔
			敵BATTLE_STATE_STR:4:エネミー名 = Lv10_下級淫魔
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = 立ちふさがる敵を撃破した。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_異界と化した洞窟:マス深度:マス分岐, 4
			ENDIF
		ELSE
			戦闘時_特殊処理フラグ = ありかのサポート_異界洞窟
			敵BATTLE_STATE_STR:0:エネミー名 = Lv10_植物触手
			敵BATTLE_STATE_STR:1:エネミー名 = Lv10_下級淫魔
			敵BATTLE_STATE_STR:2:エネミー名 = Lv10_植物触手
			敵BATTLE_STATE_STR:3:エネミー名 = Lv10_下級淫魔
			敵BATTLE_STATE_STR:4:エネミー名 = Lv10_下級淫魔
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

;7マス目。会話イベント。ボス前小休止。
@ダンジョンマス情報_異界と化した洞窟_5_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 5
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 壁_洞窟
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_5")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 最後の休憩地点だ。洞窟の奥からは甘い香りが漂ってくる。
			CALL 再視聴確認(1)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			WSTR:(K++) = 最後の休憩地点だ。洞窟の奥からは甘い香りが漂ってくる。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 背後を見る。ありかと%CALLNAME:PLAYER%の仲間は、頷いた。
			WSTR:(K++) = 準備や回復は入念に行おう。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

;8マス目。ボス戦。寸劇を挟むこと。
@ダンジョンマス情報_異界と化した洞窟_4_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 壁_洞窟
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン_赤
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "3_5")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 強敵はすでに倒した。
			CALL 再視聴確認(1)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			WSTR:(K++) = 「うっ、ううっ！」
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 洞窟の最奥。薄暗い魔力灯の下、数名の淫魔が嘆いていた。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「死！　死！　重なる死！　必死の抵抗虚しくアタシたち淫魔は死んで！　死んで！　死んで……！」
			WSTR:(K++) = 群れの中央。錦鯉のタトゥーを肩に刻んだ淫魔。声を張り上げる。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「死んで……死んで150年！　150年……魔法少女に殺られ続け！　最早淫魔は死にゆく種族……！」
			WSTR:(K++) = 周りの淫魔も同調する。涙を流し、訴えかける。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「そうだ……そうだ！　アタシの姉さまも魔法少女の魔の手に……！」
			WSTR:(K++) = 「ママも魔法少女に殺された！　女子供十人ぽっち同化しただけで……血も涙もない！」
			WSTR:(K++) = 「救いは……淫魔に救いはにゃあのか！？　わっちら、このまま死……死んで……ッ」
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = なんだか、変に盛り上がっている。付き合っていられない。%CALLNAME:PLAYER%は、奇襲を提案した。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「あ　な　た　達　、　大　馬　鹿　者　ね！？　この前哨基地は――」
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = その瞬間、錦鯉タトゥー淫魔の首元めがけ、魔法矢が飛んでいく。
			WSTR:(K++) = 魔法矢は淫魔の手のひらで受け止められた。ダメージは入ったな、と、%CALLNAME:PLAYER%はありかを褒めた。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「あーあ、いいところだったのに」
			WSTR:(K++) = 両陣、戦闘準備を整える。錦鯉タトゥーの淫魔は、その身に魔力を立ち上らせた。
			WSTR:(K++) = 「あなた達も、アタシと同じにしてあげる」
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = これまでの敵とは格が違う！　全力でかかれ！
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
			戦闘時_特殊処理フラグ = ありかのサポート_異界洞窟
			敵BATTLE_STATE_STR:0:エネミー名 = Lv15_錦鯉タトゥーの淫魔
			敵BATTLE_STATE_STR:4:エネミー名 = Lv10_植物触手
			敵BATTLE_STATE_STR:5:エネミー名 = Lv10_下級淫魔
			CALL 雑魚敵遭遇汎用処理
			IF RESULT != 0 && GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
				ダンジョン現在位置:0 = 5
				ダンジョン現在位置:1 = 5
				RETURN 0
			ENDIF
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



;9マス目。会話イベント。攻略報酬。
@ダンジョンマス情報_異界と化した洞窟_3_5(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_カワイイスパイス
#DIMS 立ち絵_ピュリファイア
マス深度 = 3
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 壁_洞窟
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 航路上の淫魔を滅ぼし、新たなリゾートの顧客を獲得した。
			CALL 再視聴確認(1)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[死と瘴気の魔女]カワイイスパイス"),100,,,1,1)
			立ち絵_カワイイスパイス = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[苛烈なる浄化の魔女]ピュリファイア"),101,,,1,1)
			立ち絵_ピュリファイア = %立ち絵リソース記録%
			WSTR:(K++) = 「オブリビオン・インダストリーズが黙ってはいませんよ」
			WSTR:(K++) = 息も絶え絶えな淫魔。どこかで聞いたような捨て台詞。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「ああ、そこの残党か。いいよ、こっちの経済規模的に怖くないし。ありかちゃん、消していいよ」
			CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 白瀬川ありかは、再び魔力矢を放つ。眉間に直撃し、錦鯉タトゥーの淫魔は消滅した。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「お疲れ様でした。これで、依頼は終了ですね」
			CALL メッセージ欄表示用関数(立ち絵_ピュリファイア,"ピュリファイア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「報酬は、今しがた配下の魔法少女に運ばせました。シェロカルテ様経由で渡るものかと」
			CALL メッセージ欄表示用関数(立ち絵_ピュリファイア,"ピュリファイア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ……ところで、ルピ支払いなのだろうか？
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「初回は同価値の金塊で。
			WSTR:(K++) = 　次回があれば、その頃には交易も進んでいるでしょうから、ルピで支払えますよ」
			CALL メッセージ欄表示用関数(立ち絵_ピュリファイア,"ピュリファイア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 金塊であれば、さしたる苦労なく換金できるだろう。ありがたい限りだ。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「にしても、リゾートかぁ。大丈夫かな。私、半淫魔なんだけど」
			CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 客を同化したりしなければ、大丈夫。多分。星晶獣eraは「来てもいい」と言ってる。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「あ、そう？　だったら近々行くよ。楽しみー！」
			CALL メッセージ欄表示用関数(立ち絵_カワイイスパイス,"カワイイスパイス",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ともかく。
			WSTR:(K++) = メーカネース・ナーヴィスの住人が、リゾートに遊びに来てくれるようになった。
			WSTR:(K++) = これから忙しくなりそうだ！
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 口上変数初期化
			MONEY += 80000
			WSTR:(K++) = %CALLNAME:PLAYER%は依頼報酬として８万ルピを手に入れた！
			WSTR:(K++) = [死と瘴気の魔女]カワイイスパイスがリゾートを訪れるようになった！
			WSTR:(K++) = [苛烈なる浄化の魔女]ピュリファイアがリゾートを訪れるようになった！
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CFLAG:(キャラ検索("[死と瘴気の魔女]カワイイスパイス")):招待不可フラグ = 0
			CFLAG:(キャラ検索("[苛烈なる浄化の魔女]ピュリファイア")):招待不可フラグ = 0
			ダンジョン終了状況 = 踏破達成
			ダンジョンクリアフラグ_異界と化した洞窟 = 1
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT