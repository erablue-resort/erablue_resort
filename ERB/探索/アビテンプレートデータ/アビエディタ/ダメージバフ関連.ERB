
@アビエディタ_ダメージ効果追加(変更ID = 0, アビ段階 = 0)
;アビ文字列１ ダメージ倍率に使用する能力値
;アビ文字列２
;アビ文字列３
;アビ文字列４
;アビ文字列５
;アビ数値１ ダメージ倍率
;アビ数値２ ダメージ固定値
;アビ数値３ ダメージ属性
;アビ数値４ ダメージ回数
;アビ数値５
#DIM 効果順番
#DIM DYNAMIC ダメージ倍率
#DIM DYNAMIC ダメージ固定値
#DIM DYNAMIC ダメージ属性
#DIM DYNAMIC ダメージ回数
#DIMS DYNAMIC ダメージ能力値
#DIMS DYNAMIC ダメージ対象
#DIM アビ段階
#DIM ダメージモード
#DIM 変更ID
#DIMS HTML文字列

;効果の最初かどうかを判定
IF 変更ID == 0
	;アビ段階が同じ効果がある、かつ新規効果追加状態＝最初ではない
	LOCAL = DT_SELECT("アビエディタデータベース", @"アビ段階 = {アビ段階}")
	効果順番 = LOCAL
ELSE
	;既存効果変更の場合、行数を見る
	FOR LOCAL, 0, DT_ROW_LENGTH("アビエディタデータベース")
		IF DT_CELL_GET("アビエディタデータベース", LOCAL, "id") == 変更ID
			効果順番 = LOCAL
			BREAK
		ENDIF
	NEXT
ENDIF

IF 変更ID
	ダメージ対象 '= DT_CELL_GETS("アビエディタデータベース", 変更ID, "アビ対象", 1)
	ダメージ倍率 = DT_CELL_GET("アビエディタデータベース", 変更ID, "アビ数値１", 1)
	ダメージ固定値 = DT_CELL_GET("アビエディタデータベース", 変更ID, "アビ数値２", 1)
	ダメージ属性 = DT_CELL_GET("アビエディタデータベース", 変更ID, "アビ数値３", 1)
	ダメージ回数 = DT_CELL_GET("アビエディタデータベース", 変更ID, "アビ数値４", 1)
	ダメージ能力値 '= DT_CELL_GETS("アビエディタデータベース", 変更ID, "アビ文字列１", 1)
	アビ段階 = DT_CELL_GET("アビエディタデータベース", 変更ID, "アビ段階", 1)
ENDIF
IF ダメージ対象 == ""
	IF 効果順番 < 1
		ダメージ対象 = 敵単体
	ELSE
		ダメージ対象 = 上と同じ相手
	ENDIF
ENDIF
SIF ダメージ回数 < 1
	ダメージ回数 = 1
SIF ダメージ能力値 == ""
	ダメージ能力値 = 攻撃力
SIF ダメージ倍率 == 0
	ダメージ倍率 = 100

$動作LOOP

DRAWLINE
PRINTL ダメージ効果の設定を選択してください。
DRAWLINE

PRINTL ・現在の効果
PRINT 　　
PRINTFORM %ダメージ対象%に
IF ダメージモード == 0
	PRINTFORM ［%ダメージ能力値%✕{ダメージ倍率}％］の
ELSE
	PRINTFORM ［{ダメージ固定値}］の
ENDIF
IF ダメージ属性 < 0
	PRINT 自属性ダメージを
ELSE
	SETCOLOR カラーパレット(@"%属性数値文字列変換(ダメージ属性)%属性")
	PRINTFORM %属性数値文字列変換(ダメージ属性)%属性
	RESETCOLOR
	PRINT ダメージを
ENDIF
IF ダメージ回数 < 2
	PRINT 与える。
ELSE
	PRINTFORM {ダメージ回数}回与える。
ENDIF
PRINTL
DRAWLINE

HTML文字列 = 
HTML文字列 += "<div rect='50, 0, 5000, 3000' padding='50,25,50' color='#101010' border='31' bcolor='#C0C0C0'><nobr>"
HTML文字列 += @"<button value='1'>[1] ダメージ対象を変更する</button>　　　　現在：%ダメージ対象%<br>"
IF ダメージモード == 0
	HTML文字列 += @"<button value='2'>[2] 使用する能力値を変更する</button>　　　現在：%ダメージ能力値%<br>"
	HTML文字列 += @"<button value='3'>[3] ダメージ倍率を変更する</button>　　　　現在：{ダメージ倍率}％<br>"
ELSE
	HTML文字列 += @"<button value='3'>[3] ダメージ値を変更する</button>　　　　　現在：{ダメージ固定値}<br>"
ENDIF
IF ダメージ属性 < 0
	HTML文字列 += @"<button value='4'>[4] ダメージの属性を変更する</button>　　　現在：自属性<br>"
ELSE
	HTML文字列 += @"<button value='4'>[4] ダメージの属性を変更する</button>　　　現在：<font color='#%カラーパレット_HTML(@"%属性数値文字列変換(ダメージ属性)%属性")%'>%属性数値文字列変換(ダメージ属性)%属性</font><br>"
ENDIF
HTML文字列 += @"<button value='5'>[5] ダメージの回数を変更する</button>　　　現在：{ダメージ回数}回<br>"
HTML文字列 += "<br>"
HTML文字列 += "<br>"
HTML文字列 += @"<button value='998'>[998] この設定で効果を決定する</button><br>"
HTML文字列 += @"<button value='999'>[999] 保存せず戻る</button><br>"
HTML文字列 += "</div>"


HTML_PRINT HTML文字列, 1
FOR LOCAL, 0, 35
	PRINTL
NEXT

BINPUT
PRINTL
PRINTL
SELECTCASE RESULT
	CASE 1
		CALL アビエディタ_対象選択(ダメージ対象, 効果順番)
	CASE 2
		DRAWLINE
		PRINTFORML 使用する能力値を選択してください。 現在：%ダメージ能力値%
		PRINTL
		FOR LOCAL, 6, 10
			PRINTBUTTON @"[{LOCAL}] %ERDNAME(基礎BATTLE_STATE, LOCAL)%", LOCAL
			PRINTL
		NEXT
		BINPUT
		PRINTL
		PRINTL
		ダメージ能力値 '= ERDNAME(基礎BATTLE_STATE, RESULT)
	CASE 3
		DRAWLINE
		IF ダメージモード == 0
			PRINTFORML ダメージ倍率を入力してください。 現在：{ダメージ倍率}
		ELSE
			PRINTFORML ダメージ値を入力してください。 現在：{ダメージ固定値}
		ENDIF
		PRINTL
		INPUT
		IF RESULT < 1
			PRINTW ０や負の値は指定出来ません
		ENDIF
		IF ダメージモード == 0
			ダメージ倍率 = RESULT
		ELSE
			ダメージ固定値 = RESULT
		ENDIF
	CASE 4
		DRAWLINE
		PRINT ダメージの属性を選択してください。 現在：
		IF ダメージ属性 < 0
			PRINT 自属性
		ELSE
			PRINTFORM %属性数値文字列変換(ダメージ属性)%属性
		ENDIF
		PRINTL
		PRINTL
			PRINTBUTTON @"[-1] 自属性", -1
			PRINTL
		FOR LOCAL, 0, 7
			SETCOLOR カラーパレット(@"%属性数値文字列変換(LOCAL)%属性")
			PRINTBUTTON @"[{LOCAL}] %属性数値文字列変換(LOCAL)%属性", LOCAL
			PRINTL
		NEXT
		RESETCOLOR
		BINPUT
		PRINTL
		PRINTL
		ダメージ属性 = RESULT
	CASE 5
		DRAWLINE
		PRINTFORML ダメージの回数を入力してください。 現在：{ダメージ回数}回
		PRINTL
		INPUT
		IF RESULT < 1
			PRINTW ０や負の値は指定出来ません
		ENDIF
		ダメージ回数 = RESULT
	CASE 998
		IF 変更ID
			;既存効果変更
			DT_CELL_SET "アビエディタデータベース", 変更ID, "アビ対象", ダメージ対象, 1
			DT_CELL_SET "アビエディタデータベース", 変更ID, "アビ数値３", ダメージ属性, 1
			DT_CELL_SET "アビエディタデータベース", 変更ID, "アビ数値４", ダメージ回数, 1
			IF ダメージモード == 0
				DT_CELL_SET "アビエディタデータベース", 変更ID, "アビ文字列１", ダメージ能力値, 1
				DT_CELL_SET "アビエディタデータベース", 変更ID, "アビ数値１", ダメージ倍率, 1
				DT_CELL_SET "アビエディタデータベース", 変更ID, "アビ数値２", 0, 1
			ELSE
				DT_CELL_SET "アビエディタデータベース", 変更ID, "アビ数値２", ダメージ固定値, 1
				DT_CELL_SET "アビエディタデータベース", 変更ID, "アビ文字列１", "", 1
				DT_CELL_SET "アビエディタデータベース", 変更ID, "アビ数値１", 0, 1
			ENDIF
			PRINTW ダメージ効果を変更しました。
		ELSE
			;新規効果追加
			IF ダメージモード == 0
				DT_ROW_ADD "アビエディタデータベース", "効果順番", 効果順番, "アビ段階", アビ段階, "アビ効果種別", "ダメージ効果", "アビ対象", ダメージ対象, "アビ文字列１", ダメージ能力値, "アビ数値１", ダメージ倍率, "アビ数値３", ダメージ属性, "アビ数値４", ダメージ回数
			ELSE
				DT_ROW_ADD "アビエディタデータベース", "効果順番", 効果順番, "アビ段階", アビ段階, "アビ効果種別", "ダメージ効果", "アビ対象", ダメージ対象, "アビ数値２", ダメージ固定値, "アビ数値３", ダメージ属性, "アビ数値４", ダメージ回数
			ENDIF
			PRINTW 新しいダメージ効果を追加しました。
		ENDIF
		RETURN 1
	CASE 999
		RETURN 0
ENDSELECT

GOTO 動作LOOP
