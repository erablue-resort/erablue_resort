;作成中


@USERCOM関数_804(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 能力表示(マスター)
	CASE "コマンド表示"
		PRINTC 能力表示(マスター)[804]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示したら1を返す
		RETURN 1
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		CALL PRINT_STATE(MASTER)
		RETURN 1
ENDSELECT


@USERCOM関数_820(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 服を脱ぐ
	CASE "コマンド表示"
		PRINTC 服を脱ぐ[820]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示したら1を返す
		SIF CFLAG:うふふ && TARGET > 0 && TALENT:PLAYER:脱衣不可 == 0
			RETURN 1
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		IF CFLAG:うふふ
			CALL CLOTHES_SETTING_TRAIN(PLAYER)
		ENDIF
		RETURN 1
ENDSELECT


@USERCOM関数_999(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 逢引終了
	CASE "コマンド表示"
		IF CFLAG:うふふ == 2
			PRINTC 抜け出す[999]
		ELSE
			PRINTC 逢引終了[999]
		ENDIF
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		IF CFLAG:うふふ && TARGET > 0
			RETURN 1
		ELSE
			RETURN 0
		ENDIF
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		IF CFLAG:うふふ
			IF 連れ込みパターン != ""
				PRINTFORMW %CALLNAME:(TARGET)%が離してくれない…
				CALL KOJO_EVENT, 13, TARGET, 1
			ELSE
				CALL うふふ終了処理("通常終了")
			ENDIF
		ENDIF
		RETURN 1
ENDSELECT


@USERCOM関数_998(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 飲み会終了
	CASE "コマンド表示"
		PRINTC 飲み会終了[998]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		IF CFLAG:飲み会 && TARGET > 0
			RETURN 1
		ELSE
			RETURN 0
		ENDIF
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		IF CFLAG:飲み会
			CALL 飲み会終了処理()
		ENDIF
		RETURN 1
ENDSELECT


@USERCOM関数_830(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 探索系情報一覧
	CASE "コマンド表示"
		PRINTC 探索系情報一覧[830]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		RETURN 1
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		表示切り替え文字列 = 探索集約_探索メンバー
		CALL 探索系集約表示
		RETURN 1
ENDSELECT


@USERCOM関数_831(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 覗き見
	CASE "コマンド表示"
		PRINTC 覗き見[831]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		IF イベント完了フラグ確認("使い魔の創造")
			RETURN 1
		ELSE
			RETURN 0
		ENDIF
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		表示切り替え文字列 = 覗き見一覧
		CALL 覗き見一覧表示
		RETURN 1
ENDSELECT


@USERCOM関数_840(動作モード)
#DIMS 動作モード
#DIM 同行者フラグ

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 物陰に隠れる
	CASE "コマンド表示"
		同行者フラグ = 0
		FOR LOCAL, 1, CHARANUM
			SIF TARGET:LOCAL < 1
				BREAK
			SIF CFLAG:(TARGET:LOCAL):同行 || CFLAG:(TARGET:LOCAL):うふふ
				同行者フラグ = 1
		NEXT

		SIF !同行者フラグ && !CFLAG:MASTER:隠密
			PRINTC 物陰に隠れる[840]
		SIF 同行者フラグ && !CFLAG:MASTER:隠密
			PRINTC 一緒に隠れる[840]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		IF CFLAG:MASTER:隠密
			RETURN 0
		ELSE
			RETURN 1
		ENDIF
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		CFLAG:MASTER:隠密 = 1
		FOR LOCAL, 1, CHARANUM
			SIF TARGET:LOCAL < 1
				BREAK
			SIF CFLAG:(TARGET:LOCAL):同行 || CFLAG:(TARGET:LOCAL):うふふ
				CFLAG:(TARGET:LOCAL):隠密 = 1
		NEXT
		RETURN 1
ENDSELECT


@USERCOM関数_841(動作モード)
#DIMS 動作モード
#DIM 同行者フラグ

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 物陰から出る
	CASE "コマンド表示"
		PRINTC 物陰から出る[841]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		同行者フラグ = 0
		FOR LOCAL, 1, CHARANUM
			SIF TARGET:LOCAL < 1
				BREAK
			SIF CFLAG:(TARGET:LOCAL):同行 || CFLAG:(TARGET:LOCAL):うふふ
				同行者フラグ = 1
		NEXT

		IF CFLAG:MASTER:隠密 && (!CFLAG:うふふ || GET_TARGETNUM() == 同行者フラグ)
			RETURN 1
		ELSE
			RETURN 0
		ENDIF
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		IF 連れ込みパターン != ""
			PRINTFORMW %CALLNAME:TARGET%が離してくれない…
			CALL KOJO_EVENT, 13, TARGET, 1
		ELSE
			CFLAG:MASTER:隠密 = 0
			FOR LOCAL, 1, CHARANUM
				SIF TARGET:LOCAL < 1
					BREAK
				SIF CFLAG:(TARGET:LOCAL):同行 || CFLAG:(TARGET:LOCAL):うふふ
					CFLAG:(TARGET:LOCAL):隠密 = 0
			NEXT
			PREVCOM = 841
		ENDIF
		RETURN 1
ENDSELECT


@USERCOM関数_850(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = アイテム使用
	CASE "コマンド表示"
		IF TARGET
			PRINTC アイテム使用[850]
		ELSE
			PRINTC 自分にアイテム使用[850]
		ENDIF
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		RETURN 1
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		CALL ITEM_PROTO(TARGET)
		RETURN 1
ENDSELECT


@USERCOM関数_856(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 写真一覧
	CASE "コマンド表示"
		PRINTC 写真一覧[856]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		RETURN 1
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		CALL 所持写真一覧表示
		RETURN 1
ENDSELECT


@USERCOM関数_892(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 連れ込み禁止
	CASE "コマンド表示"
		IF OPTION変数:連れ込み制御
			SETCOLOR カラーパレット("黄")
			PRINTBUTTONC "連れ込み禁止:ON[892]", 892
			RESETCOLOR
		ELSE
			PRINTBUTTONC "連れ込み禁止:OFF[892]", 892
		ENDIF
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		RETURN 1
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		INVERTBIT OPTION変数:連れ込み制御, 0
		RETURN 1
ENDSELECT


@USERCOM関数_893(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 休憩時訪問禁止
	CASE "コマンド表示"
		IF OPTION変数:休憩制御
			SETCOLOR カラーパレット("黄")
			PRINTBUTTONC "休憩時訪問禁止:ON[893]", 893
			RESETCOLOR
		ELSE
			PRINTBUTTONC "休憩時訪問禁止:OFF[893]", 893
		ENDIF
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		RETURN 1
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		INVERTBIT OPTION変数:休憩制御, 0
		RETURN 1
ENDSELECT


@USERCOM関数_860(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = キャラ居場所感知
	CASE "コマンド表示"
		PRINTC キャラ居場所感知[860]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		IF あなた特殊能力:居場所感知
			RETURN 1
		ELSE
			RETURN 0
		ENDIF
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		CALL キャラ居場所感知処理
		RETURN 1
ENDSELECT


@USERCOM関数_861(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 雇用レポート
	CASE "コマンド表示"
		PRINTC 雇用レポート[861]
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		RETURN 1
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		CALL 雇用レポート表示
		RETURN 1
ENDSELECT


@USERCOM関数_895(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 挿入最適化
	CASE "コマンド表示"
		IF あなた挿入最適化フラグ
			SETCOLOR カラーパレット("黄")
			PRINTBUTTONC "挿入最適化:ON[895]", 895
			RESETCOLOR
		ELSE
			PRINTBUTTONC "挿入最適化:OFF[895]", 895
		ENDIF
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		IF PLAYER == MASTER && ABL:PLAYER:腰使い > 4
			RETURN 1
		ELSE
			RETURN 0
		ENDIF
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		INVERTBIT あなた挿入最適化フラグ, 0
		RETURN 1
ENDSELECT


@USERCOM関数_821(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 登録先移動１
	CASE "コマンド表示"
		IF CFLAG:MASTER:現在マップ種別 == FLAG:登録先移動１_移動マップ種別 && CFLAG:MASTER:現在位置 == FLAG:登録先移動１_移動位置
			PRINTFORMC 位置削除：%GETPLACENAME(FLAG:登録先移動１_移動マップ種別, FLAG:登録先移動１_移動位置)%[821]
		ELSEIF FLAG:登録先移動１_移動位置 != 0
			PRINTFORMC 移動：%GETPLACENAME(FLAG:登録先移動１_移動マップ種別, FLAG:登録先移動１_移動位置)%[821]
		ELSE
			IF 存在しない移動先(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置)
				SETCOLOR カラーパレット("グレーアウト")
				PRINTPLAIN 　　　　位置登録不可[821]
				RESETCOLOR
			ELSEIF FLAG:お出かけ先フラグ
				SETCOLOR カラーパレット("グレーアウト")
				PRINTPLAIN 　　　　位置登録不可[821]
				RESETCOLOR
			ELSE
				PRINTFORMC 位置登録：%GETPLACENAME(CFLAG:MASTER:現在マップ種別, CFLAG:MASTER:現在位置)%[821]
			ENDIF
		ENDIF
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		SIF !CFLAG:PLAYER:うふふ && !CFLAG:PLAYER:飲み会
			RETURN 1
		;移動先が0になることはないのでこれで良いはず
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		IF CFLAG:MASTER:現在マップ種別 == FLAG:登録先移動１_移動マップ種別 && CFLAG:MASTER:現在位置 == FLAG:登録先移動１_移動位置
			CALL 位置削除処理(GETNUM(FLAG, "登録先移動１_移動マップ種別"), GETNUM(FLAG, "登録先移動１_移動位置"))
			RETURN 1
		ELSEIF FLAG:登録先移動１_移動位置 != 0
			CALL 登録移動処理(FLAG:登録先移動１_移動マップ種別, FLAG:登録先移動１_移動位置)
			RETURN RESULT
		ELSE
			CALL 位置登録処理(GETNUM(FLAG, "登録先移動１_移動マップ種別"), GETNUM(FLAG, "登録先移動１_移動位置"))
			RETURN 1
		ENDIF
ENDSELECT


@USERCOM関数_822(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 登録先移動２
	CASE "コマンド表示"
		IF CFLAG:MASTER:現在マップ種別 == FLAG:登録先移動２_移動マップ種別 && CFLAG:MASTER:現在位置 == FLAG:登録先移動２_移動位置
			PRINTFORMC 位置削除：%GETPLACENAME(FLAG:登録先移動２_移動マップ種別, FLAG:登録先移動２_移動位置)%[822]
		ELSEIF FLAG:登録先移動２_移動位置 != 0
			PRINTFORMC 移動：%GETPLACENAME(FLAG:登録先移動２_移動マップ種別, FLAG:登録先移動２_移動位置)%[822]
		ELSE
			IF 存在しない移動先(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置)
				SETCOLOR カラーパレット("グレーアウト")
				PRINTPLAIN 　　　　位置登録不可[822]
				RESETCOLOR
			ELSEIF FLAG:お出かけ先フラグ
				SETCOLOR カラーパレット("グレーアウト")
				PRINTPLAIN 　　　　位置登録不可[822]
				RESETCOLOR
			ELSE
				PRINTFORMC 位置登録：%GETPLACENAME(CFLAG:MASTER:現在マップ種別, CFLAG:MASTER:現在位置)%[822]
			ENDIF
		ENDIF
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		SIF !CFLAG:PLAYER:うふふ && !CFLAG:PLAYER:飲み会
			RETURN 1
		;移動先が0になることはないのでこれで良いはず
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		IF CFLAG:MASTER:現在マップ種別 == FLAG:登録先移動２_移動マップ種別 && CFLAG:MASTER:現在位置 == FLAG:登録先移動２_移動位置
			CALL 位置削除処理(GETNUM(FLAG, "登録先移動２_移動マップ種別"), GETNUM(FLAG, "登録先移動２_移動位置"))
			RETURN 1
		ELSEIF FLAG:登録先移動２_移動位置 != 0
			CALL 登録移動処理(FLAG:登録先移動２_移動マップ種別, FLAG:登録先移動２_移動位置)
			RETURN RESULT
		ELSE
			CALL 位置登録処理(GETNUM(FLAG, "登録先移動２_移動マップ種別"), GETNUM(FLAG, "登録先移動２_移動位置"))
			RETURN 1
		ENDIF
ENDSELECT


@USERCOM関数_823(動作モード)
#DIMS 動作モード

SELECTCASE 動作モード
	CASE "コマンド名"
		TSTR:コマンド名受渡 = 登録先移動３
	CASE "コマンド表示"
		IF CFLAG:MASTER:現在マップ種別 == FLAG:登録先移動３_移動マップ種別 && CFLAG:MASTER:現在位置 == FLAG:登録先移動３_移動位置
			PRINTFORMC 位置削除：%GETPLACENAME(FLAG:登録先移動３_移動マップ種別, FLAG:登録先移動３_移動位置)%[823]
		ELSEIF FLAG:登録先移動３_移動位置 != 0
			PRINTFORMC 移動：%GETPLACENAME(FLAG:登録先移動３_移動マップ種別, FLAG:登録先移動３_移動位置)%[823]
		ELSE
			IF 存在しない移動先(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置)
				SETCOLOR カラーパレット("グレーアウト")
				PRINTPLAIN 　　　　位置登録不可[823]
				RESETCOLOR
			ELSEIF FLAG:お出かけ先フラグ
				SETCOLOR カラーパレット("グレーアウト")
				PRINTPLAIN 　　　　位置登録不可[823]
				RESETCOLOR
			ELSE
				PRINTFORMC 位置登録：%GETPLACENAME(CFLAG:MASTER:現在マップ種別, CFLAG:MASTER:現在位置)%[823]
			ENDIF
		ENDIF
	CASE "コマンド条件"
		;コマンドの表示条件を処理する
		;表示するなら1を返す
		SIF !CFLAG:PLAYER:うふふ && !CFLAG:PLAYER:飲み会
			RETURN 1
		;移動先が0になることはないのでこれで良いはず
	CASE "コマンド動作"
		;コマンド選択時の動作を処理する
		IF CFLAG:MASTER:現在マップ種別 == FLAG:登録先移動３_移動マップ種別 && CFLAG:MASTER:現在位置 == FLAG:登録先移動３_移動位置
			CALL 位置削除処理(GETNUM(FLAG, "登録先移動３_移動マップ種別"), GETNUM(FLAG, "登録先移動３_移動位置"))
			RETURN 1
		ELSEIF FLAG:登録先移動３_移動位置 != 0
			CALL 登録移動処理(FLAG:登録先移動３_移動マップ種別, FLAG:登録先移動３_移動位置)
			RETURN RESULT
		ELSE
			CALL 位置登録処理(GETNUM(FLAG, "登録先移動３_移動マップ種別"), GETNUM(FLAG, "登録先移動３_移動位置"))
			RETURN 1
		ENDIF
ENDSELECT


@位置登録処理(移動マップ種別_キー, 移動位置_キー)
#DIM 移動マップ種別_キー
#DIM 移動位置_キー

PRINTFORML 現在の位置（%GETPLACENAME(CFLAG:MASTER:現在マップ種別, CFLAG:MASTER:現在位置)%）をこのコマンドの移動先として登録しますか？
PRINTBUTTONLC "[0]はい", 0
PRINTBUTTONLC "[1]いいえ", 1
PRINTL

BINPUT
IF RESULT == 0
	FLAG:移動マップ種別_キー = CFLAG:MASTER:現在マップ種別
	FLAG:移動位置_キー = CFLAG:MASTER:現在位置
	PRINTFORMW 「%GETPLACENAME(CFLAG:MASTER:現在マップ種別, CFLAG:MASTER:現在位置)%」をこのコマンドの移動先として登録しました。
ENDIF


@位置削除処理(移動マップ種別_キー, 移動位置_キー)
#DIM 移動マップ種別_キー
#DIM 移動位置_キー

PRINTFORML このコマンドの移動先（%GETPLACENAME(FLAG:移動マップ種別_キー, FLAG:移動位置_キー)%）の登録を解除しますか？
PRINTBUTTONLC "[0]はい", 0
PRINTBUTTONLC "[1]いいえ", 1
PRINTL

BINPUT
IF RESULT == 0
	FLAG:移動マップ種別_キー = 0
	FLAG:移動位置_キー = 0
	PRINTFORMW このコマンドの移動先登録を解除しました。
ENDIF


@登録移動処理(移動マップ, 移動位置)
#DIM 移動マップ
#DIM 移動位置
#DIM 入力数値

;クイック移動処理
; SIF CFLAG:MASTER:現在マップ種別 == 移動マップ && CFLAG:MASTER:現在位置 == 移動位置
; 	RETURN 1
RFLAG:サイドボタン操作 = 1
IF CFLAG:PLAYER:現在マップ種別 == 移動マップ
	RESULTS = サイド領域_{移動位置}
ELSE
	;まずエリア移動
	TFLAG:SELECTCOM受け渡し = 400
	SELECTCOM = 400
	TFLAG:エリア切り替え時_目的地格納 = 100 + 移動マップ
	CALL COM400
	;どっかで立ち止まったなら以降の処理キャンセル
	SIF RFLAG:立ち止まらないフラグ < 0
		RETURN 1
	;次にエリア内移動
	IF 移動位置 != CFLAG:MASTER:現在位置
		RESULTS = サイド領域_{移動位置}
	ENDIF
ENDIF


入力数値 = 0
入力数値 = TOINT(REPLACE(RESULTS, "サイド領域_", ""))
SIF 入力数値 == 0
	RETURN 1

CALL 表示マップ切り替え判定(入力数値)
LOCAL = RESULT
IF 入力数値 == 99
	;エリア移動選択
	IF RFLAG:追跡フラグ
		;追跡中は自動で移動
		RESULT = 1
	ELSE
		CALL エリア移動選択画面表示
	ENDIF
	IF RESULT == -1
		;移動しない場合
		RETURN 1
	ELSEIF RESULT == 1
		;移動処理へ進む
		サイド描画横スクロール保存 = 0
		CALL COM400
		SELECTCOM = 400
		TFLAG:SELECTCOM受け渡し = 400
		SIF RESULT == -1
			RETURN -1
		RETURN 0
	ENDIF
ELSEIF CFLAG:PLAYER:現在位置 == 入力数値
	RETURN 1
ELSEIF LOCAL
	サイド描画横スクロール保存 = 0
	RETURN 1
ELSEIF 存在しない移動先(CFLAG:PLAYER:現在マップ種別, 入力数値)
	RETURN 1
ELSEIF 存在しない移動先(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置)
	;商業区や居住区の個別部屋にいると考えられるので、即座に移動する
	CFLAG:MASTER:現在位置 = 入力数値
ELSE
	;目的地が離れているので、最終目的地として設定
	TFLAG:長距離移動時_目的地格納 = 入力数値
	CALL SKIP_MOVE(CFLAG:PLAYER:現在マップ種別, 入力数値)
	;現在位置を更新し、次も移動の扱いにする
	CFLAG:MASTER:現在位置 = RESULT
	TIME += 1
	TFLAG:SELECTCOM受け渡し = 400
	SELECTCOM = 400
	CALL COM400
	SIF RESULT == -1
		RETURN -1
	RETURN 0
ENDIF
;移動処理
TIME += 1
TFLAG:SELECTCOM受け渡し = 400
SELECTCOM = 400

RETURN 0
