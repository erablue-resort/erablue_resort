
@固有アビ_1243_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 威力

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 48
	アビ名 = 御厨子『解』
	消費ＭＰ = 30
	威力 = 120
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 12
	アビ名 = 逕庭拳＋
	消費ＭＰ = 10
	威力 = 75
ELSE
	アビ名 = 逕庭拳
	消費ＭＰ = 10
	威力 = 60
ENDIF


;下の４つの文字列に文章を入れると、対象選択時の文章を変化させることが出来る。
;これらを使わない場合は「誰に使用しますか？」と表示される。		
;アビ汎用文字列:選択時メッセージ１ = 
;アビ汎用文字列:選択時メッセージ２ = 
;アビ汎用文字列:選択時メッセージ３ = 
;アビ汎用文字列:選択時メッセージ４ = 

;下の４つの文字列に文章を入れると、アビ使用時の文章を変化させることが出来る。
;これらを使わない場合は「（キャラ名）の（アビ名）！」と表示される。
;アビ汎用文字列:実行時メッセージ１ = 
;アビ汎用文字列:実行時メッセージ２ = 
;アビ汎用文字列:実行時メッセージ３ = 
;アビ汎用文字列:実行時メッセージ４ = 


SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 48
			詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>刻まれた宿儺の術式を使用し
			詳細文文字列受け渡し変数 += @"<br>打撃と同時に相手の体にキリトリ線を刻む。"
			詳細文文字列受け渡し変数 += @"<br>100％の自属性ダメージ後、{威力}％の自属性ダメージを与える"
			詳細文文字列受け渡し変数 += @"<br>二度目のダメージの際は、黒閃は発生しない"
		ELSE
			詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>打撃後に流れ込む呪力によって
			詳細文文字列受け渡し変数 += @"<br>二連続で{威力}％の自属性ダメージを与える。"
			詳細文文字列受け渡し変数 += @"<br>このアビリティでは黒閃は発生しない。"
		ENDIF
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_敵単体
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 48
			CALL アビテンプレート_通常攻撃処理
			CALL 黒閃発動時処理
			
			アビ汎用変数:クリティカル率補正値 = -999
			アビ汎用変数:効果割合 = 威力
			CALL アビテンプレート_ダメージ処理_自属性
		ELSE
			アビ汎用変数:効果割合 = 威力
			アビ汎用変数:クリティカル率補正値 = -999
			CALL アビテンプレート_ダメージ処理_自属性			
			CALL アビテンプレート_ダメージ処理_自属性
		ENDIF
		
ENDSELECT


@固有アビ_1243_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 4
	アビ名 = 極度の集中
	消費ＭＰ = 10
ENDIF


;下の４つの文字列に文章を入れると、対象選択時の文章を変化させることが出来る。
;これらを使わない場合は「誰に使用しますか？」と表示される。		
;アビ汎用文字列:選択時メッセージ１ = 
;アビ汎用文字列:選択時メッセージ２ = 
;アビ汎用文字列:選択時メッセージ３ = 
;アビ汎用文字列:選択時メッセージ４ = 

;下の４つの文字列に文章を入れると、アビ使用時の文章を変化させることが出来る。
;これらを使わない場合は「（キャラ名）の（アビ名）！」と表示される。
;アビ汎用文字列:実行時メッセージ１ = 
;アビ汎用文字列:実行時メッセージ２ = 
;アビ汎用文字列:実行時メッセージ３ = 
;アビ汎用文字列:実行時メッセージ４ = 


SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>限りなく集中することにより、黒閃率アップ[3ターン/30％]
		詳細文文字列受け渡し変数 += @"<br>更に黒閃率アップ[累積/10％/上限70％]"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用文字列:バフ・デバフ枠 = 集中_黒閃率アップ
		アビ汎用文字列:バフ・デバフ対象能力 = クリティカル率
		アビ汎用変数:効果量 = 30
		アビ汎用変数:持続ターン = 3
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 集中_黒閃率アップ_累積
		アビ汎用文字列:バフ・デバフ対象能力 = クリティカル率
		アビ汎用変数:累積上限_固定値 = 70
		アビ汎用変数:効果量 = 10
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		CALL アビテンプレート_有利効果_累積バフ効果セット

ENDSELECT


@固有アビ_1243_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 威力

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 16
	アビ名 = 卍蹴り＋
	消費ＭＰ = 10
	威力 = 150
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 8
	アビ名 = 卍蹴り
	消費ＭＰ = 10
	威力 = 120
ENDIF


;下の４つの文字列に文章を入れると、対象選択時の文章を変化させることが出来る。
;これらを使わない場合は「誰に使用しますか？」と表示される。		
;アビ汎用文字列:選択時メッセージ１ = 
;アビ汎用文字列:選択時メッセージ２ = 
;アビ汎用文字列:選択時メッセージ３ = 
;アビ汎用文字列:選択時メッセージ４ = 

;下の４つの文字列に文章を入れると、アビ使用時の文章を変化させることが出来る。
;これらを使わない場合は「（キャラ名）の（アビ名）！」と表示される。
;アビ汎用文字列:実行時メッセージ１ = 
;アビ汎用文字列:実行時メッセージ２ = 
;アビ汎用文字列:実行時メッセージ３ = 
;アビ汎用文字列:実行時メッセージ４ = 


SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>体を沈み込ませ、相手の攻撃を避けながら放つ蹴り
		詳細文文字列受け渡し変数 += @"<br>{威力}％の自属性ダメージを与えながら、90％の回避率上昇[１ターン/１回]"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_敵単体
		アビ汎用変数:効果割合 = 威力
		CALL アビテンプレート_ダメージ処理_自属性
		
		CALL 黒閃発動時処理
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 回避率アップ
		アビ汎用文字列:バフ・デバフ対象能力 = 回避率
		アビ汎用変数:効果量 = 90
		アビ汎用変数:持続ターン = 1
		アビ汎用変数:持続回数 = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
ENDSELECT


@固有アビ_1243_4(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 24
	アビ名 = 反転術式
	消費ＭＰ = 50
ENDIF


;下の４つの文字列に文章を入れると、対象選択時の文章を変化させることが出来る。
;これらを使わない場合は「誰に使用しますか？」と表示される。		
;アビ汎用文字列:選択時メッセージ１ = 
;アビ汎用文字列:選択時メッセージ２ = 
;アビ汎用文字列:選択時メッセージ３ = 
;アビ汎用文字列:選択時メッセージ４ = 

;下の４つの文字列に文章を入れると、アビ使用時の文章を変化させることが出来る。
;これらを使わない場合は「（キャラ名）の（アビ名）！」と表示される。
;アビ汎用文字列:実行時メッセージ１ = 
;アビ汎用文字列:実行時メッセージ２ = 
;アビ汎用文字列:実行時メッセージ３ = 
;アビ汎用文字列:実行時メッセージ４ = 


SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>負のエネルギーである呪力の性質を「反転」させ
		詳細文文字列受け渡し変数 += @"<br>ダメージを回復する[回復力依存/150％]"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用変数:効果割合 = 150
		CALL アビテンプレート_回復処理
		
ENDSELECT


@固有戦闘開始時処理_キャラ_1243
;戦闘開始時処理関数から呼び出し
#DIM バフ・デバフ行数
#DIM 隊列番号

隊列番号 = キャラ隊列検索(GETCHARA(1243))

アビテンプレート用_アビ名 = 黒い火花

CALL アビ対象選択テンプレート_自己のみ
アビ汎用変数:特殊表示オプション = 1
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:持続ターン = -1
アビ汎用文字列:バフ・デバフ枠 = 黒い火花に愛された者
アビ汎用文字列:バフ・デバフ対象能力 = 黒い火花
CALL アビテンプレート_有利効果_バフ効果セット

CALL アビ汎用変数文字列リセット
アビテンプレート用_アビ名 = 宿儺の器
アビ汎用変数:特殊表示オプション = 1
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:持続ターン = -1
アビ汎用文字列:バフ・デバフ枠 = 宿儺の器
アビ汎用文字列:バフ・デバフ対象能力 = 状態異常耐性_毒
アビ汎用変数:効果量 = 500
CALL アビテンプレート_有利効果_バフ効果セット


@固有通常攻撃後処理_バフ_黒い火花(バフ・デバフ行数, 全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ
#DIM バフ・デバフ行数
#DIM 威力値
#DIM キャラ番号

SIF 全滅フラグ
	RETURN 0

CALL 黒閃発動時処理

@黒閃発動時処理

IF 戦闘中カウント:戦闘行動キャラ:クリティカル回数 > 戦闘中カウント:戦闘行動キャラ:行動前クリティカル回数
	CALL アビ対象選択テンプレート_自己のみ
	アビテンプレート用_アビ名 = ゾーン
	
	アビ汎用変数:特殊表示オプション = 1
	アビ汎用変数:消去不可オプション = 1
	アビ汎用変数:持続ターン = -1
	アビ汎用文字列:バフ・デバフ枠 = ゾーン
	アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
	アビ汎用変数:効果量 = 0
	
	CALL アビ汎用変数文字列リセット
	
	アビ汎用変数:特殊表示オプション = -1
	アビ汎用変数:消去不可オプション = 1
	アビ汎用変数:持続ターン = -1
	アビ汎用変数:効果量 = 30
	アビ汎用変数:持続ターン = 3
	アビ汎用文字列:バフ・デバフ枠 = 黒閃_クリティカル率
	アビ汎用文字列:バフ・デバフ対象能力 = クリティカル率
	CALL アビテンプレート_有利効果_バフ効果セット
	
	CALL アビ汎用変数文字列リセット
	アビテンプレート用_アビ名 = ゾーン
	アビ汎用変数:特殊表示オプション = -1
	アビ汎用変数:消去不可オプション = 1
	アビ汎用変数:持続ターン = -1
	アビ汎用変数:効果割合 = 10
	
	アビ汎用文字列:バフ・デバフ枠 = 黒閃_攻撃力
	アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
	CALL アビテンプレート_有利効果_バフ効果セット
	
	アビ汎用文字列:バフ・デバフ枠 = 黒閃_防御力
	アビ汎用文字列:バフ・デバフ対象能力 = 防御力
	CALL アビテンプレート_有利効果_バフ効果セット
	
	アビ汎用変数:累積上限_割合 = 70
	アビ汎用文字列:バフ・デバフ枠 = 黒閃_累積_攻撃力
	アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
	CALL アビテンプレート_有利効果_累積バフ効果セット
	
	アビ汎用文字列:バフ・デバフ枠 = 黒閃_累積_防御力
	アビ汎用文字列:バフ・デバフ対象能力 = 防御力
	CALL アビテンプレート_有利効果_累積バフ効果セット
ENDIF


@バフ・デバフ特殊表示_黒い火花に愛された者(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 黒い火花に愛された者
PRINTFORML クリティカル倍率が高い。
PRINTFORML クリティカル（黒閃）発動時、クリティカル発生率が上昇する[30％/3ターン]
PRINTFORML 同時に、戦闘中続く攻撃力・防御力バフ獲得[10％]
PRINTFORML 更に、戦闘中続く攻撃力・防御力の累積バフ獲得[10％/上限70％]

@バフ・デバフ特殊表示_宿儺の器(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 宿儺の器
PRINTFORML ＨＰ・攻撃力・防御力が高め。
PRINTFORML 毒無効。

@バフ・デバフ特殊表示_ゾーン(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
#DIM 黒閃率バフ
VARSET LOCALS

PRINTFORML ゾーン
PRINTFORML 黒閃発動後の、スポーツなどで言うゾーンに入った状態
黒閃率バフ = バフ番号取得_枠("黒閃_クリティカル率", 隊列番号)
IF 黒閃率バフ < 0
	PRINTFORML クリティカル発生率が上昇 持続ターン：{DT_CELL_GET("戦闘効果データベース", 黒閃率バフ, "持続ターン")}
ENDIF
PRINTFORML 攻撃力・防御力が10％上昇。
PRINTFORML 黒閃発動ごとに更に10％ずつ上昇（合計70％まで）

;----------------------------------------------------------------------------------
;アビリティテンプレート例
;----------------------------------------------------------------------------------
;敵単体に、攻撃力の200%威力で火属性のダメージを与える効果
;----------------------------------------------------------------------------------	
	; CALL アビ対象選択テンプレート_敵単体
	; アビ汎用変数:効果割合 = 200
	; CALL アビテンプレート_ダメージ処理_火属性

;----------------------------------------------------------------------------------
;戦闘不能ではない敵全体に、防御力の300%威力で自属性のダメージを与える効果
;----------------------------------------------------------------------------------	
	; CALL アビ対象選択テンプレート_敵全体_生者のみ
	; アビ汎用変数:効果割合 = 300
	; アビ汎用文字列:攻撃側使用能力値 = 防御力
	; CALL アビテンプレート_ダメージ処理_自属性

;----------------------------------------------------------------------------------
;戦闘不能ではない味方全体に、3ターン持続する30%の攻撃力UPを与える効果
;----------------------------------------------------------------------------------
	; CALL アビ対象選択テンプレート_味方全体_生者のみ
	; アビ汎用変数:効果割合 = 30
	; アビ汎用文字列:バフ・デバフ枠 = 攻撃力A
	; アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
	; アビ汎用変数:持続ターン = 3
	; CALL アビテンプレート_有利効果_バフ効果セット

;----------------------------------------------------------------------------------
;敵縦列に、3ターン持続する暗闇（攻撃失敗率40%）を与える効果　基礎成功率70％
;----------------------------------------------------------------------------------
	; CALL アビ対象選択テンプレート_敵縦列
	; アビ汎用変数:効果割合 = 40
	; アビ汎用文字列:バフ・デバフ枠 = 暗闇
	; アビ汎用文字列:バフ・デバフ対象能力 = 暗闇
	; アビ汎用変数:持続ターン = 3
	; アビ汎用変数:基礎成功確率 = 70
	; CALL アビテンプレート_不利効果_デバフ効果セット

;----------------------------------------------------------------------------------
;戦闘不能状態の味方単体を蘇生し、回復力の100%威力でHPを回復する効果
;----------------------------------------------------------------------------------	
	; CALL アビ対象選択テンプレート_味方単体_死者のみ
	; アビ汎用変数:効果割合 = 100
	; アビ汎用変数:蘇生可能オプション = 1
	; CALL アビテンプレート_回復処理


;--------------------------------------------------
;戦闘能力の固有処理説明
;--------------------------------------------------
@口上_ステータス画面_固有特性解説_XXXX(対象キャラ)
#DIM 対象キャラ
CALL 口上変数初期化

;口上と同じ感覚で使う為に書式を統一しているが、ステータス画面で表示されるので
;基本的にWAIT系列は使わないことを推奨

KSTR:(K++) = □ 特性：『黒い火花に愛された者』 □-----------------------------------------------------------------------
KSTR:(K++) = 　クリティカル倍率が高い。
KSTR:(K++) = 　クリティカル（黒閃）発動時、クリティカル発生率が上昇する[30％/3ターン]
KSTR:(K++) = 　同時に、戦闘中続く攻撃力・防御力バフ獲得[10％]
KSTR:(K++) = 　更に、戦闘中続く攻撃力・防御力の累積バフ獲得[10％/上限70％]
KSTR:(K++) = 　
KSTR:(K++) = 　 特性：『宿儺の器』
KSTR:(K++) = 　ＨＰ・攻撃力・防御力が高め。
KSTR:(K++) = 　毒無効。

CALL 口上変数表示(対象キャラ, 1)