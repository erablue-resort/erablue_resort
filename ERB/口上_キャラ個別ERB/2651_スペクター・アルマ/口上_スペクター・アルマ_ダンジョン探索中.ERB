;****************************************
;ダンジョン探索中に条件を満たしていた時表示される文章
;****************************************
;・使い方
;「XXXX」をキャラクター番号に置換し、それぞれの関数に処理を入れる
;****************************************


;--------------------------------------------------
;「仲間と会話」ボタン押下時
;--------------------------------------------------
@KOJO_DUNGEON_仲間と会話_2651(対象キャラ)
#DIM 対象キャラ

;簡単に何度も見られるので、条件分岐やランダム化で複数パターンの登録を推奨

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;とりあえず原作台詞（一部改変）をランダムに
SELECTCASE RAND:8
	CASE 0
		KSTR:(K++) = 「ふへへっ♪　よっろしっくねー♪」
	CASE 1
		KSTR:(K++) = 「わたしもねわたしもね、がんばってお手伝いするんだよー！」
	CASE 2
		KSTR:(K++) = 「ねーねーアルマって知ってる？
		KSTR:(K++) = 　もし見かける事があったら優しくしてあげてね！」
	CASE 3
		KSTR:(K++) = 「おっはなー、おはなーはどこですかー♪
		KSTR:(K++) = 　あかあおきいろのきれいな子ー♪」
	CASE 4
		KSTR:(K++) = 「みょえ～ん、お腹がへったよ～」
	CASE 5
		KSTR:(K++) = 「いっつもいっつもね、シューちゃんがね、
		KSTR:(K++) = 　遊んでくれて色々手伝ってくれるの。
		KSTR:(K++) = 　でね、だからね、わたしはシューちゃんに恩返しをしたいなぁってね」
	CASE 6
		KSTR:(K++) = 「シューちゃんとアベンジャーちゃんがね
		KSTR:(K++) = 　たまにね、わたしを難しそうな顔でじーーっと見てくるの。
		KSTR:(K++) = 　なんでだろう？」
		;多分おっぱいの話だとおもいます
	CASE 7
		KSTR:(K++) = 「シューちゃんとアベンジャーちゃんがね、このまえね喧嘩してたの。
		KSTR:(K++) = 　『おまえは背が高いだけましだろ！』ってシューちゃんが叫んでたけど、
		KSTR:(K++) = 　どうしちゃったのかなぁ」
		;恐らくおっぱいの話ですね
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0,,対象キャラ)



;--------------------------------------------------
;固有スキル発動時
;--------------------------------------------------

;ぐるぐるどーん！
@KOJO_DUNGEON_固有アビ発動時_2651_1(対象キャラ, 使用アビ名)
#DIMS 使用アビ名
#DIM 対象キャラ
#DIM 掛け合いフラグ

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2652アベンジャー・アルマ
LOCAL:2 = GETCHARA(2652)
;2653スケルトンシューター・アルマ
LOCAL:3 = GETCHARA(2653)

IF キャラNO生存_存在判定(2652) == 1 && キャラNO生存_存在判定(2653) == 1
	;相手候補が二人いるときはランダム
	掛け合いフラグ = RAND(2) + 1 
ELSEIF キャラNO生存_存在判定(2652)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2653)
	掛け合いフラグ = 2
ELSE
	;0がソロ
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withアベンジャー
		SELECTCASE RAND:2
		CASE 0
			KSTR:(K++) = 「ぐるぐるぐるぐる……
			KSTR:(K++) = 　アベンジャーちゃんもやろー！」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:2)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

			KSTR:(K++) = 「あ、重心が……わわわ」
		CASE 1
			KSTR:(K++) = 「ふんにゃー！」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:2)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

			KSTR:(K++) = 「そこです……にゃー！」
		ENDSELECT
	CASE 2
	;withスケルトンシューター
		SELECTCASE RAND:2
		CASE 0
			KSTR:(K++) = 「ぐるぐるぺしぺしー♪」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:3)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

			KSTR:(K++) = 「ちゃんと相手を狙えよ！」
		CASE 1
			KSTR:(K++) = 「シューちゃんもぐるぐるしよー！」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:3)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

			KSTR:(K++) = 「……うえ、目が回った」
		ENDSELECT
	CASEELSE
	;ソロ
		SELECTCASE RAND:3
			CASE 0
				KSTR:(K++) = 「ふんにゃー！」
			CASE 1
				KSTR:(K++) = 「ふへへっ♪　ぺしぺしモード♪」
			CASE 2
				KSTR:(K++) = 「いくよいくよ？　倒しちゃうよ♪」
		ENDSELECT
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)


;とりこにしてあげる！
@KOJO_DUNGEON_固有アビ発動時_2651_2(対象キャラ, 使用アビ名)
#DIMS 使用アビ名
#DIM 対象キャラ
#DIM 掛け合いフラグ

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2652アベンジャー・アルマ
LOCAL:2 = GETCHARA(2652)
;2653スケルトンシューター・アルマ
LOCAL:3 = GETCHARA(2653)

IF キャラNO生存_存在判定(2652) == 1 && キャラNO生存_存在判定(2653) == 1
	掛け合いフラグ = RAND(2) + 1 
ELSEIF キャラNO生存_存在判定(2652)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2653)
	掛け合いフラグ = 2
ELSE
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withアベンジャー
		SELECTCASE RAND:2
		CASE 0
			KSTR:(K++) = 「えいやー♪　これでどうかにゃーん？」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:2)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

			;あと3つかな
			KSTR:(K++) = 「あなたはとりこ？
			KSTR:(K++) = 　……敵に聞いても仕方ないですね」
		CASE 1
			KSTR:(K++) = 「ふへへっ♪　逃がさないよ？」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:2)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

			KSTR:(K++) = 「逃げようものならアベンジですよ」
		ENDSELECT
	CASE 2
	;withスケルトンシューター
		SELECTCASE RAND:2
		CASE 0
			KSTR:(K++) = 「わたしのとりこにしてあげる！」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:3)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

			KSTR:(K++) = 「あたしには絶対出来ない技だ……」
		CASE 1
			KSTR:(K++) = 「えいやー♪　シューちゃんも一緒にやろー！」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:3)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

			KSTR:(K++) = 「あたしにそういうのは合わないって言ってるだろ！」
		ENDSELECT
	CASEELSE
	;ソロ
		SELECTCASE RAND:3
			CASE 0
				KSTR:(K++) = 「えいやー♪」
			CASE 1
				KSTR:(K++) = 「ふへへ～覚悟してね♪」
			CASE 2
				KSTR:(K++) = 「ふへへっ♪　逃がさないよ？」
		ENDSELECT
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)


;みんなおかしくなーれ♪
@KOJO_DUNGEON_固有アビ発動時_2651_3(対象キャラ, 使用アビ名)
#DIMS 使用アビ名
#DIM 対象キャラ
#DIM 掛け合いフラグ

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2652アベンジャー・アルマ
LOCAL:2 = GETCHARA(2652)
;2653スケルトンシューター・アルマ
LOCAL:3 = GETCHARA(2653)

IF キャラNO生存_存在判定(2652) == 1 && キャラNO生存_存在判定(2653) == 1
	掛け合いフラグ = RAND(2) + 1 
ELSEIF キャラNO生存_存在判定(2652)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2653)
	掛け合いフラグ = 2
ELSE
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withアベンジャー
		SELECTCASE RAND:2
		CASE 0
			KSTR:(K++) = 「あっ！　野生のテリヤキが走ってる！」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:2)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

			KSTR:(K++) = 「やですねぇ、スぺさん。テリヤキなんて……
			KSTR:(K++) = 　えっ、また！？」
			;原作初登場時のイベントで一度行ったやりとり、というわかりにくいネタ
			;テリヤキは恐らくふつうの鶏の照り焼きです
		CASE 1
			KSTR:(K++) = 「いくよいくよ？　みんなおかしくなーれ♪」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:2)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

			KSTR:(K++) = 「私は正気を保たなくては……
			KSTR:(K++) = 　スペさんを見失わないように」
		ENDSELECT
	CASE 2
	;withスケルトンシューター
		SELECTCASE RAND:2
		CASE 0
			KSTR:(K++) = 「よーし、頑張るよ～♪」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:3)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

			KSTR:(K++) = 「何をどう頑張ったらこんな技になるんだ……」
		CASE 1
			KSTR:(K++) = 「ふへへ～、みんなみんなおかしくなーれ♪」

			NSTR:(K++) = ++++
			切り替え名前:0 = %CALLNAME:(LOCAL:3)%
			切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

			KSTR:(K++) = 「お前の技、謎すぎて
			KSTR:(K++) = 　あたしもおかしくなりそうだよ……」
		ENDSELECT
	CASEELSE
	;ソロ
		SELECTCASE RAND:3
			CASE 0
				KSTR:(K++) = 「みんなみーんな、やっつけちゃうよ～♪」
			CASE 1
			;ことばの意味はよくわからんがとにかくおかしくなれ
				KSTR:(K++) = 「あっ！　野生のテリヤキが走ってる！」
			CASE 2
				KSTR:(K++) = 「くるくる～♪
				KSTR:(K++) = 　みんなおかしくなーれ♪」
		ENDSELECT
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)


;奥義に掛け合い設定するとメッセージがカットインに被るのでやめました
;--------------------------------------------------
;奥義発動時
;--------------------------------------------------
@KOJO_DUNGEON_奥義発動時_2651(対象キャラ, 使用奥義名)
#DIMS 使用奥義名
#DIM 対象キャラ
;「（キャラ名）の奥義：（奥義名）！」よりも前に表示される

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

SELECTCASE RAND:4
	CASE 0
		KSTR:(K++) = 「わたしもわたしもね、いっぱい頑張るね！」
	CASE 1
		KSTR:(K++) = 「ふへへっ♪　お助けモード♪」
	CASE 2
		;これはECO-Wikiにも載ってない原作台詞（「パートナー負傷中」）
		KSTR:(K++) = 「待っててね、頑張ってなおすからね」
	CASE 3
		KSTR:(K++) = 「おーい、生きてるかにゃーん？」
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0,,対象キャラ)

;--------------------------------------------------
;チェンバースト発動時
;--------------------------------------------------
@KOJO_DUNGEON_チェンバ発動時_2651(対象キャラ)
#DIM 対象キャラ
#DIM 掛け合いフラグ

;「チェインバースト！」（フルチェイン！）よりも前に表示される
;該当キャラが起点になった時（＝ターンで最初に奥義を撃ったキャラ）しか呼ばれないので注意

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2652アベンジャー・アルマ
LOCAL:2 = GETCHARA(2652)
;2653スケルトンシューター・アルマ
LOCAL:3 = GETCHARA(2653)

IF キャラNO生存_存在判定(2652) == 1 && キャラNO生存_存在判定(2653) == 1
	;二人いた場合どちらも参加
	掛け合いフラグ = 3 
ELSEIF キャラNO生存_存在判定(2652)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2653)
	掛け合いフラグ = 2
ELSE
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withアベンジャー
		KSTR:(K++) = 「アベンジャーちゃん、いくよー！　れっつごー♪」

		NSTR:(K++) = ++++
		切り替え名前:0 = %CALLNAME:(LOCAL:2)%
		切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

		KSTR:(K++) = 「ごー！」
	CASE 2
	;withスケルトンシューター
		KSTR:(K++) = 「シューちゃん、いくよーっ！」

		NSTR:(K++) = ++++
		切り替え名前:0 = %CALLNAME:(LOCAL:3)%
		切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

		KSTR:(K++) = 「……くらえ！」
	CASE 3
	;withアベンジャー＆スケルトンシューター
		KSTR:(K++) = 「いえーいれっつごー♪」

		NSTR:(K++) = ++++
		切り替え名前:0 = %CALLNAME:(LOCAL:2)%
		切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

		KSTR:(K++) = 「ごー！」

		NSTR:(K++) = ++++
		切り替え名前:1 = %CALLNAME:(LOCAL:3)%
		切り替え顔グラリソース:1 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

		KSTR:(K++) = 「……くらえ！」
	CASEELSE
	;ソロ（チェインなのにソロというのも変だがソロ）
		KSTR:(K++) = 「いえーいれっつごー♪」
ENDSELECT


;（メモ）↓だとHP0でも喋るので
;キャラNO生存_存在判定と使い分けるのがいいとおもいました

;掛け合いの作り方
;ZZZZ = 掛け合い相手のCSVに記載してあるキャラ番号とする
;
; LOCAL:2 = GETCHARA(ZZZZ)
; IF キャラ隊列検索(LOCAL:2) > -1
; 	KSTR:(K++) = （口上キャラのセリフ）
;
; 	NSTR:(K++) = ++++
;	切り替え名前:0 = %CALLNAME:(LOCAL:2)%
; 	切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔
;
; 	KSTR:(K++) = （掛け合い相手のセリフ）
; ENDIF
;と記述すると下に一個、掛け合い相手の顔グラと名前が表示されたメッセージ欄を増やせるので、そこで掛け合いを行う
;複数個メッセージ欄を増やす場合、切り替え顔グラリソース:1、切り替え名前:1のように配列番号を１つずつ増やすこと

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;トドメ時
;--------------------------------------------------
@KOJO_DUNGEON_トドメ時_2651(対象キャラ)
#DIM 対象キャラ

;行動の結果（◯◯は倒れた！など）の後に表示される
;複数攻撃時は一人でも倒していれば表示される

;口上用トドメフラグ には倒した敵の数が入っている
;口上用技名保存 には奥義名・アビ名が入っている
;       通常攻撃の場合は「通常攻撃」、チェンバの場合は「チェインバースト」が入っている

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

SELECTCASE RAND:2
	CASE 0
		KSTR:(K++) = 「はーい、またねー♪」
	CASE 1
		KSTR:(K++) = 「ふへへっ♪　ばいばーい♪」
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

; ;--------------------------------------------------
; ;味方から回復を受けた時
; ;「（キャラ名）のＨＰが」の直後に表示される
; ;複数人回復した場合、ランダムで一人の分が表示される
; ;--------------------------------------------------
; ;（現在未実装）
; @KOJO_DUNGEON_被回復時_2651(対象キャラ)
; #DIM 対象キャラ
; CALL 口上変数初期化
; LOCAL = GETCHARA(XXXX)
; LOCAL:1 = キャラ隊列検索(LOCAL)

; ;回復した側のキャラは「BATTLE_STATE:戦闘行動キャラ:キャラ登録番号」でキャラ番号が
; ;「戦闘行動キャラ」で隊列番号が取れる

; KSTR:(K++) = 

; CALL メッセージ欄表示用関数(@"探索用_{LOCAL:1}_顔", CALLNAME:対象キャラ)

;--------------------------------------------------
;戦闘勝利時
;--------------------------------------------------
@KOJO_DUNGEON_戦闘勝利時_2651(対象キャラ)
#DIM 対象キャラ

;ルピやEXPの取得よりも前に表示される

CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

KSTR:(K++) = 「やったやったー♪」

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;全滅時
;--------------------------------------------------
@KOJO_DUNGEON_全滅時_2651(対象キャラ)
#DIM 対象キャラ
CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

KSTR:(K++) = 「ほわーっ！　な、なんでー？」

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;逃走時
;--------------------------------------------------
@KOJO_DUNGEON_逃走時_2651(対象キャラ)
#DIM 対象キャラ
CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

KSTR:(K++) = 「みんなで逃げるの？　土下座はしなくていいのかにゃーん？」

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)
