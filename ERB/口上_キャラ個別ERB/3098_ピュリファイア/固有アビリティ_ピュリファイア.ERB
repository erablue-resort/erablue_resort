@固有アビ_3098_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIM 強化段階 = 0
#DIMS アビ名

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 30
	強化段階 = 2
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 15
	強化段階 = 1
ELSE
	強化段階 = 0
ENDIF

;レベル状況を変更するのは手間なので、アビの外に影響でない範囲でデバッグ用処理追加
[IF_DEBUG]
	強化段階 = 0
[ENDIF]

IF 強化段階 >= 2 
	アビ名 = ラブメイカー＋＋
	消費ＭＰ = 100
ELSEIF 強化段階 == 1 
	アビ名 = ラブメイカー＋
	消費ＭＰ = 80
ELSEIF 1
	アビ名 = ラブメイカー
	消費ＭＰ = 60
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		IF 強化段階 >= 2 
			詳細文文字列受け渡し変数 = 消費ＭＰ：100
			詳細文文字列受け渡し変数 += "<br>味方全体に［回復力✕70％］の回復効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［20％］（Ａ枠・3ターン）の追撃効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［15］の奥義ゲージUP効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［1］のデバフ消去効果を与える。"
		ELSEIF 強化段階 >= 1
			詳細文文字列受け渡し変数 = 消費ＭＰ：80
			詳細文文字列受け渡し変数 += "<br>味方全体に［回復力✕60％］の回復効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［10％］（Ａ枠・3ターン）の追撃効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［1］のデバフ消去効果を与える。"
		ELSEIF 1
			詳細文文字列受け渡し変数 = 消費ＭＰ：60
			詳細文文字列受け渡し変数 += "<br>味方全体に［回復力✕50％］の回復効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［10％］（Ａ枠・3ターン）の追撃効果を与える。"
		ENDIF
		RETURN 消費ＭＰ
	CASE "アビ効果"
		IF 強化段階 >= 2 
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果割合 = 70
			CALL アビテンプレート_回復処理
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 追撃A
			アビ汎用文字列:バフ・デバフ対象能力 = 追撃
			アビ汎用変数:効果割合 = 20
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット
			CALL アビテンプレート_有利効果_デバフ消去
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 15
			CALL アビテンプレート_有利効果_奥義ゲージUP
			CALL アビ汎用変数文字列リセット
		ELSEIF 強化段階 >= 1
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果割合 = 60
			CALL アビテンプレート_回復処理
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 追撃A
			アビ汎用文字列:バフ・デバフ対象能力 = 追撃
			アビ汎用変数:効果割合 = 10
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット
			CALL アビテンプレート_有利効果_デバフ消去
			CALL アビ汎用変数文字列リセット
		ELSEIF 1
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果割合 = 50
			CALL アビテンプレート_回復処理
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 追撃A
			アビ汎用文字列:バフ・デバフ対象能力 = 追撃
			アビ汎用変数:効果割合 = 10
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット
		ENDIF
ENDSELECT


 

 
@固有アビ_3098_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIM 強化段階 = 0
#DIMS アビ名

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 40
	強化段階 = 2
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 20
	強化段階 = 1
ELSE
	強化段階 = 0
ENDIF

;レベル状況を変更するのは手間なので、アビの外に影響でない範囲でデバッグ用処理追加
[IF_DEBUG]
	強化段階 = 0
[ENDIF]

IF 強化段階 >= 2 
	アビ名 = リバーススイープ＋＋
	消費ＭＰ = 62
ELSEIF 強化段階 == 1 
	アビ名 = リバーススイープ＋
	消費ＭＰ = 56
ELSE
	アビ名 = リバーススイープ
	消費ＭＰ = 44
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		IF 強化段階 >= 2 
			詳細文文字列受け渡し変数 = 消費ＭＰ：62
			詳細文文字列受け渡し変数 += "<br>敵縦列に［回復力✕170％］の自属性ダメージを与える。"
			詳細文文字列受け渡し変数 += "<br>［10％］（Ａ枠・3ターン）の被ダメージ上昇効果を与える。"
		ELSEIF 強化段階 == 1 
			詳細文文字列受け渡し変数 = 消費ＭＰ：56
			詳細文文字列受け渡し変数 += "<br>敵縦列に［回復力✕135％］の自属性ダメージを与える。"
			詳細文文字列受け渡し変数 += "<br>［10％］（Ａ枠・3ターン）の被ダメージ上昇効果を与える。"
		ELSE
			詳細文文字列受け渡し変数 = 消費ＭＰ：44
			詳細文文字列受け渡し変数 += "<br>敵縦列に［回復力✕100％］の自属性ダメージを与える。"
		ENDIF
		RETURN 消費ＭＰ
	CASE "アビ効果"
		IF 強化段階 >= 2 
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_敵縦列
			アビ汎用変数:効果割合 = 170
			アビ汎用文字列:攻撃側使用能力値 = 回復力
			CALL アビテンプレート_ダメージ処理_自属性
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 被ダメージA
			アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
			アビ汎用変数:効果割合 = 10
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_不利効果_デバフ効果セット
		ELSEIF 強化段階 == 1 
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_敵縦列
			アビ汎用変数:効果割合 = 135
			アビ汎用文字列:攻撃側使用能力値 = 回復力
			CALL アビテンプレート_ダメージ処理_自属性
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 被ダメージA
			アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
			アビ汎用変数:効果割合 = 10
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_不利効果_デバフ効果セット
		ELSE
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_敵縦列
			アビ汎用変数:効果割合 = 100
			アビ汎用文字列:攻撃側使用能力値 = 回復力
			CALL アビテンプレート_ダメージ処理_自属性
		ENDIF
ENDSELECT

@固有アビ_3098_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIM 強化段階 = 0
#DIMS アビ名

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35 && 陥落チェック(キャラ番号)
	強化段階 = 2
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
	強化段階 = 1
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 10
	強化段階 = 0
ENDIF

;レベル状況を変更するのは手間なので、アビの外に影響でない範囲でデバッグ用処理追加
[IF_DEBUG]
	強化段階 = 0
[ENDIF]

IF 強化段階 >= 2 
	アビ名 = 百合の頂
	消費ＭＰ = 95
ELSEIF 強化段階 == 1 
	アビ名 = 百合の女王＋
	消費ＭＰ = 66
ELSEIF 強化段階 == 0
	アビ名 = 百合の女王
	消費ＭＰ = 48
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		IF 強化段階 >= 2
			詳細文文字列受け渡し変数 = 消費ＭＰ：95
			詳細文文字列受け渡し変数 += "<br>自身に［1］のデバフ消去効果を与える。"
			詳細文文字列受け渡し変数 += "<br>自身に［30％］（独自枠・5ターン・消去不可）の回復力上昇効果を与える。"
			詳細文文字列受け渡し変数 += "<br>自身に［30％］（独自枠・5ターン・消去不可）の与回復量上昇効果を与える。"
		ELSEIF 強化段階 == 1 
			詳細文文字列受け渡し変数 = 消費ＭＰ：66
			詳細文文字列受け渡し変数 += "<br>自身に［1］のデバフ消去効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［25％］（Ａ枠・5ターン）の回復力上昇効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［20％］（Ａ枠・3ターン）の与回復量上昇効果を与える。"
		ELSEIF 強化段階 == 0
			詳細文文字列受け渡し変数 = 消費ＭＰ：48
			詳細文文字列受け渡し変数 += "<br>［1］のデバフ消去効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［15％］（Ａ枠・3ターン）の回復力上昇効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［15％］（Ａ枠・3ターン）の与回復量上昇効果を与える。"
		ENDIF
		RETURN 消費ＭＰ
	CASE "アビ効果"
		IF 強化段階 >= 2 
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			CALL アビテンプレート_有利効果_デバフ消去()
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = 百合の頂
			アビ汎用文字列:バフ・デバフ対象能力 = 回復力
			アビ汎用変数:効果割合 = 30
			アビ汎用変数:持続ターン = 5
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = 百合の頂
			アビ汎用文字列:バフ・デバフ対象能力 = 与回復量
			アビ汎用変数:効果割合 = 30
			アビ汎用変数:持続ターン = 5
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_有利効果_バフ効果セット
		ELSEIF 強化段階 == 1 
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			CALL アビテンプレート_有利効果_デバフ消去()
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 回復力A
			アビ汎用文字列:バフ・デバフ対象能力 = 回復力
			アビ汎用変数:効果割合 = 25
			アビ汎用変数:持続ターン = 5
			CALL アビテンプレート_有利効果_バフ効果セット
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 与回復量A
			アビ汎用文字列:バフ・デバフ対象能力 = 与回復量
			アビ汎用変数:効果割合 = 20
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット
		ELSEIF 強化段階 == 0
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			CALL アビテンプレート_有利効果_デバフ消去()
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 回復力A
			アビ汎用文字列:バフ・デバフ対象能力 = 回復力
			アビ汎用変数:効果割合 = 15
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 与回復量A
			アビ汎用文字列:バフ・デバフ対象能力 = 与回復量
			アビ汎用変数:効果割合 = 15
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット
		ENDIF
ENDSELECT

@固有戦闘不能時処理_キャラ_3098
#DIM 対象番号
#DIM 苛烈なる浄化の魔女
FOR 対象番号, 0, 4
	苛烈なる浄化の魔女 = バフ番号取得_枠("苛烈なる浄化の魔女", 対象番号)
	CALL 戦闘効果削除(苛烈なる浄化の魔女)
NEXT

@固有戦闘開始時処理_キャラ_3098
#DIM バフ・デバフ行数
#DIM 隊列番号
#DIM 対象番号
#DIM カワイイスパイス隊列番号

;バフ付け文章は出さないので1を入れておく
アビテンプレート用_アビ名表示済フラグ = 1
カワイイスパイス隊列番号 = キャラ隊列検索(GETCHARA(3097))
IF カワイイスパイス隊列番号 >= 0
	;サブメンバーでもいい
	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用文字列:バフ・デバフ枠 = 魔女の情欲
	アビ汎用文字列:バフ・デバフ対象能力 = 魔女の情欲
	アビ汎用変数:効果割合 = 0
	アビ汎用変数:持続ターン = -1
	アビ汎用変数:特殊表示オプション = 1
	CALL アビテンプレート_有利効果_パッシブバフ効果セット

	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = 魔女の情欲_回復力
	アビ汎用文字列:バフ・デバフ対象能力 = 回復力
	アビ汎用変数:効果割合 = 20
	CALL アビテンプレート_有利効果_付随バフ効果セット("魔女の情欲")
ENDIF
CALL アビ対象選択テンプレート_自己のみ
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 苛烈なる浄化の魔女
アビ汎用文字列:バフ・デバフ対象能力 = 苛烈なる浄化の魔女
アビ汎用変数:持続ターン = -1
アビ汎用変数:特殊表示オプション = 1
CALL アビテンプレート_有利効果_パッシブバフ効果セット

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 苛烈なる浄化の魔女_防御力
アビ汎用文字列:バフ・デバフ対象能力 = 防御力
アビ汎用変数:効果割合 = 30
アビ汎用文字列:適用範囲 = 味方全体
アビ汎用文字列:付随先_隊列設定 = {戦闘行動キャラ}
CALL アビテンプレート_有利効果_付随バフ効果セット("苛烈なる浄化の魔女")

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 苛烈なる浄化の魔女_回復力
アビ汎用文字列:バフ・デバフ対象能力 = 回復力
アビ汎用変数:効果割合 = 0
アビ汎用文字列:適用範囲 = 味方全体
アビ汎用文字列:付随先_隊列設定 = {戦闘行動キャラ}
CALL アビテンプレート_有利効果_付随バフ効果セット("苛烈なる浄化の魔女")

CALL アビテンプレ変数リセット

@固有行動開始時処理_バフ_苛烈なる浄化の魔女(バフ・デバフ行数)
#DIM バフ・デバフ行数
#DIM ピュリファイア番号
#DIM カワイイスパイス隊列番号
#DIM 対象番号
#DIM 弱体存在 = 0
#DIM 回復力
#DIM 防御力

ピュリファイア番号 = GETCHARA(3098)

;魔女の情欲
;そもそも居ないときは-1が帰るらしい
カワイイスパイス隊列番号 = キャラ隊列検索(GETCHARA(3097))
IF カワイイスパイス隊列番号 >= 0 && 戦闘行動キャラ == ピュリファイア番号
	;サブメンバーでもいい
	;ここに来たらピュリファイアが戦闘行動キャラだと確定するけどもっと良い書き方あるかも
	DT_CELL_SET "戦闘効果データベース", バフ・デバフ行数, "効果量_割合", 20
ENDIF

;苛烈なる浄化の魔女
FOR 対象番号, 10, 20
	SIF 敵BATTLE_STATE_STR:(対象番号 - 10):エネミー名 == ""
		CONTINUE
	SIF 敵BATTLE_STATE:(対象番号 - 10):ＨＰ < 1
		CONTINUE
	IF 弱体存在判定(対象番号)
		弱体存在 = 1
		BREAK
	ENDIF
NEXT

防御力 = バフ番号取得_枠("苛烈なる浄化の魔女_防御力", 戦闘行動キャラ)
回復力 = バフ番号取得_枠("苛烈なる浄化の魔女_回復力", 戦闘行動キャラ)

IF 弱体存在
	DT_CELL_SET "戦闘効果データベース", 防御力, "効果量_割合", 0
	DT_CELL_SET "戦闘効果データベース", 回復力, "効果量_割合", 20
ELSE
	DT_CELL_SET "戦闘効果データベース", 防御力, "効果量_割合", 30
	DT_CELL_SET "戦闘効果データベース", 回復力, "効果量_割合", 0
ENDIF

@バフ・デバフ特殊表示_苛烈なる浄化の魔女(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 苛烈なる浄化の魔女
PRINTFORML すべての敵が弱体効果を受けていない時、味方全体の防御力アップ/いずれかの敵が弱体効果を受けている時、味方全体の回復力アップ
PRINTFORML 持続ターン：永続



@バフ・デバフ特殊表示_魔女の情欲(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 魔女の情欲
PRINTFORML カワイイスパイスがパーティに居る場合、自身の回復力をアップする状態
PRINTFORML 持続ターン：永続

;--------------------------------------------------
;戦闘能力画面に表示されるキャラごとの固有処理説明
;--------------------------------------------------
;・使い方
;「XXXX」をキャラクター番号に置換し、それぞれの関数に処理を入れる
;　口上と同じ感覚で使う為に書式を統一しているが、ステータス画面で表示されるので
;　基本的にWAIT系列は使わないことを推奨
;--------------------------------------------------
@口上_ステータス画面_固有特性解説_3098(対象キャラ)
#DIM 対象キャラ
CALL 口上変数初期化

KSTR:(K++) = □ 特性：『苛烈なる浄化の魔女』 □---------------------------------------------------------------
KSTR:(K++) = 　すべての敵が弱体効果を受けていない時、味方全体の防御力アップ
KSTR:(K++) = 　いずれかの敵が弱体効果を受けている時、味方全体の回復力アップ
KSTR:(K++) = 　
KSTR:(K++) = □ 特性：『魔女の情欲』 □-----------------------------------------------------------------
KSTR:(K++) = 　カワイイスパイスがパーティに居る場合、自身の回復力をアップ

CALL 口上変数表示(対象キャラ, 3098)
 
 
