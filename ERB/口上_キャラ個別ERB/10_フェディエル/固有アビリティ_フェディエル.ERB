
@固有アビ_10_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 対象番号

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 55
	アビ名 = カースドヒューネラル＋
	消費ＭＰ = 450
ELSE
	アビ名 = カースドヒューネラル
	消費ＭＰ = 500
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>味方全体に［2000］（通常枠）のバリア効果を与える。
		詳細文文字列受け渡し変数 += "<br>［独自枠・2被ダメ・消去不可］の死の安寧効果を与える。"
		詳細文文字列受け渡し変数 += "<br>＞弱体無効効果を与える。"
		詳細文文字列受け渡し変数 += "<br>＞ディスペルガード効果を与える。"
		詳細文文字列受け渡し変数 += "<br>＞［10］の高揚効果を与える。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = バリア
		アビ汎用文字列:バフ・デバフ対象能力 = バリア
		アビ汎用変数:効果量 = 2000
		アビ汎用変数:持続ターン = -1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 死の安寧
		アビ汎用文字列:バフ・デバフ対象能力 = 死の安寧
		アビ汎用変数:持続被ダメ回数 = 2
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 死の安寧_弱体無効
		アビ汎用文字列:バフ・デバフ対象能力 = 弱体無効
		CALL アビテンプレート_有利効果_付随バフ効果セット("死の安寧")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 死の安寧_ディスペルガード
		アビ汎用文字列:バフ・デバフ対象能力 = ディスペルガード
		CALL アビテンプレート_有利効果_付随バフ効果セット("死の安寧")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 死の安寧_高揚
		アビ汎用文字列:バフ・デバフ対象能力 = 高揚
		アビ汎用変数:効果量 = 10
		CALL アビテンプレート_有利効果_付随バフ効果セット("死の安寧")
ENDSELECT



@固有アビ_10_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 75
	アビ名 = ミアズマハンズ＋
	消費ＭＰ = 100
ELSE
	アビ名 = ミアズマハンズ
	消費ＭＰ = 125
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵単体に［攻撃力✕150％］の闇属性ダメージを6回与える。
		詳細文文字列受け渡し変数 += @"<br>［累積10/最大40］（累積枠・5ターン）の闇属性耐性減少効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>［累積10％/最大40％］（累積枠・5ターン）のDA率減少効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>［累積10％/最大40％］（累積枠・5ターン）のTA率減少効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>絶望の闇禍フィールドを展開している時、通常攻撃時に自動発動する。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵単体
		アビ汎用変数:効果割合 = 150
		FOR LOCAL, 0, 6
			CALL アビテンプレート_ダメージ処理_闇属性
		NEXT
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 属性被ダメージ_闇累積
		アビ汎用文字列:バフ・デバフ対象能力 = 属性被ダメージ_闇
		アビ汎用変数:効果割合 = 10
		アビ汎用変数:累積上限_割合 = 40
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = DA率_累積枠
		アビ汎用文字列:バフ・デバフ対象能力 = DA率
		アビ汎用変数:効果割合 = 10
		アビ汎用変数:累積上限_割合 = 40
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = TA率_累積枠
		アビ汎用文字列:バフ・デバフ対象能力 = TA率
		アビ汎用変数:効果割合 = 10
		アビ汎用変数:累積上限_割合 = 40
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_累積デバフ効果セット
ENDSELECT



@固有アビ_10_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 対象番号
#DIM 隊列番号
隊列番号 = キャラ隊列検索(キャラ番号)

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 45
	アビ名 = 『黒』の侵蝕
	消費ＭＰ = 200
ENDIF

SIF 隊列番号 > -1 && 戦闘中カウント:隊列番号:0
	アビテンプレート用_アビ封印用フラグ = 1

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>フィールドを絶望の闇禍で満たす。
		詳細文文字列受け渡し変数 += @"<br>このアビリティは再使用出来ない。"
		詳細文文字列受け渡し変数 += @"<br>このアビリティでは行動回数を消費しない。"
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>フィールドを絶望の闇禍で満たす。
		詳細文文字列受け渡し変数 += @"<br>＞敵味方全体に［25％］の防御力減少効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>＞［100］の自傷減少効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>＞自身の特性［『闇を統べる世界の楔』］の条件を満たす。"
		詳細文文字列受け渡し変数 += @"<br>このアビリティは再使用出来ない。"
		詳細文文字列受け渡し変数 += @"<br>このアビリティでは行動回数を消費しない。"
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		アビ汎用変数:持続ターン = -1
		アビ汎用文字列:フィールド枠 = 絶望の闇禍
		CALL アビテンプレート_フィールド効果セット

		IF RESULT == 1
			CALL アビ対象選択テンプレート_自己のみ

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 絶望の闇禍_防御力
			アビ汎用文字列:バフ・デバフ対象能力 = 防御力
			アビ汎用変数:効果割合 = 25
			アビ汎用文字列:適用範囲 = 敵味方全体
			CALL アビテンプレート_不利効果_付随デバフ効果セット("絶望の闇禍")

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 絶望の闇禍_自傷
			アビ汎用文字列:バフ・デバフ対象能力 = 自傷
			アビ汎用変数:効果量 = 100
			アビ汎用文字列:適用範囲 = 敵味方全体
			CALL アビテンプレート_不利効果_付随デバフ効果セット("絶望の闇禍")

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 闇を統べる世界の楔
			アビ汎用文字列:バフ・デバフ対象能力 = 闇を統べる世界の楔
			アビ汎用変数:持続ターン = -1
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 闇を統べる世界の楔_防御力
			アビ汎用文字列:バフ・デバフ対象能力 = 防御力
			アビ汎用変数:効果量 = BATTLE_STATE:隊列番号:防御力 / 5
			アビ汎用文字列:適用範囲 = 味方全体
			アビ汎用文字列:付随先_隊列設定 = {隊列番号}
			CALL アビテンプレート_有利効果_付随バフ効果セット("闇を統べる世界の楔")

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 闇を統べる世界の楔_DA率
			アビ汎用文字列:バフ・デバフ対象能力 = DA率
			アビ汎用変数:効果量 = 100
			アビ汎用文字列:適用範囲 = 味方全体
			アビ汎用文字列:付随先_隊列設定 = {隊列番号}
			CALL アビテンプレート_有利効果_付随バフ効果セット("闇を統べる世界の楔")

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 闇を統べる世界の楔_TA率
			アビ汎用文字列:バフ・デバフ対象能力 = TA率
			アビ汎用変数:効果量 = 30
			アビ汎用文字列:適用範囲 = 味方全体
			アビ汎用文字列:付随先_隊列設定 = {隊列番号}
			CALL アビテンプレート_有利効果_付随バフ効果セット("闇を統べる世界の楔")

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 闇を統べる世界の楔_奥義与ダメ
			アビ汎用文字列:バフ・デバフ対象能力 = ダメージ補正_奥義ダメージ
			アビ汎用変数:効果割合 = 25
			アビ汎用文字列:適用範囲 = 味方全体
			アビ汎用文字列:付随先_隊列設定 = {隊列番号}
			CALL アビテンプレート_有利効果_付随バフ効果セット("闇を統べる世界の楔")
		ENDIF
		
		アビテンプレート用_行動消費無しフラグ = 1
		
		戦闘中カウント:戦闘行動キャラ:0 = 1 
ENDSELECT



@固有通常攻撃後処理_キャラ_10(全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ

SIF 全滅フラグ
	RETURN 0

IF 展開中フィールド名格納 == "絶望の闇禍"
	WSTR:(K++) = 《orito!》
	WSTR:(K++) = フェディエルのミアズマハンズ！

	CALL アビ汎用変数文字列リセット
	アビ汎用変数:効果割合 = 150
	FOR LOCAL, 0, 6
		CALL アビテンプレート_ダメージ処理_闇属性
	NEXT
	
	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = 属性被ダメージ_闇累積
	アビ汎用文字列:バフ・デバフ対象能力 = 属性被ダメージ_闇
	アビ汎用変数:効果割合 = 10
	アビ汎用変数:累積上限_割合 = 40
	アビ汎用変数:持続ターン = 5
	CALL アビテンプレート_不利効果_累積デバフ効果セット
	
	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = DA率_累積枠
	アビ汎用文字列:バフ・デバフ対象能力 = DA率
	アビ汎用変数:効果割合 = 10
	アビ汎用変数:累積上限_割合 = 40
	アビ汎用変数:持続ターン = 5
	CALL アビテンプレート_不利効果_累積デバフ効果セット
	
	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = TA率_累積枠
	アビ汎用文字列:バフ・デバフ対象能力 = TA率
	アビ汎用変数:効果割合 = 10
	アビ汎用変数:累積上限_割合 = 40
	アビ汎用変数:持続ターン = 5
	CALL アビテンプレート_不利効果_累積デバフ効果セット
ENDIF



@固有戦闘不能時処理_キャラ_10
#DIM 対象番号
#DIM 防御力
#DIM DA率
#DIM TA率
#DIM 奥義与ダメ

FOR 対象番号, 0, 4
	防御力 = バフ番号取得_枠("闇を統べる世界の楔_防御力", 対象番号)
	DA率 = バフ番号取得_枠("闇を統べる世界の楔_DA率", 対象番号)
	TA率 = バフ番号取得_枠("闇を統べる世界の楔_TA率", 対象番号)
	奥義与ダメ = バフ番号取得_枠("闇を統べる世界の楔_奥義与ダメ", 対象番号)

	CALL 戦闘効果削除(防御力)
	CALL 戦闘効果削除(DA率)
	CALL 戦闘効果削除(TA率)
	CALL 戦闘効果削除(奥義与ダメ)
NEXT





@バフ・デバフ特殊表示_死の安寧(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 死の安寧
PRINTFORML 弱体効果を無効化/強化効果が消去されない/毎ターン奥義ゲージが上昇する状態［消去不可］
PRINTFORML 持続回数：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続被ダメ回数")}



@フィールド説明文_絶望の闇禍

LOCALS = 絶望の闇禍<br>
LOCALS += "敵味方の防御力が減少/毎ターンダメージを受ける状態<br>"
LOCALS += "効果ターン：永続<br>"

詳細文文字列受け渡し変数 = %LOCALS%



;--------------------------------------------------
;戦闘能力画面に表示されるキャラごとの固有処理説明
;--------------------------------------------------
;・使い方
;「XXXX」をキャラクター番号に置換し、それぞれの関数に処理を入れる
;　口上と同じ感覚で使う為に書式を統一しているが、ステータス画面で表示されるので
;　基本的にWAIT系列は使わないことを推奨
;--------------------------------------------------
@口上_ステータス画面_固有特性解説_10(対象キャラ)
#DIM 対象キャラ
CALL 口上変数初期化

KSTR:(K++) = □ 特性：『闇を統べる世界の楔』 □-------------------------------------------------------
KSTR:(K++) = 　絶望の闇禍展開中、味方全体の防御力・連続攻撃率・奥義性能アップ
KSTR:(K++) = 　

CALL 口上変数表示(対象キャラ, 1)


