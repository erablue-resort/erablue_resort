;--------------------------------------------------
; ミカ 专属技能
;--------------------------------------------------

;--------------------------------------------------
; 技能 1: 
;--------------------------------------------------
@固有アビ_3172_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 隊列番号

    隊列番号 = キャラ隊列検索(キャラ番号)

    IF 基礎BATTLE_STATE:キャラ番号:Lv >= 1
        アビ名 = 
        消費ＭＰ = 0
    ENDIF


    SELECTCASE ARGS
        CASE "アビ名"
            TSTR:コマンド名受渡 = %アビ名%
        
        CASE "アビ説明文"
            IF 基礎BATTLE_STATE:キャラ番号:Lv >= 1
                詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>
            ENDIF
            RETURN 消費ＭＰ

        CASE "アビ効果"
            IF 基礎BATTLE_STATE:キャラ番号:Lv >= 1
            ENDIF

    ENDSELECT
    RETURN RESULT

;--------------------------------------------------
; 战斗开始时处理 (常驻Buff等)
;--------------------------------------------------
@固有戦闘開始時処理_キャラ_3172
#DIM キャラ番号
#DIM 隊列番号
#DIM バフ・デバフ行数

    キャラ番号 = GETCHARA(3172)
    SIF キャラ番号 < 0
        RETURN 0
    隊列番号 = キャラ隊列検索(キャラ番号)
    SIF 隊列番号 < 0
        RETURN 0
    ; --- 特性: Benedictio ---
        CALL アビ対象選択テンプレート_自己のみ
        CALL アビ汎用変数文字列リセット
        アビ汎用文字列:バフ・デバフ枠 = Benedictio_与ダメージ
        アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
        アビ汎用変数:効果割合 = 24
        アビ汎用変数:持続ターン = -1
        ;アビ汎用変数:特殊表示オプション = 1
        CALL アビテンプレート_有利効果_パッシブバフ効果セット

        CALL アビ対象選択テンプレート_自己のみ
        CALL アビ汎用変数文字列リセット
        アビ汎用文字列:バフ・デバフ枠 = Benedictio_被ダメージ
        アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
        アビ汎用変数:効果割合 = 12
        アビ汎用変数:持続ターン = -1
        ;アビ汎用変数:特殊表示オプション = 1
        CALL アビテンプレート_有利効果_パッシブバフ効果セット

        CALL アビ対象選択テンプレート_自己のみ
        CALL アビ汎用変数文字列リセット
        アビ汎用文字列:バフ・デバフ枠 = Benedictio_クリティカル率
        アビ汎用文字列:バフ・デバフ対象能力 = クリティカル率
        アビ汎用変数:効果量 = 1000
        アビ汎用変数:持続ターン = -1
        ;アビ汎用変数:特殊表示オプション = 1
        CALL アビテンプレート_有利効果_パッシブバフ効果セット

        CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = Benedictio_慧眼
		アビ汎用文字列:バフ・デバフ対象能力 = 慧眼
		アビ汎用変数:持続ターン = -1
		CALL アビテンプレート_有利効果_バフ効果セット
    RETURN 0


;--------------------------------------------------
; 回合开始时处理 (回复/CD/动态Buff更新)
;--------------------------------------------------
@固有行動開始時処理_キャラ_3172
#DIM キャラ番号
#DIM 隊列番号
#DIM バフ・デバフ行数

    キャラ番号 = GETCHARA(3172)
    SIF キャラ番号 < 0
        RETURN 0
    隊列番号 = キャラ隊列検索(キャラ番号)
    SIF 隊列番号 < 0
        RETURN 0
    RETURN 0


@固有通常攻撃後処理_キャラ_3172(全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ
#DIM バフ・デバフ行数
#DIM ミカ隊列

SIF 全滅フラグ
	RETURN 0

ミカ隊列 = キャラ隊列検索(GETCHARA(3172))

IF 連撃数 == 3
    戦闘中カウント:ミカ隊列:0 += 3
ELSEIF 連撃数 == 2
    戦闘中カウント:ミカ隊列:0 += 2
ELSE
    戦闘中カウント:ミカ隊列:0 += 1
ENDIF

   IF 戦闘中カウント:ミカ隊列:0 > 4 
       アビ汎用文字列:実行時メッセージ１ = 「私はこっちだよー？」
       戦闘中カウント:ミカ隊列:1 += 1
       戦闘中カウント:ミカ隊列:0 -= 5
       CALL アビ汎用変数文字列リセット
       CALL アビ対象選択テンプレート_敵ランダムＸ体(1)
       アビ汎用変数:効果割合 = 169
       CALL アビテンプレート_ダメージ処理_自属性
   ENDIF
   IF 戦闘中カウント:ミカ隊列:1 > 2 
      アビ汎用文字列:実行時メッセージ１ = 「これはどうかな？」
       戦闘中カウント:ミカ隊列:1 -= 3
       CALL アビ汎用変数文字列リセット
       CALL アビ対象選択テンプレート_敵ランダムＸ体(1)
       アビ汎用変数:効果割合 = 339
       CALL アビテンプレート_ダメージ処理_自属性
   ENDIF

;--------------------------------------------------
;戦闘能力画面に表示されるキャラごとの固有処理説明
;--------------------------------------------------
@口上_ステータス画面_固有特性解説_3172(対象キャラ)
#DIM 対象キャラ
CALL 口上変数初期化

KSTR:(K++) = □ 特性：Benedictio □-------------------------------------------------------------------
KSTR:(K++) = 　全ての攻撃を確定会心に変更/自身の与えるダメージ量が24％増加、被ダメージ量が12％減少
KSTR:(K++) = □ 特性：星の呼び声 □-------------------------------------------------------------------
KSTR:(K++) = 　通常攻撃5回毎に、敵1人に対して攻撃力の169％分のダメージ/発動3回毎に、隕石が落ちて攻撃力の339％分の追加ダメージ

CALL 口上変数表示(対象キャラ, 1)
