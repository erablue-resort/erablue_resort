;****************************************
;ダンジョン探索中に条件を満たしていた時表示される文章
;****************************************
;・使い方
;「XXXX」をキャラクター番号に置換し、それぞれの関数に処理を入れる
;****************************************


;--------------------------------------------------
;「仲間と会話」ボタン押下時
;--------------------------------------------------
@KOJO_DUNGEON_仲間と会話_2653(対象キャラ)
#DIM 対象キャラ

;簡単に何度も見られるので、条件分岐やランダム化で複数パターンの登録を推奨

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

SELECTCASE RAND:7
	CASE 0
		KSTR:(K++) = 「今回の作戦名は何だ？
		KSTR:(K++) = 　特にない？　……そうか」
	CASE 1
		KSTR:(K++) = 「気を付けてな、ケガしたら怒るぞ」
	CASE 2
		KSTR:(K++) = 「ほら、頭にゴミついてるぞ
		KSTR:(K++) = 　……届かないから、屈んでくれ」
	CASE 3
		KSTR:(K++) = 「弓はずっと使っていると痛んじゃうからな
		KSTR:(K++) = 　定期的に手入れしないとだ」
	CASE 4
		;よくわからない台詞ですが原作そのまま
		KSTR:(K++) = 「とくめいきぼう、ナンバー……コードネームって、かっこいいよな！」
	CASE 5
		KSTR:(K++) = 「……牛乳を飲めば大きくなるのかな。
		KSTR:(K++) = 　そこのところ、どうなんだ？」
	CASE 6
		KSTR:(K++) = 「ここはあたしくらいの背丈の大人も多いんだな。
		KSTR:(K++) = 　そういう種族？　もしかして、あたしもそうだったのか……？」
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0,,対象キャラ)



;--------------------------------------------------
;固有スキル発動時
;--------------------------------------------------

;五月雨撃ち
@KOJO_DUNGEON_固有アビ発動時_2653_1(対象キャラ, 使用アビ名)
#DIMS 使用アビ名
#DIM 対象キャラ
#DIM 掛け合いフラグ

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2651スペクター・アルマ
LOCAL:2 = GETCHARA(2651)
;2652アベンジャー・アルマ
LOCAL:3 = GETCHARA(2652)

IF キャラNO生存_存在判定(2651) == 1 && キャラNO生存_存在判定(2652) == 1
	;相手候補が二人いるときはランダム
	掛け合いフラグ = RAND(2) + 1 
ELSEIF キャラNO生存_存在判定(2651)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2652)
	掛け合いフラグ = 2
ELSE
	;0がソロ
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withスペクター
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「テンペストショットだ！」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「ずばばばばーっ！　きれいだね、きれいだね！」
			CASE 1
				KSTR:(K++) = 「オペレーション・アタックだな！」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「いけー、シューちゃんあたーっく♪」
		ENDSELECT
	CASE 2
	;withアベンジャー
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「矢の雨を受けてみろ！」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「さあ乱れ撃ちです……！
				KSTR:(K++) = 　スケさんの降らす雨は、切ない……」
			CASE 1
				KSTR:(K++) = 「出し惜しみはしない……これが五月雨撃ちだ！」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「矢がデイパックの中から次々と……すご技ですね」
				;スペクターがプレゼントしたデイパックです
		ENDSELECT
	CASEELSE
	;ソロ
		SELECTCASE RAND:4
			CASE 0
				KSTR:(K++) = 「オペレーション・アタックだな！」
			CASE 1
				KSTR:(K++) = 「ちゃんと見ててくれよ？」
			CASE 2
				;元になっているプレイヤーキャラ用スキルの名前がテンペストショット
				KSTR:(K++) = 「テンペストショットっ！！
				KSTR:(K++) = 　……またの名を五月雨撃ち」
			CASE 3
				;どうにもこのネタを入れたくなって……
				KSTR:(K++) = 「『さみだれうち』だ！　『みだれうち』じゃない！
				KSTR:(K++) = 　あたしの矢が切ないってどういう意味だ！？」
		ENDSELECT
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)


;重ね撃ち
@KOJO_DUNGEON_固有アビ発動時_2653_2(対象キャラ, 使用アビ名)
#DIMS 使用アビ名
#DIM 対象キャラ
#DIM 掛け合いフラグ

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2651スペクター・アルマ
LOCAL:2 = GETCHARA(2651)
;2652アベンジャー・アルマ
LOCAL:3 = GETCHARA(2652)

IF キャラNO生存_存在判定(2651) == 1 && キャラNO生存_存在判定(2652) == 1
	掛け合いフラグ = RAND(2) + 1 
ELSEIF キャラNO生存_存在判定(2651)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2652)
	掛け合いフラグ = 2
ELSE
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withスペクター
		KSTR:(K++) = 「狙い撃つ！」

		NSTR:(K++) = ++++
		切り替え名前:0 = %CALLNAME:(LOCAL:2)%
		切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「ねらいうつぜー！」
			CASE 1
				KSTR:(K++) = 「ザ・みだれうちも見たいにゃーん」
		ENDSELECT
	CASE 2
	;withアベンジャー
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「まずは、牽制から……」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「剣聖を牽制すれば則ち剣を制す……
				KSTR:(K++) = 　間合いは大事ということですね」
			CASE 1
				KSTR:(K++) = 「デュアルアローっ！」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「私もデュアルソードを……
				KSTR:(K++) = 　二刀流も二枚刃も無理がありますね」
		ENDSELECT
	CASEELSE
	;ソロ
		SELECTCASE RAND:3
			CASE 0
				KSTR:(K++) = 「まずは、牽制から……」
			CASE 1
				;元になっているプレイヤーキャラ用スキルの名前……だけどこれは原作中でもあるセリフ
				KSTR:(K++) = 「デュアルアローっ！」
			CASE 2
				;同名のスキルも持っています（アビリティには未採用）が、それとは別に戦闘中に言うようです
				KSTR:(K++) = 「狙い撃つ！」
		ENDSELECT
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)


;分析
@KOJO_DUNGEON_固有アビ発動時_2653_3(対象キャラ, 使用アビ名)
#DIMS 使用アビ名
#DIM 対象キャラ
#DIM 掛け合いフラグ

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2651スペクター・アルマ
LOCAL:2 = GETCHARA(2651)
;2652アベンジャー・アルマ
LOCAL:3 = GETCHARA(2652)

IF キャラNO生存_存在判定(2651) == 1 && キャラNO生存_存在判定(2652) == 1
	掛け合いフラグ = RAND(2) + 1 
ELSEIF キャラNO生存_存在判定(2651)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2652)
	掛け合いフラグ = 2
ELSE
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withスペクター
		SELECTCASE RAND:2
			CASE 0
				;これ分析か？
				KSTR:(K++) = 「敵を見失うな！　視界はちゃんと確保するんだぞ！」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「アンデッド城ってほんっとーに暗いよねー」
			CASE 1
				KSTR:(K++) = 「見るんじゃなくて観る……伝説のプロが残した言葉さ」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「みる……みる？　なにがちがうの？？」
		ENDSELECT
	CASE 2
	;withアベンジャー
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「まずは相手を分析する。これが大事だ」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「はい、洒落のためにも分析を……
				KSTR:(K++) = 　あぁっ何もおもいつかない……」
			CASE 1
				KSTR:(K++) = 「情報から敵の動きを予測するんだ」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「はい、そして予測地点へ先制アベンジですね。
				KSTR:(K++) = 　……先制でアベンジしていいのか、先生に聞いてみましょう」
				;ECOで先生といえばアミス先生ですが面識あったかな
		ENDSELECT
	CASEELSE
	;ソロ
		SELECTCASE RAND:3
			CASE 0
				KSTR:(K++) = 「視界はちゃんと確保するんだぞ！」
			CASE 1
				KSTR:(K++) = 「作戦成功のために分析は不可欠だぞ」
			CASE 2
			;何らかのプロだから外しはしないので命中率があがるぞ
				KSTR:(K++) = 「あたしはプロさ、任せときな……」
		ENDSELECT
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)


;--------------------------------------------------
;奥義発動時
;--------------------------------------------------
@KOJO_DUNGEON_奥義発動時_2653(対象キャラ, 使用奥義名)
#DIMS 使用奥義名
#DIM 対象キャラ
;「（キャラ名）の奥義：（奥義名）！」よりも前に表示される

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

SELECTCASE RAND:3
	CASE 0
		KSTR:(K++) = 「撃ち抜いてやる！」
	CASE 1
	;「逃げられるかな？」は実装を見送ったスキルの名前
		KSTR:(K++) = 「あたしの矢から逃げられるかな？」
	CASE 2
		KSTR:(K++) = 「ふふ、負ける気は無いよ」
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0,,対象キャラ)

;--------------------------------------------------
;チェンバースト発動時
;--------------------------------------------------
@KOJO_DUNGEON_チェンバ発動時_2653(対象キャラ)
#DIM 対象キャラ
#DIM 掛け合いフラグ

;「チェインバースト！」（フルチェイン！）よりも前に表示される
;該当キャラが起点になった時（＝ターンで最初に奥義を撃ったキャラ）しか呼ばれないので注意

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2651スペクター・アルマ
LOCAL:2 = GETCHARA(2651)
;2652アベンジャー・アルマ
LOCAL:3 = GETCHARA(2652)

IF キャラNO生存_存在判定(2651) == 1 && キャラNO生存_存在判定(2652) == 1
	掛け合いフラグ = 3 
ELSEIF キャラNO生存_存在判定(2651)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2652)
	掛け合いフラグ = 2
ELSE
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withスペクター
		KSTR:(K++) = 「スペクター！　いけるか！？」

		NSTR:(K++) = ++++
		切り替え名前:0 = %CALLNAME:(LOCAL:2)%
		切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

		KSTR:(K++) = 「いけるよーっ！　いっちゃおーっ！」
	CASE 2
	;withアベンジャー
		KSTR:(K++) = 「アベンジャー、合わせてくれ！」

		NSTR:(K++) = ++++
		切り替え名前:0 = %CALLNAME:(LOCAL:3)%
		切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

		KSTR:(K++) = 「はい、がんばります！」
	CASE 3
	;withスペクター＆アベンジャー
		KSTR:(K++) = 「これがトータルコンバットってやつだな！」
		SELECTCASE RAND:2
			CASE 0
				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「コーディネート？」

				NSTR:(K++) = ++++
				切り替え名前:1 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:1 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「コーディネートは……
				KSTR:(K++) = 　いえ、それはあまりにも安易な……！」
				;うぷぷぷ～
			CASE 1
				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「モータル？」

				NSTR:(K++) = ++++
				切り替え名前:1 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:1 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「もう、こんな話を戦闘中に……なんて」
		ENDSELECT
	CASEELSE
	;ソロ
		KSTR:(K++) = 「これがトータルコンバットってやつだな！」
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;トドメ時
;--------------------------------------------------
@KOJO_DUNGEON_トドメ時_2653(対象キャラ)
#DIM 対象キャラ

;行動の結果（◯◯は倒れた！など）の後に表示される
;複数攻撃時は一人でも倒していれば表示される

;口上用トドメフラグ には倒した敵の数が入っている
;口上用技名保存 には奥義名・アビ名が入っている
;       通常攻撃の場合は「通常攻撃」、チェンバの場合は「チェインバースト」が入っている

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

SELECTCASE RAND:2
	CASE 0
		KSTR:(K++) = 「ん、またな」
	CASE 1
		KSTR:(K++) = 「まだまだ精進が足りないな……」
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

; ;--------------------------------------------------
; ;味方から回復を受けた時
; ;「（キャラ名）のＨＰが」の直後に表示される
; ;複数人回復した場合、ランダムで一人の分が表示される
; ;--------------------------------------------------
; ;（現在未実装）
; @KOJO_DUNGEON_被回復時_2653(対象キャラ)
; #DIM 対象キャラ
; CALL 口上変数初期化
; LOCAL = GETCHARA(XXXX)
; LOCAL:1 = キャラ隊列検索(LOCAL)

; ;回復した側のキャラは「BATTLE_STATE:戦闘行動キャラ:キャラ登録番号」でキャラ番号が
; ;「戦闘行動キャラ」で隊列番号が取れる

; KSTR:(K++) = 

; CALL メッセージ欄表示用関数(@"探索用_{LOCAL:1}_顔", CALLNAME:対象キャラ)

;--------------------------------------------------
;戦闘勝利時
;--------------------------------------------------
@KOJO_DUNGEON_戦闘勝利時_2653(対象キャラ)
#DIM 対象キャラ

;ルピやEXPの取得よりも前に表示される

CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

KSTR:(K++) = 「よーっし！　作戦成功だ！」

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;全滅時
;--------------------------------------------------
@KOJO_DUNGEON_全滅時_2653(対象キャラ)
#DIM 対象キャラ
CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

KSTR:(K++) = 「くそ、油断した……」

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;逃走時
;--------------------------------------------------
@KOJO_DUNGEON_逃走時_2653(対象キャラ)
#DIM 対象キャラ
CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

KSTR:(K++) = 「ここは逃げるしかないか……
KSTR:(K++) = 　えーと、そう、あれだ、戦略的撤退ってヤツだ！」

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)
