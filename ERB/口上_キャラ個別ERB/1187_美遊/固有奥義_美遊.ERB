@固有奥義_1187(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 奥義威力
#DIMS 奥義名
#DIM 効果数値
#DIM 効果数値２
#DIM 効果ターン
#DIM Stacks
#DIM 隊列番号

隊列番号 = キャラ隊列検索(キャラ番号)
Stacks = MAX(0,刻印現在数確認("朔月",隊列番号))

奥義名 = 星天を照らせ地の朔月（{Stacks}スタック）
奥義威力 = 0

SELECTCASE RAND:2
CASE 0
	アビ汎用文字列:実行時メッセージ１ = 「地に瞬く願いの光……落ちた月は、無垢なる輝きを束ね、天を望む。『星天を照らせ地の朔月』──」
CASEELSE
	アビ汎用文字列:実行時メッセージ１ = 「百億の小さな灯り……その一瞬の輝きを忘れないで。『星天を照らせ地の朔月』──どうか、あなたの想いが届きますように」
ENDSELECT

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = %奥義名%
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 自身に朔月の加護状態を付与(3ターン,最大5スタック)。
		RETURN 奥義威力
	CASE "奥義説明文_詳細"
		詳細文文字列受け渡し変数 += @"<br>朔月の加護"
		詳細文文字列受け渡し変数 += @"<br>毎ターン味方全体の［10✕スタック］の奥義ゲージUP"
		詳細文文字列受け渡し変数 += @"<br>毎ターン味方全体に［回復力✕50％✕スタック］のＨＰ回復を与える。"
		詳細文文字列受け渡し変数 += @"<br>毎ターン味方全体に［20％✕スタック］（独自枠・1ターン）のクリティカル率上昇効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>味方全体に攻撃力アップ効果［10％✕スタック］(3ターン,最大20スタック)"
	CASE "奥義前効果"
		;対象決定の後、ダメージよりも前に発生する効果。基本の奥義ダメージ部分は記載する必要はない。
		;奥義威力が0だとここの部分もスキップされる

		;処理の都合上、ここから奥義ダメージまでにリセットを噛ませてないため
		;必要な場合を除きここでリセット
		CALL アビ汎用変数文字列リセット
	CASE "奥義追加効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用変数:累積上限_固定値 = 5
		アビ汎用変数:持続ターン = 3
		アビ汎用変数:消去不可オプション = 1
		アビ汎用文字列:バフ・デバフ対象能力 = 朔月
		CALL アビテンプレート_刻印追加(1)
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用変数:持続ターン = 3
		アビ汎用変数:消去不可オプション = 1
		アビ汎用文字列:バフ・デバフ枠 = 朔月の加護
		アビ汎用文字列:バフ・デバフ対象能力 = 朔月の加護
		CALL アビテンプレート_有利効果_パッシブバフ効果セット

ENDSELECT

@固有行動直後処理_バフ・デバフ_朔月の加護(バフ・デバフ行数)
#DIM バフ・デバフ行数
#DIM 隊列番号
#DIM Stacks

隊列番号 = キャラ隊列検索(GETCHARA(1187))
Stacks = 刻印現在数確認("朔月",隊列番号)

IF アビテンプレート用_行動消費無しフラグ != 1
	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_味方全体_生者のみ
	アビ汎用変数:効果量 = 10 * Stacks
	CALL アビテンプレート_有利効果_奥義ゲージUP

	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_味方全体_生者のみ
	アビ汎用変数:効果割合 = 50 * Stacks
	CALL アビテンプレート_回復処理_MAXでも回復

	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_味方全体_生者のみ
	アビ汎用変数:効果量 = 20 * Stacks
	アビ汎用文字列:バフ・デバフ枠 = 朔月_クリティカル率
	アビ汎用文字列:バフ・デバフ対象能力 = クリティカル率
	アビ汎用変数:持続ターン = 1
	アビ汎用変数:消去不可オプション = 1
	CALL アビテンプレート_有利効果_バフ効果セット

	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_味方全体_生者のみ
	アビ汎用変数:累積上限_固定値 = 20
	アビ汎用変数:持続ターン = 3
	アビ汎用変数:消去不可オプション = 1
	アビ汎用文字列:バフ・デバフ対象能力 = 朔月_攻撃力
	CALL アビテンプレート_刻印追加(Stacks)

	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = 朔月の加護_攻撃力
	アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
	アビ汎用変数:付随割合 = 10
	CALL アビテンプレート_有利効果_付随バフ効果セット("朔月_攻撃力")
ENDIF