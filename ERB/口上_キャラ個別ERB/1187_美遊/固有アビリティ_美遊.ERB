@固有アビ_1187_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 効果数値, 3
#DIM 判定値
#DIM 隊列番号
#DIM 乳海判定

隊列番号 = キャラ隊列検索(キャラ番号)
乳海判定 = バフ番号取得_枠("乳海", 隊列番号)

;乳海バフの有無によってスキルを切り替える
IF 乳海判定 > -1
	;乳海バフ所持時は「独自玩耍」を表示
	IF 陥落チェック(キャラ番号) && 基礎BATTLE_STATE:キャラ番号:Lv >= 35
		アビ名 = ひとり遊び  B++
		消費ＭＰ = 100
		効果数値:0 = 70
		効果数値:1 = 900
	ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 20
		アビ名 = ひとり遊び  B+
		消費ＭＰ = 100
		効果数値:0 = 50
		効果数値:1 = 450
	ELSE
		アビ名 = ひとり遊び  B
		消費ＭＰ = 100
		効果数値:0 = 30
		効果数値:1 = 200
	ENDIF
ELSE
	;乳海バフ未所持時は「愉快型魔術礼装（妹）」を表示
	IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
		アビ名 = 愉快型魔術礼装（妹）A++
		消費ＭＰ = 150
	ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 20
		アビ名 = 愉快型魔術礼装（妹）A+
		消費ＭＰ = 100
	ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 1
		アビ名 = 愉快型魔術礼装（妹）A
		消費ＭＰ = 50
	ENDIF
ENDIF

IF 隊列番号 >= 0
	判定値 = 戦闘中カウント:隊列番号:0 - 現在ターン数
	SIF 判定値 > 0
		アビテンプレート用_アビ封印用フラグ = 1
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}
		
		IF 乳海判定 > -1
			;ひとり遊び 的说明文
			詳細文文字列受け渡し変数 += @"<br>自身に［{効果数値:0}％］の攻撃力UP。［{効果数値:0}％］のDA率UP。［［{効果数値:0/2}％］（独立枠・3ターン）のTA率UP。［{効果数値:0/2}％］のTA率UP。［{効果数値:1}］（独立枠・3ターン）の再生効果を付与。"
			詳細文文字列受け渡し変数 += @"<br>赋予  弱体無効。使用後2ターン使用不能。このアビリティでは行動回数を消費しない。"
			SIF 判定値 > 0
				詳細文文字列受け渡し変数 += @"（剩余{判定値}回合）"
		ELSE
			;愉快型魔術礼装（妹） 的说明文
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
			詳細文文字列受け渡し変数 += "<br>自身に［60％］（独自枠・3ターン）の与ダメージ上昇効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［60％］（独自枠・3ターン）のクリティカルダメージ率上昇効果を与える。"
			詳細文文字列受け渡し変数 += "<br>自身に［100］（独自枠・3ターン）の連続攻撃率上昇効果を与える。"
			ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 20
			詳細文文字列受け渡し変数 += "<br>自身に［40％］（独自枠・3ターン）の与ダメージ上昇効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［40％］（独自枠・3ターン）のクリティカルダメージ率上昇効果を与える。"
			詳細文文字列受け渡し変数 += "<br>自身に［50］（独自枠・3ターン）の連続攻撃率上昇効果を与える。"
			ELSE
			詳細文文字列受け渡し変数 += "<br>自身に［20％］（独自枠・3ターン）の与ダメージ上昇効果を与える。"
			詳細文文字列受け渡し変数 += "<br>［20％］（独自枠・3ターン）のクリティカルダメージ率上昇効果を与える。"
			ENDIF
			詳細文文字列受け渡し変数 += @"<br>使用後2ターン使用不能。"
			SIF 判定値 > 0
				詳細文文字列受け渡し変数 += @"（剩余{判定値}回合）"
			詳細文文字列受け渡し変数 += @"<br>このアビリティでは行動回数を消費しない。"
		ENDIF
		RETURN 消費ＭＰ
	CASE "アビ効果"
		IF 乳海判定 > -1
			;ひとり遊び 的效果
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = ひとり遊び _攻撃力
			アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
			アビ汎用変数:効果割合 = 効果数値:0
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = ひとり遊び _DA率
			アビ汎用文字列:バフ・デバフ対象能力 = DA率
			アビ汎用変数:効果量 = 効果数値:0
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = ひとり遊び _TA率
			アビ汎用文字列:バフ・デバフ対象能力 = TA率
			アビ汎用変数:効果量 = 効果数値:0 / 2
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = ひとり遊び _再生
			アビ汎用文字列:バフ・デバフ対象能力 = 再生
			アビ汎用変数:効果量 = 効果数値:1
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = ひとり遊び _弱体無効
			アビ汎用文字列:バフ・デバフ対象能力 = 弱体無効
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット

			戦闘中カウント:隊列番号:0 = 現在ターン数 + 2
			アビテンプレート用_行動消費無しフラグ = 1
		ELSE
			;愉快型魔術礼装（妹） 的效果
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
				CALL アビ汎用変数文字列リセット
				CALL アビ対象選択テンプレート_自己のみ
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_与ダメージ
				アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
				アビ汎用変数:効果割合 = 60
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
				
				CALL アビ汎用変数文字列リセット
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_クリティカルダメージ率
				アビ汎用文字列:バフ・デバフ対象能力 = クリティカルダメージ率
				アビ汎用変数:効果割合 = 60
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
				
				CALL アビ汎用変数文字列リセット
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_DA率
				アビ汎用文字列:バフ・デバフ対象能力 = DA率
				アビ汎用変数:効果量 = 100
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
				
				CALL アビ汎用変数文字列リセット
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_TA率
				アビ汎用文字列:バフ・デバフ対象能力 = TA率
				アビ汎用変数:効果量 = 100
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
			ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 20
				CALL アビ汎用変数文字列リセット
				CALL アビ対象選択テンプレート_自己のみ
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_与ダメージ
				アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
				アビ汎用変数:効果割合 = 40
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
				
				CALL アビ汎用変数文字列リセット
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_クリティカルダメージ率
				アビ汎用文字列:バフ・デバフ対象能力 = クリティカルダメージ率
				アビ汎用変数:効果割合 = 40
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
				
				CALL アビ汎用変数文字列リセット
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_DA率
				アビ汎用文字列:バフ・デバフ対象能力 = DA率
				アビ汎用変数:効果量 = 50
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
				
				CALL アビ汎用変数文字列リセット
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_TA率
				アビ汎用文字列:バフ・デバフ対象能力 = TA率
				アビ汎用変数:効果量 = 50
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
			ELSE
				CALL アビ汎用変数文字列リセット
				CALL アビ対象選択テンプレート_自己のみ
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_与ダメージ
				アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
				アビ汎用変数:効果割合 = 20
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
				
				CALL アビ汎用変数文字列リセット
				アビ汎用文字列:バフ・デバフ枠 = 愉快型魔術礼装_クリティカルダメージ率
				アビ汎用文字列:バフ・デバフ対象能力 = クリティカルダメージ率
				アビ汎用変数:効果割合 = 20
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
			ENDIF
			
			戦闘中カウント:隊列番号:0 = 現在ターン数 + 1
			アビテンプレート用_行動消費無しフラグ = 1
		ENDIF
ENDSELECT

@固有アビ_1187_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM イリヤ数
#DIM 判定値
#DIM 隊列番号
#DIM 乳海判定

隊列番号 = キャラ隊列検索(キャラ番号)
乳海判定 = バフ番号取得_枠("乳海", 隊列番号)

;根据是否持有乳海buff切换技能
IF 乳海判定 > -1
	;持有乳海时显示"因習村の巫女"
	アビ名 = 因習村の巫女 A+
	消費ＭＰ = 150
ELSE
	;无乳海时显示"少女の意地"
	アビ名 = 少女の意地 B
	消費ＭＰ = 100
ENDIF

IF 隊列番号 >= 0
	判定値 = 戦闘中カウント:隊列番号:1 - 現在ターン数
	SIF 判定値 > 0
		アビテンプレート用_アビ封印用フラグ = 1
ENDIF

;フィールド上のイリヤ特性の数を計算する（自分を除く）
イリヤ数 = 0
FOR LOCAL, 0, 20
	IF LOCAL < 10
		SIF LOCAL == 隊列番号
			CONTINUE
		SIF BATTLE_STATE:LOCAL:キャラ登録番号 <= 0 || BATTLE_STATE:LOCAL:ＨＰ <= 0
			CONTINUE
		SIF バフ番号取得_枠("イリヤ", LOCAL) > -1
			イリヤ数 ++
	ELSE
		SIF 敵BATTLE_STATE:(LOCAL - 10):ＨＰ <= 0
			CONTINUE
		SIF デバフ番号取得_枠("イリヤ", LOCAL) > -1
			イリヤ数 ++
	ENDIF
NEXT

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}
		
		IF 乳海判定 > -1
			;因習村の巫女的说明文
			詳細文文字列受け渡し変数 += @"<br>自身に［30＋{イリヤ数}✕10］の奥義ゲージ上昇効果を付与。"
			詳細文文字列受け渡し変数 += @"<br>味方全体に［20％］（3ターン）の奥義ダメージ上昇効果を付与。"
			詳細文文字列受け渡し変数 += @"<br>このスキルは行動回数を消費しない。"
			詳細文文字列受け渡し変数 += @"<br>このスキルは［2ターン］のクールタイムを発生させる。"
		ELSE
			;少女の意地的说明文
		詳細文文字列受け渡し変数 += "<br>自身に1回の弱体無効効果を与える"
		詳細文文字列受け渡し変数 += "<br>自身に1回の自動復活効果［50％回復］を与える"
		詳細文文字列受け渡し変数 += @"<br>使用後3ターン使用不能"
		詳細文文字列受け渡し変数 += "　　　　このアビリティでは行動回数を消費しない。"
		ENDIF
		
		SIF 判定値 > 0
			詳細文文字列受け渡し変数 += @"（剩余{判定値}回合）"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		IF 乳海判定 > -1
			;因習村の巫女的效果
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用変数:効果量 = 30 + イリヤ数 * 10
			CALL アビテンプレート_有利効果_奥義ゲージUP

			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用文字列:バフ・デバフ枠 = 因習村の巫女_奥義
			アビ汎用文字列:バフ・デバフ対象能力 = ダメージ補正_奥義ダメージ
			アビ汎用変数:効果割合 = 20
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット

			戦闘中カウント:隊列番号:1 = 現在ターン数 + 2
		ELSE
			;少女の意地的效果
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = 少女の意地_自動復活
			アビ汎用文字列:バフ・デバフ対象能力 = 自動復活
			アビ汎用変数:持続回数 = 1
			アビ汎用変数:効果割合 = 50
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = 少女の意地_弱体無効
			アビ汎用文字列:バフ・デバフ対象能力 = 弱体無効
			アビ汎用変数:持続回数 = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			
			戦闘中カウント:隊列番号:1 = 現在ターン数 + 3
		ENDIF
		
		アビテンプレート用_行動消費無しフラグ = 1
ENDSELECT

@固有アビ_1187_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 判定値
#DIM 隊列番号
#DIM 乳海判定

隊列番号 = キャラ隊列検索(キャラ番号)
乳海判定 = バフ番号取得_枠("乳海", 隊列番号)

;乳海バフの有無によってスキルを切り替える
IF 乳海判定 > -1
	;持有乳海时显示"イリヤズム"
	IF 基礎BATTLE_STATE:キャラ番号:Lv < 20 || !陥落チェック(キャラ番号)
		アビ名 = イリヤズム EX（未解锁）
		消費ＭＰ = 100
		アビテンプレート用_アビ封印用フラグ = 1
	ELSE
		アビ名 = イリヤズム EX
		消費ＭＰ = 100
	ENDIF
ELSE
	;无乳海时显示"神稚児の願い"
	IF 基礎BATTLE_STATE:キャラ番号:Lv >= 15
		アビ名 = 神稚児の願い EX
		消費ＭＰ = 150
	ELSE
		アビ名 = 
	ENDIF
ENDIF

IF 隊列番号 >= 0
	判定値 = 戦闘中カウント:隊列番号:2 - 現在ターン数
	SIF 判定値 > 0
		アビテンプレート用_アビ封印用フラグ = 1
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}
		
		IF 乳海判定 > -1
			;イリヤズム的说明文
			詳細文文字列受け渡し変数 += @"<br>自身［100％］（1ターン）の回避率上昇。［50％］（3ターン）のクリティカル率上昇。［35％］（3ターン）の奥義値上昇量上昇。［50％］（3ターン）のクリティカルダメージ上昇。"
			詳細文文字列受け渡し変数 += @"<br>味方の自身以外の全体に（5ターン）のイリヤ効果を付与。"
			詳細文文字列受け渡し変数 += @"<br>このスキルは行動回数を消費しない。このスキルは［3ターン］のクールタイムを発生させる。"
		ELSE
			;神稚児の願い的说明文
		詳細文文字列受け渡し変数 += "<br>［50］の奥義ゲージUP効果を与える。"
		詳細文文字列受け渡し変数 += "<br>使用後1ターン使用不能"
		詳細文文字列受け渡し変数 += "　　　　このアビリティでは行動回数を消費しない。"
		ENDIF
		
		SIF 判定値 > 0
			詳細文文字列受け渡し変数 += @"（剩余{判定値}回合）"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		IF 乳海判定 > -1
			;イリヤズム的效果
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = イリヤズム_回避率
			アビ汎用文字列:バフ・デバフ対象能力 = 回避率
			アビ汎用変数:効果割合 = 100
			アビ汎用変数:持続ターン = 1
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = イリヤズム_CT率
			アビ汎用文字列:バフ・デバフ対象能力 = クリティカル率
			アビ汎用変数:効果量 = 50
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = イリヤズム_GE率
			アビ汎用文字列:バフ・デバフ対象能力 = ゲージ上昇効率
			アビ汎用変数:効果割合 = 35
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = イリヤズム_クリティカルダメージ率
			アビ汎用文字列:バフ・デバフ対象能力 = クリティカルダメージ率
			アビ汎用変数:効果割合 = 50

;味方の自身以外の全体に（5ターン）のイリヤ効果を付与。
		FOR LOCAL, 0, 4
			SIF LOCAL == 隊列番号
				CONTINUE
			SIF !BATTLE_STATE:LOCAL:キャラ登録番号 || BATTLE_STATE:LOCAL:ＨＰ <= 0
				CONTINUE
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_指定(LOCAL)
			アビ汎用文字列:バフ・デバフ枠 = イリヤ
			アビ汎用文字列:バフ・デバフ対象能力 = イリヤ
			アビ汎用変数:持続ターン = 5
			アビ汎用変数:特殊表示オプション = 1
			CALL アビテンプレート_有利効果_バフ効果セット
		NEXT

		;味方の自身以外の敌全体に（5ターン）のイリヤ効果を付与。
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = イリヤ
		アビ汎用文字列:バフ・デバフ対象能力 = イリヤ
		アビ汎用変数:持続ターン = 5
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_不利効果_デバフ効果セット

		戦闘中カウント:隊列番号:2 = 現在ターン数 + 3
	ELSE
		;神稚児の願い的效果
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方単体_生者のみ
		アビ汎用変数:効果量 = 50
		CALL アビテンプレート_有利効果_奥義ゲージUP
		
		戦闘中カウント:隊列番号:2 = 現在ターン数 + 1
	ENDIF
	
	アビテンプレート用_行動消費無しフラグ = 1
ENDSELECT


@固有アビ_1187_4(ARGS, キャラ番号)
#DIM  キャラ番号
#DIM  消費ＭＰ
#DIMS アビ名

IF 基礎BATTLE_STATE:キャラ番号:Lv < 20 || !陥落チェック(キャラ番号)
    アビ名   = 魔力斬撃（未解锁）
    消費ＭＰ = 50
    アビテンプレート用_アビ封印用フラグ = 1
ELSE
    アビ名   = 魔力斬撃
    消費ＭＰ = 50
ENDIF

SELECTCASE ARGS
CASE "アビ名"
    TSTR:コマンド名受渡 = %アビ名%

CASE "アビ説明文"
    詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}
    詳細文文字列受け渡し変数 += @"<br>对敌方单体造成［攻击力✕200％］的自身属性伤害。"
    RETURN 消費ＭＰ

CASE "アビ効果"
    CALL アビ対象選択テンプレート_敵単体
    アビ汎用変数:効果割合 = 200
    CALL アビテンプレート_ダメージ処理_自属性
ENDSELECT


@固有アビ_1187_5(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 判定値
#DIM 隊列番号
#DIM 乳海判定
#DIM 朔月判定

隊列番号 = キャラ隊列検索(キャラ番号)
乳海判定 = バフ番号取得_枠("乳海", 隊列番号)
朔月判定 = バフ番号取得_枠("朔月の姫", 隊列番号)

;乳海バフの有無によってスキルを切り替える
IF 乳海判定 > -1
    ;乳海を所持している場合は「朔月の姫」を表示
    IF 基礎BATTLE_STATE:キャラ番号:Lv < 30
        アビ名 = 朔月の姫（未解锁）
        消費ＭＰ = 100
        アビテンプレート用_アビ封印用フラグ = 1
    ELSE
        アビ名 = 朔月の姫
        消費ＭＰ = 100
    ENDIF
ELSE
;乳海バフ所持時は「ひとり遊び」を表示
    IF 基礎BATTLE_STATE:キャラ番号:Lv < 40
        アビ名 = 乳海（未解锁）
        消費ＭＰ = 100
        アビテンプレート用_アビ封印用フラグ = 1
    ELSE
        アビ名 = 乳海
        消費ＭＰ = 100
    ENDIF
ENDIF

IF 隊列番号 >= 0
    判定値 = 戦闘中カウント:隊列番号:3 - 現在ターン数
    SIF 判定値 > 0
        アビテンプレート用_アビ封印用フラグ = 1
ENDIF

SELECTCASE ARGS
    CASE "アビ名"
        TSTR:コマンド名受渡 = %アビ名%
    CASE "アビ説明文"
        詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}
        
        IF 乳海判定 > -1
            ;「朔月の姫」の説明文
            詳細文文字列受け渡し変数 += @"<br>自身の乳海効果を解除し、自身に（99ターン・独立枠）の朔月の姫効果を付与する。"
            詳細文文字列受け渡し変数 += @"<br>	使用後2ターンの再使用待機。"
        ELSE
            ;「乳海」の詳細説明文
            詳細文文字列受け渡し変数 += @"<br>自身の朔月の姫效果を解除し、自身に（99ターン・独立枠）の乳海効果を付与する。"
            詳細文文字列受け渡し変数 += @"<br>使用後2ターンの再使用待機。"
        ENDIF
        
        SIF 判定値 > 0
            詳細文文字列受け渡し変数 += @"（あと{判定値}ターン）"
        詳細文文字列受け渡し変数 += @"<br>このスキルは行動回数を消費しない。"
        RETURN 消費ＭＰ
    CASE "アビ説明文_詳細"
        詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}
        
        IF 乳海判定 > -1
            ;朔月の姫的详细说明文
            詳細文文字列受け渡し変数 += @"<br>自身の乳海効果を解除し、自身に（99ターン・独立枠）の朔月の姫効果を付与する。"
            詳細文文字列受け渡し変数 += @"<br>朔月の姫：毎ターン20の奥義ゲージと、30の攻撃力を回復する。"
        ELSE
            ;乳海的详细说明文
            詳細文文字列受け渡し変数 += @"<br>自身の朔月の姫效果を解除し、自身に（99ターン・独立枠）の乳海効果を付与する。"
            詳細文文字列受け渡し変数 += @"<br>乳海：毎ターン10の奥義ゲージを回復する。"
        ENDIF
        
        詳細文文字列受け渡し変数 += @"<br>使用後2ターンの再使用待機。"
        SIF 判定値 > 0
            詳細文文字列受け渡し変数 += @"（あと{判定値}ターン）"
        詳細文文字列受け渡し変数 += @"<br>このスキルは行動回数を消費しない。"
    CASE "アビ効果"
        IF 乳海判定 > -1
            ;乳海バフ所持時の「朔月の姫」効果発動
            ;まず乳海効果を解除
            CALL 戦闘効果削除(乳海判定)
            
            ;朔月の姫効果を解除（存在する場合）
            IF 朔月判定 > -1
                CALL 戦闘効果削除(朔月判定)
            ENDIF
            
            ;自身に朔月の姫効果を付与
            CALL アビ汎用変数文字列リセット
            CALL アビ対象選択テンプレート_自己のみ
            アビ汎用文字列:バフ・デバフ枠 = 朔月の姫
            アビ汎用文字列:バフ・デバフ対象能力 = 朔月の姫
            アビ汎用変数:持続ターン = 99
            アビ汎用変数:特殊表示オプション = 1
            CALL アビテンプレート_有利効果_バフ効果セット
        ELSE
            ;乳海バフ非所持時の「乳海」効果発動
            ;朔月の姫効果を解除（存在する場合）
            IF 朔月判定 > -1
                CALL 戦闘効果削除(朔月判定)
            ENDIF
            
            ;赋予自身乳海效果
            CALL アビ汎用変数文字列リセット
            CALL アビ対象選択テンプレート_自己のみ
            アビ汎用文字列:バフ・デバフ枠 = 乳海
            アビ汎用文字列:バフ・デバフ対象能力 = 乳海
            アビ汎用変数:持続ターン = 99
            アビ汎用変数:特殊表示オプション = 1
            CALL アビテンプレート_有利効果_バフ効果セット
        ENDIF
        
        戦闘中カウント:隊列番号:3 = 現在ターン数 + 2
        アビテンプレート用_行動消費無しフラグ = 1
ENDSELECT

;朔月の姫バフの特殊表示処理
@バフ・デバフ特殊表示_朔月の姫(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数

PRINTFORML 朔月の姫
PRINTFORML 每回合回复20奥义槽充能
PRINTFORML 攻击力提升30%（独立槽）
PRINTFORML 持续回合：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続ターン")}

;朔月の姫バフのターン終了時処理
@固有ターン終了時処理_バフ_朔月の姫(バフ・デバフ行数)
#DIM バフ・デバフ行数
#DIM 隊列番号
#DIM 朔月判定

隊列番号 = DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "効果対象")

;毎ターン20の奥義ゲージを回復
CALL アビ汎用変数文字列リセット
CALL アビ対象選択テンプレート_指定(隊列番号)
アビテンプレート用_アビ名表示済フラグ = 1
アビ汎用変数:効果量 = 20
CALL アビテンプレート_有利効果_奥義ゲージUP


    CALL アビ汎用変数文字列リセット
    CALL アビ対象選択テンプレート_指定(隊列番号)
    アビ汎用文字列:バフ・デバフ枠 = 朔月の姫_攻撃力
    アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
    アビ汎用変数:効果割合 = 30
    ;持続ターンは1に設定（毎ターン再付与されるため）
    アビ汎用変数:持続ターン = 1
    CALL アビテンプレート_有利効果_バフ効果セット

@バフ・デバフ特殊表示_乳海(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数

PRINTFORML 乳海
PRINTFORML 每回合回复20奥义槽充能
PRINTFORML 持续回合：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続ターン")}

@固有ターン終了時処理_バフ_乳海(バフ・デバフ行数)
#DIM バフ・デバフ行数
#DIM 隊列番号

隊列番号 = DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "効果対象")

CALL アビ汎用変数文字列リセット
CALL アビ対象選択テンプレート_指定(隊列番号)
アビテンプレート用_アビ名表示済フラグ = 1
アビ汎用変数:効果量 = 20
CALL アビテンプレート_有利効果_奥義ゲージUP


@バフ・デバフ特殊表示_イリヤ(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数

PRINTFORML イリヤ
PRINTFORML 被标记为イリヤ的状态（每回合回复1HP）
PRINTFORML 持续回合：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続ターン")}

@固有ターン終了時処理_バフ_イリヤ(バフ・デバフ行数)
#DIM バフ・デバフ行数
#DIM 隊列番号

隊列番号 = DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "効果対象")

CALL アビ汎用変数文字列リセット
CALL アビ対象選択テンプレート_指定(隊列番号)
アビテンプレート用_アビ名表示済フラグ = 1
アビ汎用変数:効果量 = 1
CALL アビテンプレート_回復処理_MAXでも回復

@固有ターン終了時処理_デバフ_イリヤ(バフ・デバフ行数)
#DIM バフ・デバフ行数
#DIM 隊列番号

隊列番号 = DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "効果対象")

CALL アビ汎用変数文字列リセット
CALL アビ対象選択テンプレート_指定(隊列番号)
アビテンプレート用_アビ名表示済フラグ = 1
アビ汎用変数:効果量 = 1
CALL アビテンプレート_回復処理_MAXでも回復

@固有行動開始時処理_キャラ_1187
#DIM キャラ番号
#DIM 隊列番号
#DIM 乳海判定
#DIM 回復割合

キャラ番号 = GETCHARA(1187)
隊列番号 = キャラ隊列検索(キャラ番号)
乳海判定 = バフ番号取得_枠("乳海", 隊列番号)

; 根据乳海状态决定回复量
IF 乳海判定 > -1
	; 有乳海buff时回复20%
	回復割合 = 20
ELSE
	; 无乳海buff时回复10%
	回復割合 = 10
ENDIF

CALL アビ汎用変数文字列リセット
CALL アビ対象選択テンプレート_自己のみ
アビ汎用変数:効果割合 = 回復割合
アビ汎用文字列:回復側使用能力値 = 最大ＭＰ
CALL アビテンプレート_ＭＰ回復処理_MAXでも回復

@口上_ステータス画面_固有特性解説_1187(対象キャラ)
#DIM 対象キャラ
#DIM 隊列番号
#DIM 乳海判定

CALL 口上変数初期化

隊列番号 = キャラ隊列検索(対象キャラ)
乳海判定 = バフ番号取得_枠("乳海", 隊列番号)


	KSTR:(K++) = □ 特性：『無限の魔力供給 A-B』  □-----------------------------------------------------------------
	KSTR:(K++) = 　行動開始時自身のＭＰが［最大ＭＰ✕20％］回復
	KSTR:(K++) = 　行動開始時自身のＭＰが［最大ＭＰ✕10％］回復
        KSTR:(K++) = 　

CALL 口上変数表示(対象キャラ, 1)