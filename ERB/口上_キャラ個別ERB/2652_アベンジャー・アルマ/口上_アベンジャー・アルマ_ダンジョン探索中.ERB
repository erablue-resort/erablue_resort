;****************************************
;ダンジョン探索中に条件を満たしていた時表示される文章
;****************************************
;・使い方
;「XXXX」をキャラクター番号に置換し、それぞれの関数に処理を入れる
;****************************************


;--------------------------------------------------
;「仲間と会話」ボタン押下時
;--------------------------------------------------
@KOJO_DUNGEON_仲間と会話_2652(対象キャラ)
#DIM 対象キャラ

;簡単に何度も見られるので、条件分岐やランダム化で複数パターンの登録を推奨

;リゾート会話に持っていった方がよさそうなのも含む
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

SELECTCASE RAND:8
	CASE 0
		KSTR:(K++) = 「お花が好きなんです。見ていて落ち着くので……」
	CASE 1
		KSTR:(K++) = 「やっぱりいろんな人と冒険するのって楽しいですよね♪」
	CASE 2
		KSTR:(K++) = 「まずは視界を確保しろと教わりました……問題ないです。よーそろー」
	CASE 3
		KSTR:(K++) = 「実は剣の逆手持ちは疲れます。良い子は真似してはダメですよ」
	CASE 4
		KSTR:(K++) = 「今から大剣で斬る体験出来る……ややこしいですね」
	CASE 5
		KSTR:(K++) = 「スペさんがよく飴を買って来てくれるんです♪
		KSTR:(K++) = 　おいしいんですけど歯磨きをしないと怖い事に……」
	CASE 6
		;原作で言ってるダジャレなので……
		KSTR:(K++) = 「冒険者……ではなく騎空士という方にお尋ねしました、
		KSTR:(K++) = 　『空が青いのは何故ですかい』と。
		KSTR:(K++) = 　すると……」
		KSTR:(K++) = _PAGE_
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「『三年かかるよ』と言われましたが、
				KSTR:(K++) = 　いったいどういう意味なのでしょう……」
			CASE 1
				KSTR:(K++) = 「『調べてみましたが、わかりませんでした。いかがでしたか？』
				KSTR:(K++) = 　という答えをいただきました。
				KSTR:(K++) = 　……なかなか手強いですね」
				;たぶんそいつ騎空士じゃない
		ENDSELECT
	CASE 7
		KSTR:(K++) = 「私のようにだじゃれを好む方を見かけました！
		KSTR:(K++) = 　私と違って招待客ではないようですが、
		KSTR:(K++) = 　小さく可愛らしいマーチャントの……
		KSTR:(K++) = 　いえ、あの雰囲気はロイヤルディーラーと呼ばれる存在……？」
		;ロイヤルディーラー：ECOの商人系最上位ジョブ
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0,,対象キャラ)



;--------------------------------------------------
;固有スキル発動時
;--------------------------------------------------

;つんつんします
@KOJO_DUNGEON_固有アビ発動時_2652_1(対象キャラ, 使用アビ名)
#DIMS 使用アビ名
#DIM 対象キャラ
#DIM 掛け合いフラグ

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2651スペクター・アルマ
LOCAL:2 = GETCHARA(2651)
;2653スケルトンシューター・アルマ
LOCAL:3 = GETCHARA(2653)

IF キャラNO生存_存在判定(2651) == 1 && キャラNO生存_存在判定(2653) == 1
	;相手候補が二人いるときはランダム
	掛け合いフラグ = RAND(2) + 1 
ELSEIF キャラNO生存_存在判定(2651)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2653)
	掛け合いフラグ = 2
ELSE
	;0がソロ
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withスペクター
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「やってしまいましょうそうしましょう」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「わたしもそうだそうだといっています」
			CASE 1
				KSTR:(K++) = 「行きます！　つんつんつんつん……」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「つんつんブレイドぐーるぐる♪」
				;ジリオンループのことだなと気付いてくれるひとがいたらうれしい
				;居合いも神速斬りも無いけれど……
		ENDSELECT
	CASE 2
	;withスケルトンシューター
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「斬るのではなく叩き潰す、そんな感じで……」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「……その得物、本当に剣なのか？」
				;本当に大剣です…
			CASE 1
				KSTR:(K++) = 「スケさんも大剣を体験してみますか？」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「いやいい、あたしは弓専門＜シューター＞だ」
		ENDSELECT
	CASEELSE
	;ソロ
		SELECTCASE RAND:3
			CASE 0
				KSTR:(K++) = 「斬るのではなく叩き潰す
				KSTR:(K++) = 　そんな感じで……つんつんします」
			CASE 1
				KSTR:(K++) = 「やってしまいましょうそうしましょう
				KSTR:(K++) = 　えい、えい！」
			CASE 2
				KSTR:(K++) = 「面も胴も面倒だから……ひたすら突きです」
		ENDSELECT
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)



;まもります、絶対に
@KOJO_DUNGEON_固有アビ発動時_2652_2(対象キャラ, 使用アビ名)
#DIMS 使用アビ名
#DIM 対象キャラ
#DIM 掛け合いフラグ

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2651スペクター・アルマ
LOCAL:2 = GETCHARA(2651)
;2653スケルトンシューター・アルマ
LOCAL:3 = GETCHARA(2653)

IF キャラNO生存_存在判定(2651) == 1 && キャラNO生存_存在判定(2653) == 1
	掛け合いフラグ = RAND(2) + 1 
ELSEIF キャラNO生存_存在判定(2651)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2653)
	掛け合いフラグ = 2
ELSE
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withスペクター
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「しゃきーん、です」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「かっこいいね、かっこいいね！」
			CASE 1
				KSTR:(K++) = 「スペさん、無茶だけはしないでくださいね？」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「だいじょうぶ、頼りにしてるよぉ♪」
		ENDSELECT
	CASE 2
	;withスケルトンシューター
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「私はお役に立つことができてますか？」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「ああ、前衛は任せる」
			CASE 1
				KSTR:(K++) = 「私があなたの盾になりましょう」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「攻撃はあたしに任せな！」
		ENDSELECT
	CASEELSE
	;ソロ
		SELECTCASE RAND:3
			CASE 0
				KSTR:(K++) = 「私があなたの盾になりましょう」
			CASE 1
				KSTR:(K++) = 「剣を縦に構えて盾に……しゃきーん、です」
			CASE 2
				KSTR:(K++) = 「私はお役に立つことができてますか？」
		ENDSELECT
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)


;秘密の力を開放します
@KOJO_DUNGEON_固有アビ発動時_2652_3(対象キャラ, 使用アビ名)
#DIMS 使用アビ名
#DIM 対象キャラ
#DIM 掛け合いフラグ

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2651スペクター・アルマ
LOCAL:2 = GETCHARA(2651)
;2653スケルトンシューター・アルマ
LOCAL:3 = GETCHARA(2653)

IF キャラNO生存_存在判定(2651) == 1 && キャラNO生存_存在判定(2653) == 1
	掛け合いフラグ = RAND(2) + 1 
ELSEIF キャラNO生存_存在判定(2651)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2653)
	掛け合いフラグ = 2
ELSE
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withスペクター
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「困ったら私を頼ってください……がんばりますから」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				KSTR:(K++) = 「がんばりすぎちゃだめだよ！
				KSTR:(K++) = 　時々ごろごろしたり、ゆっくりしていこうね！」
			CASE 1
				KSTR:(K++) = 「ばりばりどくしゃーんぽわーっ」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:2)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

				SELECTCASE RAND:2
					CASE 0
						KSTR:(K++) = 「ずごごごもしゃもしゃわんわーん」
					CASE 1
						KSTR:(K++) = 「るるるるぴんぽーんうぃんうぃん」
				ENDSELECT

				IF キャラNO生存_存在判定(2653)
					NSTR:(K++) = ++++
					切り替え名前:1 = %CALLNAME:(LOCAL:3)%
					切り替え顔グラリソース:1 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

					;地味に原作台詞です  怒り顔指定できればなおよかったですね
					KSTR:(K++) = 「ああもう、うるせえええ！！」
				ENDIF
		ENDSELECT
	CASE 2
	;withスケルトンシューター
		SELECTCASE RAND:2
			CASE 0
				KSTR:(K++) = 「では、いきます。ちょっと痛くてもがんばります」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「あまり無茶はするなよ。
				KSTR:(K++) = 　……あいつが泣くから」
			CASE 1
				KSTR:(K++) = 「今こそアベンジの時……です」

				NSTR:(K++) = ++++
				切り替え名前:0 = %CALLNAME:(LOCAL:3)%
				切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

				KSTR:(K++) = 「よし、反転攻勢だな！」
		ENDSELECT
	CASEELSE
	;ソロ
		SELECTCASE RAND:3
			CASE 0
				KSTR:(K++) = 「では、いきます」
			CASE 1
				KSTR:(K++) = 「ばりばりどくしゃーんぽわーっ
				KSTR:(K++) = 　……あ、すみません。声で臨場感を出してみようかと」
			CASE 2
				KSTR:(K++) = 「困ったら私を頼ってください……がんばりますから」
		ENDSELECT
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;奥義発動時
;--------------------------------------------------
@KOJO_DUNGEON_奥義発動時_2652(対象キャラ, 使用奥義名)
#DIMS 使用奥義名
#DIM 対象キャラ
;「（キャラ名）の奥義：（奥義名）！」よりも前に表示される

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

SELECTCASE RAND:3
	CASE 0
		KSTR:(K++) = 「亀のように舞い、敵を倒します」
	CASE 1
		KSTR:(K++) = 「アベンジャーが暴れるんじゃあ……なんて」
	CASE 2
		KSTR:(K++) = 「今の私はアベンジ的な存在……」
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0,,対象キャラ)

;--------------------------------------------------
;チェンバースト発動時
;--------------------------------------------------
@KOJO_DUNGEON_チェンバ発動時_2652(対象キャラ)
#DIM 対象キャラ
#DIM 掛け合いフラグ

;「チェインバースト！」（フルチェイン！）よりも前に表示される
;該当キャラが起点になった時（＝ターンで最初に奥義を撃ったキャラ）しか呼ばれないので注意

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

;2651スペクター・アルマ
LOCAL:2 = GETCHARA(2651)
;2653スケルトンシューター・アルマ
LOCAL:3 = GETCHARA(2653)

IF キャラNO生存_存在判定(2651) == 1 && キャラNO生存_存在判定(2653) == 1
	;二人いた場合どちらも参加
	掛け合いフラグ = 3
ELSEIF キャラNO生存_存在判定(2651)
	掛け合いフラグ = 1
ELSEIF キャラNO生存_存在判定(2653)
	掛け合いフラグ = 2
ELSE
	掛け合いフラグ = 0
ENDIF

SELECTCASE 掛け合いフラグ
	CASE 1
	;withスペクター
		KSTR:(K++) = 「スペさん、あれをやりましょう」

		NSTR:(K++) = ++++
		切り替え名前:0 = %CALLNAME:(LOCAL:2)%
		切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

		KSTR:(K++) = 「あれだね！　よくわかんないけど、ふんにゃー！」
	CASE 2
	;withスケルトンシューター
		KSTR:(K++) = 「スケさん、ぱ、パワーが来てます……！」

		NSTR:(K++) = ++++
		切り替え名前:0 = %CALLNAME:(LOCAL:3)%
		切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔

		KSTR:(K++) = 「よし、任せとけ！　合わせるぞ！」
	CASE 3
	;withスペクター＆スケルトンシューター
		KSTR:(K++) = 「来てます……アベンジ的なパワーが！」

		NSTR:(K++) = ++++
		切り替え名前:0 = %CALLNAME:(LOCAL:2)%
		切り替え顔グラリソース:0 = 探索用_{キャラ隊列検索(LOCAL:2)}_顔

		KSTR:(K++) = 「れっつごー！」

		NSTR:(K++) = ++++
		切り替え名前:1 = %CALLNAME:(LOCAL:3)%
		切り替え顔グラリソース:1 = 探索用_{キャラ隊列検索(LOCAL:3)}_顔
		
		KSTR:(K++) = 「ヤーッ！」
	CASEELSE
	;ソロ
		KSTR:(K++) = 「この力で……ふふ、行きましょうか♪」
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;トドメ時
;--------------------------------------------------
@KOJO_DUNGEON_トドメ時_2652(対象キャラ)
#DIM 対象キャラ

;行動の結果（◯◯は倒れた！など）の後に表示される
;複数攻撃時は一人でも倒していれば表示される

;口上用トドメフラグ には倒した敵の数が入っている
;口上用技名保存 には奥義名・アビ名が入っている
;       通常攻撃の場合は「通常攻撃」、チェンバの場合は「チェインバースト」が入っている

CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

SELECTCASE RAND:2
	CASE 0
		KSTR:(K++) = 「ここまでですか？　お疲れ様でした」
	CASE 1
		KSTR:(K++) = 「ふふ、私のアベンジはこれからですよ♪」
ENDSELECT

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

; ;--------------------------------------------------
; ;味方から回復を受けた時
; ;「（キャラ名）のＨＰが」の直後に表示される
; ;複数人回復した場合、ランダムで一人の分が表示される
; ;--------------------------------------------------
; ;（現在未実装）
; @KOJO_DUNGEON_被回復時_2652(対象キャラ)
; #DIM 対象キャラ
; CALL 口上変数初期化
; LOCAL = GETCHARA(XXXX)
; LOCAL:1 = キャラ隊列検索(LOCAL)

; ;回復した側のキャラは「BATTLE_STATE:戦闘行動キャラ:キャラ登録番号」でキャラ番号が
; ;「戦闘行動キャラ」で隊列番号が取れる

; KSTR:(K++) = 

; CALL メッセージ欄表示用関数(@"探索用_{LOCAL:1}_顔", CALLNAME:対象キャラ)

;--------------------------------------------------
;戦闘勝利時
;--------------------------------------------------
@KOJO_DUNGEON_戦闘勝利時_2652(対象キャラ)
#DIM 対象キャラ

;ルピやEXPの取得よりも前に表示される

CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

KSTR:(K++) = 「ふふ、平和ですね♪」

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;全滅時
;--------------------------------------------------
@KOJO_DUNGEON_全滅時_2652(対象キャラ)
#DIM 対象キャラ
CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

KSTR:(K++) = 「ど、どどどどどうしましょう……？」

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)

;--------------------------------------------------
;逃走時
;--------------------------------------------------
@KOJO_DUNGEON_逃走時_2652(対象キャラ)
#DIM 対象キャラ
CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化
LOCAL = キャラ隊列検索(対象キャラ)

KSTR:(K++) = 「逃げましょうそうしましょう
KSTR:(K++) = 　……そしていつか、アベンジです」

CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ, , , , 対象キャラ)
