;--------------------------------------------------
;●パチュリー・ノーレッジ口上＠erablue_resort用
;　――キャラ固有の移動ルーチンを設定する際に使うテンプレート
;--------------------------------------------------

;--------------------------------------------------
;●ライセンス/更新履歴/概要/使用フラグ
;--------------------------------------------------
;　いずれもパチュリー口上_readme.txt記載に従う
;--------------------------------------------------

;--------------------------------------------------
;・使い方
;--------------------------------------------------
;「1147」（もとXXXX）をキャラのNOに置換し、それぞれの関数に処理を入れる
;必要な場合は「今日は読書の気分のパッチェさん」「幻想郷の本の虫」部分を追加変更のこと
;--------------------------------------------------

;--------------------------------------------------
;＠キャラ固有移動ルーチン判定
;--------------------------------------------------
;固有のルーチンに入る条件を分岐で記述し、「RSTR:ルーチン名受け渡し」にルーチン名を保存してRETURN 1する
;ルーチンの優先度は お祭り＞業務＞固有（この関数）＞その他汎用
;--------------------------------------------------
@キャラ固有移動ルーチン判定_1147(対象キャラ)
#DIM 対象キャラ

	;例えば、「日曜日には（任意のルーチン名）のルーチンで行動する」場合は以下のようになる
	; IF GET_DAY() == "日"
	; 	RSTR:ルーチン名受け渡し = "（任意のルーチン名）"
	; 	RETURN 1
	; ENDIF

	IF 0
	;図書室がある場合、1/2で固有ルーチン：今日は読書の気分のパッチェさん
	;（レミリアがいたら選ばれにくくなる……とかも考えたけど……まあ……いいか！）
	ELSEIF 施設改造度:5:6 >= 1 && !RAND:2
		RSTR:ルーチン名受け渡し '= "今日は読書の気分のパッチェさん"
		RETURN 1
	ELSE
		;通常ルーチンチン
		;普通の御客と同じ行動
	ENDIF

	;通常のルーチンに戻す場合はRETURN 0
	RETURN 0



;--------------------------------------------------
;MOVE_ROUTINE_今日は読書の気分のパッチェさん
;--------------------------------------------------
;起床時間などの設定
;--------------------------------------------------
@MOVE_ROUTINE_今日は読書の気分のパッチェさん(対象キャラ, 見たい項目)
#DIM 対象キャラ
#DIM 時間計算
#DIMS 見たい項目

	;ちなみに「行動時間ゆらぎ」は起床時に決定され、「(RAND9+RAND9+RAND9)*5-60」で決定される
	;3d9-3の範囲は0～24で、期待値は12。……*5-60＝0で、期待値的には設定した時間通りに動いてくれることが多い
	IF 0
	ELSEIF 見たい項目 == "起床時刻"
		;起きる時間。特にこだわりがなければこのまま（480＝8時基準）でOK
		時間計算 = 480 - (TALENT:対象キャラ:早起き * 30)
		RETURN 時間計算 + TCVAR:対象キャラ:行動時間ゆらぎ
	ELSEIF 見たい項目 == "就寝時刻"
		;寝る時間。特にこだわりがなければこのまま（1320＝22時基準）でOK
		;→本の虫モードでは夜更かしする。1410＝23時30分基準に。
		時間計算 = 1410 - (TALENT:対象キャラ:早寝 * 60)
		RETURN 時間計算 + TCVAR:対象キャラ:行動時間ゆらぎ
	ELSEIF 見たい項目 == "就寝場所"
		;就寝する場所。特にこだわりがなければ RETURN 0でいい
		RETURN 0
	ELSEIF 見たい項目 == "初期位置"
		;一日開始時の初期位置。特にこだわりがなければ自室でいい
		CFLAG:対象キャラ:現在位置 = キャラクター部屋検索(対象キャラ)
		CFLAG:対象キャラ:現在マップ種別 = 部屋検索_マップ種別
	ENDIF

;--------------------------------------------------
;@ROUTINE_SCHEDULE_今日は読書の気分のパッチェさん
;--------------------------------------------------
;スケジュールの時間設定を行う
;--------------------------------------------------
@ROUTINE_SCHEDULE_今日は読書の気分のパッチェさん(対象キャラ)
#DIM 対象キャラ
#DIM スケジュール番号

	;まず変な値が入らないようにリセット
	CALL RESET_SCHEDULE(対象キャラ)
	スケジュール番号 = 0

	;メモ：@SET_SCHEDULEの引数に関して
	;対象キャラ、スケジュール番号、開始予定時間、キー（スケジュール名）
	;……とここまでは必須。以下は指定しなくてもいい（が、どれかは指定しないとおそらく意味がない）部分
	;「所要時間」と宣言し「所要時間指定」をする感じ。
	;　小分類：小分類内容…スケジュール名「食事」の、小分類「海の家」、「お弁当」などを指定する
	;　所要時間：所要時間指定…このスケジュールを何分行うかを指定する
	;　優先度：優先度順位…どのくらいの優先度にするか。
	;　　　　　　　　　　　スケジュール上開始予定の行動がそれ以前の行動より優先度が高ければ、今の行動をキャンセルする
	;　　　　　　　　　　　ちなみに、食事が優先度4で、お風呂が優先度2。
	;/
	;パッチェさんは食事が必要ないので、本の虫モードでは食事しなくていいかな……とは思ったけど、まあ、美食も楽しんでほしい。頼むから。

	;起床後：幻想郷の本の虫（※「読書」だと、他のキャラのルーチンと被る可能性があるため）
	;ゼロ時から12時間……起床後から次のスケジュールまで実行する設定
	;優先度設定なしで、昼になったらさすがに食事に向かう
	CALL SET_SCHEDULE(対象キャラ, スケジュール番号, 0, "幻想郷の本の虫", "所要時間", "720")
	スケジュール番号++

	;12時から：昼休憩
	;所要時間の標準は40分、BBQなどでは60分、自炊30分＋食事60分など
	;ただしこのスケジュールでは「続きが気になってかなり頑張って急いで食べる」ので30分と若干短い
	;（本来食事は要らないので、そういう意味でも早く切り上げちゃうんだろう）
	CALL SET_SCHEDULE(対象キャラ, スケジュール番号, 720 + TCVAR:対象キャラ:行動時間ゆらぎ, "食事", "所要時間", "30", "優先度", "4")
	スケジュール番号++

	;13時から：幻想郷の本の虫
	;やはり夕食までずっと実行な
	CALL SET_SCHEDULE(対象キャラ, スケジュール番号, 780 + TCVAR:対象キャラ:行動時間ゆらぎ, "幻想郷の本の虫", "所要時間", "720")
	スケジュール番号++

	;19時から：夕休憩
	;「ちょっと続き！ちょっと続き！」で標準的な時間から30分遅れる
	;わりとノンビリ食べるので所要時間は60分。
	CALL SET_SCHEDULE(対象キャラ, スケジュール番号, 1140 + TCVAR:対象キャラ:行動時間ゆらぎ, "食事", "所要時間", "60", "優先度", "4")
	スケジュール番号++

	;20時から：幻想郷の本の虫
	CALL SET_SCHEDULE(対象キャラ, スケジュール番号, 1200 + TCVAR:対象キャラ:行動時間ゆらぎ, "幻想郷の本の虫", "所要時間", "720")
	スケジュール番号++

	;21時から：お風呂
	CALL SET_SCHEDULE(対象キャラ, スケジュール番号, 1260, "お風呂", "所要時間", "60", "優先度", "2")
	スケジュール番号++

	;22時から：幻想郷の本の虫（もうちょっとだけ読みたいんじゃー！）
	CALL SET_SCHEDULE(対象キャラ, スケジュール番号, 1320 + TCVAR:対象キャラ:行動時間ゆらぎ, "幻想郷の本の虫", "所要時間", "720")
	スケジュール番号++

	;23時00分から寝るまでは（さすがに）自室
	CALL SET_SCHEDULE(対象キャラ, スケジュール番号, 1380 + TCVAR:対象キャラ:行動時間ゆらぎ, "休憩")
	スケジュール番号++

;--------------------------------------------------
;@SCHEDULE_幻想郷の本の虫
;--------------------------------------------------
;記述例は ERB\リゾートマップ\キャラ移動ルーチン\キャラ移動スケジュール.ERB を参照
;--------------------------------------------------
@SCHEDULE_幻想郷の本の虫(対象キャラ, 小分類, 処理内容)
#DIM 対象キャラ
#DIMS 小分類
#DIMS 処理内容

	;場所を固定する場合のルーチン関数
	SELECTCASE 処理内容
		CASE "開始処理"
			;ひたすら図書室に向かう
			;リゾートマップ＝０、空港港＝１、居住区＝２、海＝３
			スケジュール状態:対象キャラ:目的マップ = 0
			スケジュール状態:対象キャラ:目的地 = 506
			RETURN 1
		CASE "経過処理"
		CASE "終了処理"
			RETURN 1
	ENDSELECT

;	;以下は複数の場所をランダムで移動する場合のルーチン関数
;	SELECTCASE 処理内容
;		CASE "開始処理"
;			TCVAR:対象キャラ:移動ルーチンインターバル時間 = 0
;			RETURN 1
;		CASE "経過処理"
;			SIF TCVAR:対象キャラ:移動ルーチンインターバル時間 > 0
;				RETURN
;
;			スケジュール状態:対象キャラ:目的マップ = ;任意のマップ種別
;			スケジュール状態:対象キャラ:目的地 = ;任意の場所をランダムに渡す
;			TCVAR:対象キャラ:移動ルーチンインターバル時間 = RAND(60, 120)
;		CASE "終了処理"
;			TCVAR:対象キャラ:移動ルーチンインターバル時間 = 0
;			RETURN 1
;	ENDSELECT



