;--------------------------------------------------
;●パチュリー・ノーレッジ口上＠erablue_resort用
;　――各種タイミングで処理を割り込ませるための関数群
;--------------------------------------------------

;--------------------------------------------------
;●ライセンス/更新履歴/概要/使用フラグ
;--------------------------------------------------
;　いずれもパチュリー口上_readme.txt記載に従う
;--------------------------------------------------

;--------------------------------------------------
;コマンド実行時処理
;--------------------------------------------------
;コマンド実行直後に毎回呼ばれる処理
;タイミングは実行したコマンドが履歴に保存され、次のオートコマンドの発動判定が終わった後
;コマンド用変数がリセットされる前

;特定の条件を満たした時にパラメータを変化させる場合に使用する
;TARGETの分しか呼ばれないので注意
;--------------------------------------------------
;ちなみにこれは「コマンド直後、調教口上の前」に呼ばれる。

;--------------------------------------------------
@TURNEND_CHARAEVENT_1147
#DIM 対象キャラ
#DIM うふふフラグ

	対象キャラ = キャラ検索("[動かない大図書館]パチュリー")



;--------------------------------------------------
;一日開始時処理
;--------------------------------------------------
;一日開始時に呼ばれる処理
;タイミングは滞在期間チェック後、衣装設定やムード・怒りなどのリセット前

;特定の条件を満たした時に行う処理を入れる
;全員分（島にいなくても）呼ばれる
;--------------------------------------------------
@DAYFIRST_CHARAEVENT_1147
#DIM 対象キャラ

	対象キャラ = GETCHARA(1147)

	;種族改変経験の記憶
	;朝変更して、この時点で保存な。
	;　0：デフォルト（その他：魔法使い）
	;　1：ヒューマン
	;　2：エルーン
	;　3：ドラフ
	;　4：ハーヴィン
	;　5：星晶獣
	;　6：その他（「魔法使い」以外）
	;　10：-1などを保存する予定（小人などがここに入りうる）
	IF 0
	ELSEIF TALENT:対象キャラ:種族 == 1
		SETBIT 特定状況口上用フラグ:対象キャラ:19, 1
	ELSEIF TALENT:対象キャラ:種族 == 2
		SETBIT 特定状況口上用フラグ:対象キャラ:19, 2
	ELSEIF TALENT:対象キャラ:種族 == 3
		SETBIT 特定状況口上用フラグ:対象キャラ:19, 3
	ELSEIF TALENT:対象キャラ:種族 == 4
		SETBIT 特定状況口上用フラグ:対象キャラ:19, 4
	ELSEIF TALENT:対象キャラ:種族 == 5
		SETBIT 特定状況口上用フラグ:対象キャラ:19, 5
	ELSEIF TALENT:対象キャラ:種族 == 6 && CSTR:対象キャラ:特殊種族 != "魔法使い"
		SETBIT 特定状況口上用フラグ:対象キャラ:19, 6
	ENDIF



;--------------------------------------------------
;一日終了時処理
;--------------------------------------------------
;一日終了時に呼ばれる処理
;タイミングはリゾートの人気変動の後

;特定の条件を満たした時に行う処理を入れる
;全員分（島にいなくても）呼ばれる
;※ここで口上とかは呼ばないほうがよさそうだぞ！
;--------------------------------------------------
@DAYEND_CHARAEVENT_1147
#DIM 対象キャラ

	対象キャラ = GETCHARA(1147)

	;１日の終わりにフラグをリセット

	;おはよう回数カウントをリセット
	特定状況口上用フラグ:対象キャラ:34 = 0




;--------------------------------------------------
;PALAM変化時処理
;--------------------------------------------------
;PALAMが変化した直後に飛んでくる処理
;より正確に言えばSOURCE_CALC_系関数から飛んでくるので、直接PALAMをいじっても飛んで来ない
;--------------------------------------------------
@PALAMUP_CHARAEVENT_1147(PALAM種類変数, 変化量)
#DIM 対象キャラ
#DIM PALAM種類変数
#DIM 変化量

	対象キャラ = GETCHARA(1147)

	;ネタメモ：初めて恭順が一定以上になった場合、とかかなー……

;	;PALAM種類変数は、Palam.csvの番号と対応している
;	IF 0
;	;快C
;	ELSEIF PALAM種類変数 == 0
;		SIF 変化量 >= 10000
;			PRINTFORML 快Ｃが10000以上上昇ね
;	;快V
;	ELSEIF PALAM種類変数 == 1
;		PRINTFORML 快Ｖね
;	;快B
;	ELSEIF PALAM種類変数 == 2
;		PRINTFORML 快Ｂね
;	;快A
;	ELSEIF PALAM種類変数 == 3
;		PRINTFORML 快Ａね
;	;快S
;	ELSEIF PALAM種類変数 == 4
;		PRINTFORML 快Ｓね
;	;欲情
;	ELSEIF PALAM種類変数 == 5
;		PRINTFORML 欲情ね
;	;潤滑
;	ELSEIF PALAM種類変数 == 9
;		PRINTFORML 潤滑。濡れ具合ね
;	;恥情
;	ELSEIF PALAM種類変数 == 10
;	;奉仕
;	ELSEIF PALAM種類変数 == 11
;	;屈服
;	ELSEIF PALAM種類変数 == 12
;	;征服
;	ELSEIF PALAM種類変数 == 13
;	;苦痛
;	ELSEIF PALAM種類変数 == 16
;	;習得
;	ELSEIF PALAM種類変数 == 20
;	;反感
;	ELSEIF PALAM種類変数 == 30
;	;不快
;	ELSEIF PALAM種類変数 == 31
;	;否定
;	ELSEIF PALAM種類変数 == 100
;	;なんか追加された場合
;	ELSE
;		;ここには（通常は）こないはずだよ
;	ENDIF
	
	

;--------------------------------------------------
;友情度変化時処理
;--------------------------------------------------
;増加する要素の量が決定し、実際に増加する直前に呼ばれる関数
;特定の要素を増加させたり減少させたりする目的で使用する
;--------------------------------------------------
@好感度要素_友情度上昇反応_CHARAEVENT_1147(上昇値)
#DIM 対象キャラ
#DIM 上昇値

	対象キャラ = GETCHARA(1147)

	RETURN 上昇値


;--------------------------------------------------
;信頼度変化時処理
;--------------------------------------------------
;増加する要素の量が決定し、実際に増加する直前に呼ばれる関数
;特定の要素を増加させたり減少させたりする目的で使用する
;--------------------------------------------------
@好感度要素_信頼度上昇反応_CHARAEVENT_1147(上昇値)
#DIM 対象キャラ
#DIM 上昇値

	対象キャラ = GETCHARA(1147)

	RETURN 上昇値


;--------------------------------------------------
;恋心度変化時処理
;--------------------------------------------------
;増加する要素の量が決定し、実際に増加する直前に呼ばれる関数
;特定の要素を増加させたり減少させたりする目的で使用する
;--------------------------------------------------
@好感度要素_恋心度上昇反応_CHARAEVENT_1147(上昇値)
#DIM 対象キャラ
#DIM 上昇値

	対象キャラ = GETCHARA(1147)

	RETURN 上昇値

;--------------------------------------------------
;性愛度変化時処理
;--------------------------------------------------
;増加する要素の量が決定し、実際に増加する直前に呼ばれる関数
;特定の要素を増加させたり減少させたりする目的で使用する
;--------------------------------------------------
@好感度要素_性愛度上昇反応_CHARAEVENT_1147(上昇値)
#DIM 対象キャラ
#DIM 上昇値

	対象キャラ = GETCHARA(1147)

	RETURN 上昇値

;--------------------------------------------------
;恋慕度変化時処理
;--------------------------------------------------
;増加する要素の量が決定し、実際に増加する直前に呼ばれる関数
;特定の要素を増加させたり減少させたりする目的で使用する
;--------------------------------------------------
@恋慕度上昇反応_CHARAEVENT_1147(上昇値)
#DIM 対象キャラ
#DIM 上昇値

	対象キャラ = GETCHARA(1147)

	RETURN 上昇値

;--------------------------------------------------
;告白成功判定_キャラ個別条件
;--------------------------------------------------
;告白が成功するかを判定する際に呼ばれる関数
;主に特定の条件を達成してないと告白成功させないなどの目的で使用する
;--------------------------------------------------
@告白成功判定_キャラ個別条件_1147(対象キャラ)
#FUNCTION
#DIM 対象キャラ
	RESULT = 0

	;ネタメモ：通常、告白は成功しない？
	;　「は？　私はあなたが好きで、あなたも私が好きみたいだけど、付き合う意味ってある？」
	;　みたいな感じで拒否られる……？
	;……あくまでこれは「成功のための条件付け」なので、ここではあくまで条件を見るだけのほうがいいなー。

	; SIF 条件未達成時
	; 	RESULT ++

	;未達成時にLOCALを増やしてLOCALを返り値にすることで
	;告白時以外にも直接この関数を呼べば幾つ条件を達成していないのかを取得可能

	RETURNF RESULT

;--------------------------------------------------
;キャラ表示条件処理
;--------------------------------------------------
;ZPショップにてキャラを追加する画面にて、キャラを表示する条件を設定可能
;--------------------------------------------------
@EXキャラ_表示条件_1147
#DIM 対象キャラ

	対象キャラ = GETCHARA(1147)

	;他の誰かが恋慕とか、ダンジョンのドコソコをクリアしないと……とかになるのかなあ。

	;条件を達成したら１を返す
	RETURN 1
	;条件未達なら0を返すこと
	;RETURN 0

;--------------------------------------------------
;滞在期間基本日数算出処理
;--------------------------------------------------
@滞在期間基本日数算出_1147
#DIM キャラ番号
#DIM 滞在日数
;リゾートの滞在期間を算出する際に呼ばれる関数(ただし、同行者として来訪する場合は呼ばれない)
;キャラの滞在日数を固定したい場合などに使用する

キャラ番号 = GETCHARA(1147)
;デフォルトの滞在日数(乱数値)を使用したい場合は負の値を指定する
滞在日数 = -1

RETURN 滞在日数

;--------------------------------------------------
;滞在期間補正日数算出処理
;--------------------------------------------------
@滞在期間補正日数算出_1147
#DIM キャラ番号
#DIM 補正日数
;リゾートの滞在期間を算出する際に呼ばれる関数(ただし、スイート招待の場合は呼ばれない)
;キャラの滞在日数を固定したい場合などに使用する

キャラ番号 = GETCHARA(1147)
;デフォルトの補正(恋慕による補正)を使用したい場合は負の値を指定する
補正日数 = -1

RETURN 補正日数

;--------------------------------------------------
;プレゼント時処理
;--------------------------------------------------
;プレゼントが特定のアイテムだった場合に反応する関数
;もらった時の口上はここではなく、口上_キャラ名_コマンド実行時.ERBの@KOJO_COM_1147_314で行うこと
;基本の反応は以下の通り。
;　CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 任意の数値)
;　CALL SOURCE_CALC_征服(TARGET, PLAYER, 任意の数値)
;　CALL SOURCE_CALC_接触(TARGET, PLAYER, 任意の数値)
;　CALL SOURCE_CALC_好感度要素_友情度UP(TARGET, PLAYER, 任意の数値)
;　CALL SOURCE_CALC_好感度要素_恋心度UP(TARGET, PLAYER, 任意の数値)
;プレゼントリストについては、＞\ERB\探索\素材データ\素材性能_贈答アイテム.ERB　……にあるよ。
;--------------------------------------------------
@プレゼント特殊反応_CHARAEVENT_1147(プレゼント名)
#DIMS プレゼント名
#DIM 対象キャラ
#DIM プレゼントランク
#DIM 歓楽強度
#DIM 征服強度

	対象キャラ = GETCHARA(1147)

	IF 0
	ELSEIF プレゼント名 == "例として：なんかプレゼント貰った時の通常処理"
		;このへんにプレゼントをもらった時の処理を描く
		;通常の（大成功時の）プレゼント渡しはこんな感じの数値・処理になる
		;ちなみにこの反応は「通常の反応の代わりに実行される」
		;……なので、やろうと思えば、「これ大っ嫌いなんだけど！？！？」で、むしろマイナスの反応を入れることもできるはず。

		;RFLAG:コマンド結果受渡し変数２にアイテムのランクが入っている。ランクは現状０～５
		;（名前の直接指定なら特に確認する必要はないだろうか？）
		プレゼントランク = RFLAG:コマンド結果受渡し変数２

		;上昇値算出
		歓楽強度 = 200 * プレゼントランク + 400
		征服強度 = 50 * プレゼントランク + 100

		;大成功補正
		TIMES 歓楽強度 , 2.00
		TIMES 征服強度 , 2.00

		;ソース加算、友情・恋心上昇
		;接触は固定です。
		CALL SOURCE_CALC_歓楽(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_征服(対象キャラ, PLAYER, 征服強度)
		CALL SOURCE_CALC_接触(対象キャラ, PLAYER, 80)
		CALL SOURCE_CALC_好感度要素_友情度UP(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_好感度要素_恋心度UP(対象キャラ, PLAYER, 歓楽強度 / 4)
	;パッチェさんは、「娯楽本」「小説本」には、あまり価値を感じなさそう
	;（正確には、「それも好きだけど、知識を摂取するには無駄が多い」と思ってそう）
	;……それはそれとして、活字中毒にとって、新しい本は非常に価値が高い。
	ELSEIF プレゼント名 == "ありふれた娯楽本"

		;プレゼントランクを本来から＋０/１で計算
		プレゼントランク = RFLAG:コマンド結果受渡し変数２ + RAND:2

		;上昇値算出
		歓楽強度 = 200 * プレゼントランク + 400
		征服強度 = 50 * プレゼントランク + 100

		;大成功補正
		TIMES 歓楽強度 , 2.00
		TIMES 征服強度 , 2.00

		;ソース加算、友情・恋心上昇
		CALL SOURCE_CALC_歓楽(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_征服(対象キャラ, PLAYER, 征服強度)
		CALL SOURCE_CALC_接触(対象キャラ, PLAYER, 80)
		;信頼度も上昇。本をくれる人はいい人（確信）
		CALL SOURCE_CALC_好感度要素_信頼度UP(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_好感度要素_友情度UP(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_好感度要素_恋心度UP(対象キャラ, PLAYER, 歓楽強度 / 4)

		;何が特殊反応した場合は１を返すこと
		RETURN 1
	ELSEIF プレゼント名 == "流行りの小説本"
		;プレゼントランクを本来から＋０/１で計算
		プレゼントランク = RFLAG:コマンド結果受渡し変数２ + RAND:2

		;上昇値算出
		歓楽強度 = 200 * プレゼントランク + 400
		征服強度 = 50 * プレゼントランク + 100

		;大成功補正
		TIMES 歓楽強度 , 2.00
		TIMES 征服強度 , 2.00

		;ソース加算、友情・恋心上昇
		CALL SOURCE_CALC_歓楽(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_征服(対象キャラ, PLAYER, 征服強度)
		CALL SOURCE_CALC_接触(対象キャラ, PLAYER, 80)
		;信頼度も上昇。本をくれる人はいい人（確信）
		CALL SOURCE_CALC_好感度要素_信頼度UP(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_好感度要素_友情度UP(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_好感度要素_恋心度UP(対象キャラ, PLAYER, 歓楽強度 / 4)

		;何が特殊反応した場合は１を返すこと
		RETURN 1
	;パッチェさん的な名著……なので、例えばレアな魔導書とかになるだろうか？
	ELSEIF プレゼント名 == "入手困難な名著"

		;ランクを本来から＋１～３として計算
		;「名著」と言ってはいるが、娯楽本の類とは言っていない。
		;レア魔導書とかだとランク７相当ってイメージな
		プレゼントランク = RFLAG:コマンド結果受渡し変数２ + 1 + RAND:3

		;上昇値算出
		歓楽強度 = 200 * プレゼントランク + 400
		征服強度 = 50 * プレゼントランク + 100

		;大成功補正
		TIMES 歓楽強度 , 2.00
		TIMES 征服強度 , 2.00

		;ソース加算、友情・恋心上昇
		CALL SOURCE_CALC_歓楽(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_征服(対象キャラ, PLAYER, 征服強度)
		CALL SOURCE_CALC_接触(対象キャラ, PLAYER, 80)
		;信頼度もかなり上昇。本をくれる人はいい人（確信）
		CALL SOURCE_CALC_好感度要素_信頼度UP(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_好感度要素_友情度UP(対象キャラ, PLAYER, 歓楽強度)
		CALL SOURCE_CALC_好感度要素_恋心度UP(対象キャラ, PLAYER, 歓楽強度 / 4)

		;何が特殊反応した場合は１を返すこと
		RETURN 1
	ENDIF

	;何も特殊反応がない場合は０を返すこと
	RETURN 0

;--------------------------------------------------
;水着着替え時処理
;--------------------------------------------------
;水着に着替えるタイミングで水着に着替えるところを、別の処理を行う関数
;主に特別な衣装に着替えるなどの処理を行う
;--------------------------------------------------
@水着着替え特殊処理_1147(対象キャラ)
#DIM 対象キャラ

	;メモ：マイクロビキニに着替えるとき、露出PALAMまたは露出経験が上がる……みたいな処理？
	;（画像で乳輪がハミでているため）

	;水着から着替えるときに下着を持ってくるの忘れたので……みたいな処理を思いついたけどできるかな？

;--------------------------------------------------
;風呂場着替え時処理
;--------------------------------------------------
;風呂に入るタイミングで湯浴み着に着替えるところを別の処理を行う関数
;主に特別な衣装に着替えるなどの処理を行う
;--------------------------------------------------
@風呂場着替え特殊処理_1147(対象キャラ)
#DIM 対象キャラ

;--------------------------------------------------
;風呂後着替え時処理
;--------------------------------------------------
;風呂から上がったタイミングで浴衣に着替えるところを別の処理を行う関数
;主に特別な衣装に着替えるなどの処理を行う
;--------------------------------------------------
@風呂後着替え特殊処理_1147(対象キャラ)
#DIM 対象キャラ

;--------------------------------------------------
;自室着替え時処理
;--------------------------------------------------
;自室に戻ったタイミングで部屋着に着替えるところを別の処理を行う関数
;主に特別な衣装に着替えるなどの処理を行う
;--------------------------------------------------
@自室着替え特殊処理_1147(対象キャラ)
#DIM 対象キャラ


