;--------------------------------------------------
;●パチュリー・ノーレッジ口上＠erablue_resort用
;　――能力表示画面で、性的能力文章表現の表示を切り替えるための関数
;--------------------------------------------------

;--------------------------------------------------
;●ライセンス/更新履歴/概要/使用フラグ
;--------------------------------------------------
;　いずれもパチュリー口上_readme.txt記載に従う
;--------------------------------------------------

;--------------------------------------------------
;表示場所を変更したため、コメントアウトしたり削ったり
;--------------------------------------------------


;--------------------------------------------------
;コマンド実行時処理
;--------------------------------------------------
;単純にここでPRINT処理を行う
;表示条件なども全部ここで組むこと
;能力表示画面のため、WAIT系は基本的に使わないこと
;--------------------------------------------------
;ステータステンプレート
;IF EXP:対象キャラ:条件 >= 50
;   PRINTFORML ■ 〇〇【開発レベル１】：〇〇
;   PRINTFORML 本文
;   PRINTFORML 本文
;ELSEIF EXP:対象キャラ:条件 >= 100
;   PRINTFORML ■ 〇〇【開発レベル２】：〇〇
;   PRINTFORML 本文
;   PRINTFORML 本文
;ELSEIF EXP:対象キャラ:条件 >= 200
;   PRINTFORML ■ 〇〇【開発レベル３】：〇〇
;   PRINTFORML 本文
;   PRINTFORML 本文
;ELSEIF EXP:対象キャラ:条件 >= 300
;   PRINTFORML ■ 〇〇【開発レベル４】：〇〇
;   PRINTFORML 本文
;   PRINTFORML 本文
;ELSEIF EXP:対象キャラ:条件 >= 300 && EXP:対象キャラ:条件 >= 5
;   PRINTFORML ■ 〇〇【開発レベル５】：〇〇
;   PRINTFORML 本文
;   PRINTFORML 本文
;   PRINTFORML 本文
;ENDIF
;--------------------------------------------------
;例）
; IF EXP:対象キャラ:乳首開発 < 50
; 	PRINTFORML ■%CALLNAME:対象キャラ%の乳首はまだ初々しく、開発されていない。
; ELSEIF EXP:対象キャラ:乳首開発 < 100
; 	PRINTFORML ■%CALLNAME:対象キャラ%は乳首での快楽に慣れ始めているようだ……
; ELSEIF EXP:対象キャラ:乳首開発 < 200
; 	PRINTFORML ■%CALLNAME:対象キャラ%の乳首は少し触れるだけで甘美な快楽を伝えてくれる。
; ELSE
; 	PRINTFORML ■%CALLNAME:対象キャラ%は乳首を少し弄るだけですぐに絶頂してしまうようだ……
; ENDIF
;--------------------------------------------------
;@経験文章表現_1147(対象キャラ)
;#DIM 対象キャラ
;
;
;
;
;	PRINT ■ 関係性 ■--
;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_関係
;	PRINTL -----------------------------------------------------
;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_関係)
;		;項目を開いている場合、最後に１行空行を開ける
;		PRINTFORML 　
;	ENDIF
;
;	PRINT ■ 肉体 ■--
;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_肉体
;	PRINTL -------------------------------------------------------
;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_肉体)
;		PRINTFORML 　
;	ENDIF
;
;;	;精神
;;	;「関係性」でだいたいネタ使っちゃった。コメントアウト。
;;	PRINT ■ 精神 ■--
;;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_精神
;;	PRINTL -------------------------------------------------------
;;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_精神)
;;		CALL パッチェさん_経験表示詳細_精神(対象キャラ)
;;		PRINTFORML 　
;;	ENDIF
;
;	PRINT ■ 口腔 ■--
;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_口腔
;	PRINTL -------------------------------------------------------
;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_口腔)
;		PRINTFORML 　
;	ENDIF
;
;	PRINT ■ 陰核 ■--
;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_陰核
;	PRINTL -------------------------------------------------------
;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_陰核)
;		PRINTFORML 　
;	ENDIF
;
;	PRINT ■ 膣内 ■--
;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_膣内
;	PRINTL -------------------------------------------------------
;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_膣内)
;		PRINTFORML 　
;	ENDIF
;
;	PRINT ■ 子宮 ■--
;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_子宮
;	PRINTL -------------------------------------------------------
;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_子宮)
;		PRINTFORML 　
;	ENDIF
;
;	PRINT ■ 乳房 ■--
;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_乳房
;	PRINTL -------------------------------------------------------
;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_乳房)
;		PRINTFORML 　
;	ENDIF
;
;;	;乳首
;;	PRINT ■ 乳首 ■--
;;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_乳首
;;	PRINTL -------------------------------------------------------
;;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_乳首)
;;		CALL パッチェさん_経験表示詳細_乳首(対象キャラ)
;;		PRINTFORML 　
;;	ENDIF
;
;	PRINT ■ 肛門 ■--
;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_肛門
;	PRINTL -------------------------------------------------------
;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_肛門)
;		PRINTFORML 　
;	ENDIF
;
;	PRINT ■ 淫蕩 ■--
;	PRINTBUTTON "[ 表示切替 ]", パチュリー_性的経験_淫蕩
;	PRINTL -------------------------------------------------------
;	IF パッチェさん_経験表示GETBIT(対象キャラ, パチュリー_性的経験_淫蕩)
;		PRINTFORML 　
;	ENDIF
;
;
;	;１行開けて設定部分を表示
;	PRINTFORML 　
;	PRINT -- 
;	PRINTBUTTON "[ 全表示 ]", パチュリー_性的経験_全表示
;	PRINT  -- 
;	PRINTBUTTON "[ 全格納 ]", パチュリー_性的経験_全格納
;	;コメント切り替えは未実装なのでコメントアウト
;;	PRINT  -- 
;;	PRINTBUTTON "[ コメント切り替え ]", パチュリー_性的経験_コメント
;	PRINTL  --
;
;	RETURN 0
;
;;--------------------------------------------------
;;能力表示固有INPUT_性的能力_1147
;;--------------------------------------------------
;;性的能力画面のボタン動作を入れる関数
;;なお、ボタンを押した後は画面が再表示されるよ。
;;旧処理につきコメントアウト
;;--------------------------------------------------
;@能力表示固有INPUT_性的能力_1147(対象キャラ, INPUT数値)
;#DIM 対象キャラ
;#DIM INPUT数値
;#DIM 切り替え対象BIT
;#DIM 変換定数
;
;;	;おまじない１：2000～3000以外だと帰る
;;	SIF INRANGE(INPUT数値, 2000, 3000)
;;		RETURN 0
;	;おまじない２
;	;BIT演算は0-63ケタめまでしか見られないはずなので、それ以外の数値が入ってきたら帰る
;	SIF !INRANGE(INPUT数値, 2000, 2063)
;		RETURN 0
;
;	;INPUTを、BIT演算の数値に変換するために必要な数値を設定
;	;INPUT数値が2001のところ、変換定数を引いて、１を取り出し、それをBITの桁数にする動き。
;	変換定数 = 2000
;
;	;経験表示用部分
;	;[表示切替]を押すことでBITを反転させ、表示・非表示を切り替える
;	IF 0
;	;全表示を選択
;	;全BITに１をセットな
;	ELSEIF INPUT数値 == パチュリー_性的経験_全表示
;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_関係性 - 変換定数)
;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_口腔 - 変換定数)
;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_陰核 - 変換定数)
;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_膣内 - 変換定数)
;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_子宮 - 変換定数)
;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_乳房 - 変換定数)
;;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_乳首 - 変換定数)
;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_肛門 - 変換定数)
;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_肉体 - 変換定数)
;;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_精神 - 変換定数)
;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_淫蕩 - 変換定数)
;;		SETBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_コメント - 変換定数)
;	;全消しを選択
;	;全BITにゼロをセットな
;	ELSEIF INPUT数値 == パチュリー_性的経験_全格納
;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_関係性 - 変換定数)
;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_口腔 - 変換定数)
;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_陰核 - 変換定数)
;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_膣内 - 変換定数)
;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_子宮 - 変換定数)
;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_乳房 - 変換定数)
;;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_乳首 - 変換定数)
;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_肛門 - 変換定数)
;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_肉体 - 変換定数)
;;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_精神 - 変換定数)
;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_淫蕩 - 変換定数)
;;		CLEARBIT 特定状況口上用フラグ:対象キャラ:13, (パチュリー_性的経験_コメント - 変換定数)
;	;その他の場合
;	;指定されたBITを反転させる（INVERBITは「その桁数のBITを反転」というやつですわ）
;	;（BIT演算可能な範囲かは↑で確かめている）
;	ELSE
;		;BITケタについては、INPUT数値を変換定数分マイナスして、導出する
;		;（INPUT数値＝性的経験_関係性、とかなので……それが見たい数字なので、ちょっと楽する。コピペでいいのは楽ね～）
;		INVERTBIT 特定状況口上用フラグ:対象キャラ:13, (INPUT数値 - 変換定数)
;	ENDIF
;
;	RETURN 0


;;--------------------------------------------------
;;パッチェさん_経験表示GETBIT
;;--------------------------------------------------
;;対象の性的経験を表示するかどうかを返す
;;旧処理につきコメントアウト
;;--------------------------------------------------
;@パッチェさん_経験表示GETBIT(対象キャラ, 対象部位)
;#FUNCTION
;#DIM 対象キャラ
;#DIM 対象部位
;#DIM 変換定数
;
;	;おまじない２
;	;BIT演算は0-63ケタめまでしか見られないはずなので、それ以外の数値が入ってきたら帰る
;	SIF !INRANGE(対象部位, 2000, 2063)
;		RETURNF 0
;
;	;INPUTを、BIT演算の数値に変換するために必要な数値を設定
;	;INPUT数値が2001のところ、変換定数を引いて、１を取り出し、それをBITの桁数にする動き。
;	変換定数 = 2000
;
;	;対象部位（パチュリー_性的経験_口腔など。2000から2010の数字が入っている）
;	;ひくことの、変換定数（2000）
;	;イコール、０とか１とか２とか。
;	;その桁数の、口上用フラグ：13のBITを返す。
;	RETURNF GETBIT(特定状況口上用フラグ:対象キャラ:13, (対象部位 - 変換定数))
;
;
;
;
;
;--------------------------------------------------
;パッチェさん_DB検索
;--------------------------------------------------
;履歴DBから、例えば「あなたの[唇]にファーストキスを捧げた」を検索し、それが存在するかを検索する処理
;すべての検索対象字句が含まれる履歴を見つけたら１を返し、なければゼロを返す
;/
;使用想定は、フラグとして保存されていない事柄の検索
;例えば「一時の気の迷いで（オーナー名）と一線を越えてしまった」って履歴は、
;「トランス状態で、性交渉をお願いする が成功した場合」にのみ登録されるが、この回数はシステム的に保存されない（……多分）
;あとは当然、口上独自の特殊履歴も、独自でフラグでカウントなりしてないと取れないので、そのあたりが想定の対象
;/
;「履歴用実績:対象キャラ:腸内射精回数」とか、システム的に保存されてる部分なら、もちろんそっち取ったほうがいい。
;この関数は、まあ、最後の手段だよ。
;/
;例えば検索する場合は『「あなた」、「唇」「ファーストキス」』、『「あなた」、「一線を越えて」「」』あたりを条件にしてやる
;基本オーナーが対象の履歴を検索する想定
;……なんだけど、オーナー名が含まれない履歴を検索する場合もありえる（「ゲーム中に初めてコマンド対象になった」など）
;--------------------------------------------------
@パッチェさん_DB検索(対象キャラ, 相手キャラ名 = "", 検索文字列１ = "", 検索文字列２ = "", 周回数 = -1)
#FUNCTION
#DIM 対象キャラ
#DIMS 相手キャラ名
#DIMS 検索文字列１
#DIMS 検索文字列２
#DIM 周回数
#DIMS フィルタ
#DIM 履歴件数
#DIM 検索リザルトID
#DIM カウンタ
#DIMS 履歴NOTE


	;検索語句１と２が両方とも指定されていなければゼロを返すよ
	;（どう考えても以下の処理は重いので、その前に帰りたい）
	SIF 検索文字列１ == "" && 検索文字列２ == ""
		RETURNF 0

	;周回数を取る
	;基本は「今周回」だけど、過去周回もまあ指定可能にしておく
	;（「過去周回で特定の履歴が存在したか？」を見られるはず）
	SIF 周回数 == -1
		周回数 = GET_PERSON_出会った周回(CFLAG:対象キャラ:人物番号)

	;履歴件数を取る
	;　対象データベースは「履歴データベース」（まあ当然）
	;　フィルタは「キャラIDが対象キャラのもの、あるいは全体履歴」かつ「今周回」
	;　ソートルールはナシでいいんだけど、いちおう日付ソートにしておく
	;……で検索した結果の件数を、「履歴件数」に保存。
	;条件を満たしているデータが入っていたidを、検索リザルトIDに配列で保存（むしろこっちが本命なところありますね）

	フィルタ = ""
	フィルタ += "(キャラID = {CFLAG:対象キャラ:人物番号} OR キャラID = 0) AND LOOP = {周回数} "
	履歴件数 = DT_SELECT("履歴データベース", @"%フィルタ% ", "DATE ASC", 検索リザルトID)

	;詳細のメモ。
	;/
	;履歴DBには、以下のような項目が入っているよ（※項目数や内容は簡略にしてるよ）
	; ID	キャラ		日時	内容
	;  0	マギサ		10/15	あなたにキスされた
	;  1	クラリス	10/16	あなたに処女を奪われた
	;  2	クラリス	10/16	あなたに処女を奪われた
	;  3	アンチラ	10/17	あなたに処女を奪われた
	;  4	クラリス	10/17	あなたにＡ処女を奪われた
	;  5	マギサ		10/17	あなたに処女を奪われた
	;/
	;「DT_SELECT()」は、このデータベースに条件を付けて検索をする命令。
	;検索データベース名、条件、ソート条件、出力対象変数、を指定できる。
	;今回は、仮に……
	;　検索DB＝"履歴データベース"
	;　条件＝「キャラがクラリスのもの」
	;　ソート条件＝「日時の昇順」
	;　出力対象変数＝「検索リザルトID」
	;……って条件で取ったとする。
	;すると、「キャラがクラリス」の項目は３つなので、履歴件数は３となる。
	;して、「検索リザルトID」の中には、キャラがクラリスの項目ID、「1、2、4」が、配列で入る。
	;（さすがに配列と添字については省略するね）
	;それを利用してやれるはず……だね！

	FOR カウンタ, 0, 履歴件数
		;履歴DBの、「検索リザルトIDのカウンタ番目項目」の、NOTE＝履歴内容を取る
		履歴NOTE = DT_CELL_GETS("履歴データベース", 検索リザルトID:カウンタ, "NOTE")

		;相手キャラ名が指定されている（空白でない）　かつ、それが履歴NOTEに含まれていないなら、次の履歴に行く
		SIF 相手キャラ名 != "" && STRFIND(履歴NOTE, 相手キャラ名) == -1
			CONTINUE
		;検索文字列１が指定されている（空白でない）　かつ、それが履歴NOTEに含まれていないなら、次の履歴に行く
		SIF 検索文字列１ != "" && STRFIND(履歴NOTE, 検索文字列１) == -1
			CONTINUE
		;検索文字列２が指定されている（空白でない）　かつ、それが履歴NOTEに含まれていないなら、次の履歴に行く
		SIF 検索文字列２ != "" && STRFIND(履歴NOTE, 検索文字列２) == -1
			CONTINUE

		;特殊文字列チェック
		;検索文字列１または２の指定が「処女」の場合、「Ａ処女」を間違って検出しちゃう場合がある
		;なので「どっちかの指定が『処女』」で、履歴NOTEに『Ａ処女』が見つかった場合、次の履歴に行く
		;（検索文字１＝処女、検索文字２＝Ａ処女、の場合事故が起きるケースがあるが……それは考慮外でいいと思う）
		SIF (検索文字列２ == "処女" || 検索文字列２ == "処女") && STRFIND(履歴NOTE, "Ａ処女") > -1
			CONTINUE

		;検索文字列１、２がどっちも見つかり、かつ、特殊文字列にも引っかからなかったら、１を返す
		RETURNF 1
	NEXT

	;見つからなかったらゼロを返す
	RETURNF 0

;--------------------------------------------------
;以下、没、メモなど
;--------------------------------------------------

;	;表示順・グループ分けには、ちょっと迷うところがある
;	;候補メモ（結局２にした）
;	IF 0
;		;案１
;		;eratohoKモデル
;		PRINTFORML □ 経験 □-------------------------------------------------------------------------------
;		PRINTFORML オーナーの男根に唇の初めてを捧げた
;		PRINTFORML オーナーの男根に処女を奪われた
;		PRINTFORML オーナーの男根に肛門処女を捧げた
;		PRINTFORML （以下略）
;		PRINTFORML  
;		PRINTFORML □ 感覚 □-------------------------------------------------------------------------------
;		PRINTFORML クリトリスははちきれそうなほどに磨き上げられている
;		PRINTFORML 乳房は風が吹いただけで絶頂してしまうほど敏感になっている
;		PRINTFORML （以下略）
;		PRINTFORML  
;		PRINTFORML □ 性的嗜好 □---------------------------------------------------------------------------
;		PRINTFORML 痴態を見られることを至上の悦びとしている
;		PRINTFORML 精液なしでは生きていられない
;		PRINTFORML 乳房は壊れた蛇口のように母乳を垂れ流している
;		PRINTFORML （以下略）
;		PRINTFORML  
;		PRINTFORML □ 陥落 □-------------------------------------------------------------------------------
;		PRINTFORML オーナーに恋心を抱いている
;		PRINTFORML オーナーとはセックスフレンドの関係だ
;		PRINTFORML  
;		PRINTFORML □ 特殊な陥落 □-------------------------------------------------------------------------
;		PRINTFORML 淫らなことが大好きな淫乱だ
;		PRINTFORML 完全にマゾに目覚め、オーナーに陥落している
;		PRINTFORML 
;		PRINTFORML  
;
;		;案２
;		;プロメティア口上参考
;		PRINTFORML □ 口腔 □-------------------------------------------------------------------------------
;		PRINTFORML オーナーの男根に唇の初めてを捧げた
;		PRINTFORML  
;		PRINTFORML □ 陰核 □-------------------------------------------------------------------------------
;		PRINTFORML クリトリスははちきれそうなほどに磨き上げられている
;		PRINTFORML  
;		PRINTFORML □ 膣内 □-------------------------------------------------------------------------------
;		PRINTFORML オーナーの男根に処女を奪われた
;		PRINTFORML  
;		PRINTFORML □ 子宮 □-------------------------------------------------------------------------------
;		PRINTFORML  
;		PRINTFORML □ 乳房 □-------------------------------------------------------------------------------
;		PRINTFORML 乳房は風が吹いただけで絶頂してしまうほど敏感になっている
;		PRINTFORML  
;		PRINTFORML □ 乳首 □-------------------------------------------------------------------------------
;		PRINTFORML 乳房は壊れた蛇口のように母乳を垂れ流している
;		PRINTFORML  
;		PRINTFORML □ 肛門 □-------------------------------------------------------------------------------
;		PRINTFORML オーナーの男根に肛門処女を捧げた
;		PRINTFORML  
;		PRINTFORML □ 肉体 □-------------------------------------------------------------------------------
;		PRINTFORML 完全にマゾに目覚め、オーナーに陥落している
;		PRINTFORML  
;		PRINTFORML □ 精神 □-------------------------------------------------------------------------------
;		PRINTFORML オーナーに恋心を抱いている
;		PRINTFORML オーナーとはセックスフレンドの関係だ
;		PRINTFORML  
;		PRINTFORML □ 淫蕩 □-------------------------------------------------------------------------------
;		PRINTFORML 淫らなことが大好きな淫乱だ
;		PRINTFORML 精液なしでは生きていられない
;		PRINTFORML 完全にマゾに目覚め、オーナーに陥落している
;
;	ENDIF

;	;固有経験のINPUT想定
;	IF 0
;	ELSEIF INPUT数値 == 2100
;		;固有経験の表示を切り替える想定
;		;関係：精液提供者さん [切替]
;		;↓[切替]押下↓
;		;関係：「得濃孕ませザーメン詰め込み男だと思ってるわこの野郎」
;		INVERTBIT(特定状況口上用フラグ:対象キャラ:13, INPUT数値 - 2000)
;	ELSE


